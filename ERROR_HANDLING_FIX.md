# Исправление красного экрана ошибок

## Что было исправлено:

### 1. Глобальная обработка ошибок (main.dart)
- Добавлен `FlutterError.onError` для обработки ошибок Flutter
- Добавлен `runZonedGuarded` для обработки асинхронных ошибок
- Теперь ошибки логируются в консоль вместо красного экрана

### 2. Безопасный парсинг JSON (models)
- **Chat.fromJson**: Добавлена обработка null значений и безопасный парсинг boolean
- **Message.fromJson**: Добавлена обработка null значений и безопасное преобразование типов
- Все поля теперь имеют значения по умолчанию

### 3. Улучшенная обработка ошибок в сервисах
- **ChatsService.fetchChats**: Безопасный парсинг с обработкой ошибок для каждого чата
- **ChatsService.createChat**: Безопасный парсинг созданного чата
- **MessagesService.fetchMessages**: Безопасный парсинг с обработкой ошибок для каждого сообщения
- Добавлено подробное логирование для отладки

### 4. Улучшенные сообщения об ошибках
- Все ошибки теперь показывают подробную информацию
- Ошибки логируются в консоль для отладки

## Что делать дальше:

1. **Перезапустите приложение** - горячая перезагрузка может не подхватить изменения в main.dart

2. **Проверьте логи в консоли** - теперь все ошибки будут выводиться в консоль с подробной информацией

3. **Если красный экран все еще появляется**:
   - Скопируйте полный текст ошибки из красного экрана
   - Проверьте логи в консоли (flutter run)
   - Сообщите, какая именно ошибка появляется

## Возможные причины красного экрана:

1. **Ошибка парсинга JSON** - теперь обрабатывается безопасно
2. **Null значения** - теперь все поля имеют значения по умолчанию
3. **Несоответствие типов** - теперь все типы преобразуются безопасно
4. **Ошибка сети** - теперь показывается понятное сообщение

## Отладка:

Если проблема сохраняется, проверьте:
- Логи в консоли при запуске `flutter run`
- Ответы сервера в логах (print statements)
- Формат данных, которые возвращает сервер

