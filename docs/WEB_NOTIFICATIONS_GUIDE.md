# üîî –†—É–∫–æ–≤–æ–¥—Å—Ç–≤–æ –ø–æ –≤–µ–±-—É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è–º

## ‚ö†Ô∏è –í–∞–∂–Ω–æ –ø–æ–Ω–∏–º–∞—Ç—å

**–í–µ–±-—É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è —Ä–∞–±–æ—Ç–∞—é—Ç, –ù–û —Å –æ–≥—Ä–∞–Ω–∏—á–µ–Ω–∏—è–º–∏:**
- ‚úÖ –†–∞–±–æ—Ç–∞—é—Ç –≤ —Å–æ–≤—Ä–µ–º–µ–Ω–Ω—ã—Ö –±—Ä–∞—É–∑–µ—Ä–∞—Ö (Chrome, Firefox, Edge, Safari 16+)
- ‚úÖ –†–∞–±–æ—Ç–∞—é—Ç –¥–∞–∂–µ –∫–æ–≥–¥–∞ –≤–∫–ª–∞–¥–∫–∞ –∑–∞–∫—Ä—ã—Ç–∞
- ‚ö†Ô∏è –¢—Ä–µ–±—É—é—Ç —Ä–∞–∑—Ä–µ—à–µ–Ω–∏—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
- ‚ö†Ô∏è –†–∞–±–æ—Ç–∞—é—Ç —Ç–æ–ª—å–∫–æ —á–µ—Ä–µ–∑ HTTPS (–∏–ª–∏ localhost)
- ‚ö†Ô∏è –¢—Ä–µ–±—É—é—Ç Service Worker
- ‚ö†Ô∏è –ù–µ —Ä–∞–±–æ—Ç–∞—é—Ç –≤ Safari –Ω–∞ iOS (–æ–≥—Ä–∞–Ω–∏—á–µ–Ω–∏–µ Apple)

---

## üéØ –ö–∞–∫ —Ä–∞–±–æ—Ç–∞—é—Ç –≤–µ–±-—É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è

### –ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞

```
‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê         ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê         ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ   –ë—Ä–∞—É–∑–µ—Ä   ‚îÇ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚ñ∫‚îÇ Push Service ‚îÇ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚ñ∫‚îÇ   –°–µ—Ä–≤–µ—Ä    ‚îÇ
‚îÇ  (Flutter)  ‚îÇ         ‚îÇ  (Firebase/  ‚îÇ         ‚îÇ  (Node.js)  ‚îÇ
‚îÇ             ‚îÇ         ‚îÇ   VAPID)     ‚îÇ         ‚îÇ             ‚îÇ
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò         ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò         ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
      ‚îÇ                                              ‚îÇ
      ‚îÇ                                              ‚îÇ
      ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚ñ∫ Service Worker ‚óÑ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
                      (–æ–±—Ä–∞–±–æ—Ç–∫–∞ —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–π)
```

### –ü—Ä–æ—Ü–µ—Å—Å —Ä–∞–±–æ—Ç—ã:

1. **–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –æ—Ç–∫—Ä—ã–≤–∞–µ—Ç —Å–∞–π—Ç** ‚Üí –ó–∞–ø—Ä–∞—à–∏–≤–∞–µ—Ç—Å—è —Ä–∞–∑—Ä–µ—à–µ–Ω–∏–µ –Ω–∞ —É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è
2. **–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å —Ä–∞–∑—Ä–µ—à–∞–µ—Ç** ‚Üí –ë—Ä–∞—É–∑–µ—Ä –≥–µ–Ω–µ—Ä–∏—Ä—É–µ—Ç Push Subscription
3. **Subscription –æ—Ç–ø—Ä–∞–≤–ª—è–µ—Ç—Å—è –Ω–∞ —Å–µ—Ä–≤–µ—Ä** ‚Üí –°–æ—Ö—Ä–∞–Ω—è–µ—Ç—Å—è –≤ –ë–î
4. **–ü—Ä–∏—Ö–æ–¥–∏—Ç –Ω–æ–≤–æ–µ —Å–æ–æ–±—â–µ–Ω–∏–µ** ‚Üí –°–µ—Ä–≤–µ—Ä –æ—Ç–ø—Ä–∞–≤–ª—è–µ—Ç push —á–µ—Ä–µ–∑ Push Service
5. **Push Service –¥–æ—Å—Ç–∞–≤–ª—è–µ—Ç —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–µ** ‚Üí Service Worker –ø–æ–ª—É—á–∞–µ—Ç –µ–≥–æ
6. **Service Worker –ø–æ–∫–∞–∑—ã–≤–∞–µ—Ç —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–µ** ‚Üí –î–∞–∂–µ –µ—Å–ª–∏ –≤–∫–ª–∞–¥–∫–∞ –∑–∞–∫—Ä—ã—Ç–∞

---

## üîß –í–∞—Ä–∏–∞–Ω—Ç—ã —Ä–µ–∞–ª–∏–∑–∞—Ü–∏–∏

### –í–∞—Ä–∏–∞–Ω—Ç 1: Firebase Cloud Messaging (FCM) - –†–µ–∫–æ–º–µ–Ω–¥—É–µ—Ç—Å—è ‚úÖ

**–ü–ª—é—Å—ã:**
- ‚úÖ –ì–æ—Ç–æ–≤–æ–µ —Ä–µ—à–µ–Ω–∏–µ –æ—Ç Google
- ‚úÖ –†–∞–±–æ—Ç–∞–µ—Ç –Ω–∞ –≤—Å–µ—Ö –ø–ª–∞—Ç—Ñ–æ—Ä–º–∞—Ö (–≤–µ–±, Android, iOS)
- ‚úÖ –ë–µ—Å–ø–ª–∞—Ç–Ω–æ –¥–æ 10,000 —É—Å—Ç—Ä–æ–π—Å—Ç–≤
- ‚úÖ –•–æ—Ä–æ—à–∞—è –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è
- ‚úÖ –ù–∞–¥–µ–∂–Ω–∞—è –∏–Ω—Ñ—Ä–∞—Å—Ç—Ä—É–∫—Ç—É—Ä–∞

**–ú–∏–Ω—É—Å—ã:**
- ‚ö†Ô∏è –ó–∞–≤–∏—Å–∏–º–æ—Å—Ç—å –æ—Ç Google
- ‚ö†Ô∏è –ù—É–∂–Ω–∞ –Ω–∞—Å—Ç—Ä–æ–π–∫–∞ Firebase –ø—Ä–æ–µ–∫—Ç–∞

**–°–ª–æ–∂–Ω–æ—Å—Ç—å:** ‚≠ê‚≠ê‚≠ê (3/5)

---

### –í–∞—Ä–∏–∞–Ω—Ç 2: –°–≤–æ–π —Å–µ—Ä–≤–µ—Ä —Å VAPID

**–ü–ª—é—Å—ã:**
- ‚úÖ –ü–æ–ª–Ω—ã–π –∫–æ–Ω—Ç—Ä–æ–ª—å
- ‚úÖ –ù–µ—Ç –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏ –æ—Ç –≤–Ω–µ—à–Ω–∏—Ö —Å–µ—Ä–≤–∏—Å–æ–≤
- ‚úÖ –ë–µ—Å–ø–ª–∞—Ç–Ω–æ

**–ú–∏–Ω—É—Å—ã:**
- ‚ö†Ô∏è –ù—É–∂–Ω–æ —Ä–µ–∞–ª–∏–∑–æ–≤—ã–≤–∞—Ç—å —Å–∞–º–æ–º—É
- ‚ö†Ô∏è –°–ª–æ–∂–Ω–µ–µ –Ω–∞—Å—Ç—Ä–æ–π–∫–∞
- ‚ö†Ô∏è –ù—É–∂–Ω–æ –ø–æ–¥–¥–µ—Ä–∂–∏–≤–∞—Ç—å

**–°–ª–æ–∂–Ω–æ—Å—Ç—å:** ‚≠ê‚≠ê‚≠ê‚≠ê (4/5)

---

### –í–∞—Ä–∏–∞–Ω—Ç 3: –ê–ª—å—Ç–µ—Ä–Ω–∞—Ç–∏–≤—ã (–µ—Å–ª–∏ push –Ω–µ –ø–æ–¥—Ö–æ–¥–∏—Ç)

#### 3.1. In-App —É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è (–∫–æ–≥–¥–∞ –≤–∫–ª–∞–¥–∫–∞ –æ—Ç–∫—Ä—ã—Ç–∞)
- –ü–æ–∫–∞–∑—ã–≤–∞—Ç—å —É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è –≤–Ω—É—Ç—Ä–∏ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è
- –ò—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å `flutter_local_notifications` (–Ω–æ —ç—Ç–æ –¥–ª—è –º–æ–±–∏–ª—å–Ω—ã—Ö)
- –î–ª—è –≤–µ–±–∞: –∫–∞—Å—Ç–æ–º–Ω—ã–µ –≤–∏–¥–∂–µ—Ç—ã —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–π

#### 3.2. Email —É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è
- –û—Ç–ø—Ä–∞–≤–ª—è—Ç—å email –ø—Ä–∏ –Ω–æ–≤—ã—Ö —Å–æ–æ–±—â–µ–Ω–∏—è—Ö
- –ü—Ä–æ—â–µ —Ä–µ–∞–ª–∏–∑–æ–≤–∞—Ç—å
- –†–∞–±–æ—Ç–∞–µ—Ç –≤—Å–µ–≥–¥–∞

#### 3.3. Browser Badge API
- –ü–æ–∫–∞–∑—ã–≤–∞—Ç—å —Å—á–µ—Ç—á–∏–∫ –Ω–µ–ø—Ä–æ—á–∏—Ç–∞–Ω–Ω—ã—Ö –Ω–∞ –∏–∫–æ–Ω–∫–µ –≤–∫–ª–∞–¥–∫–∏
- –†–∞–±–æ—Ç–∞–µ—Ç –±–µ–∑ —Ä–∞–∑—Ä–µ—à–µ–Ω–∏–π
- –û–≥—Ä–∞–Ω–∏—á–µ–Ω–Ω–∞—è —Ñ—É–Ω–∫—Ü–∏–æ–Ω–∞–ª—å–Ω–æ—Å—Ç—å

---

## üöÄ –†–µ–∞–ª–∏–∑–∞—Ü–∏—è —á–µ—Ä–µ–∑ Firebase FCM (–†–µ–∫–æ–º–µ–Ω–¥—É–µ—Ç—Å—è)

### –®–∞–≥ 1: –ù–∞—Å—Ç—Ä–æ–π–∫–∞ Firebase

1. **–°–æ–∑–¥–∞—Ç—å –ø—Ä–æ–µ–∫—Ç –≤ Firebase Console**
   - https://console.firebase.google.com
   - –î–æ–±–∞–≤–∏—Ç—å –≤–µ–±-–ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ
   - –ü–æ–ª—É—á–∏—Ç—å `firebaseConfig`

2. **–í–∫–ª—é—á–∏—Ç—å Cloud Messaging**
   - –í –Ω–∞—Å—Ç—Ä–æ–π–∫–∞—Ö –ø—Ä–æ–µ–∫—Ç–∞ ‚Üí Cloud Messaging
   - –°–≥–µ–Ω–µ—Ä–∏—Ä–æ–≤–∞—Ç—å –∫–ª—é—á —Å–µ—Ä–≤–µ—Ä–∞

### –®–∞–≥ 2: –£—Å—Ç–∞–Ω–æ–≤–∫–∞ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–µ–π

```yaml
# pubspec.yaml
dependencies:
  firebase_core: ^2.24.2
  firebase_messaging: ^14.7.9
  flutter_local_notifications: ^16.3.0  # –î–ª—è –º–æ–±–∏–ª—å–Ω—ã—Ö
```

### –®–∞–≥ 3: –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è Firebase

```dart
// lib/main.dart
import 'package:firebase_core/firebase_core.dart';
import 'firebase_options.dart'; // –°–≥–µ–Ω–µ—Ä–∏—Ä—É–µ—Ç—Å—è –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏

void main() async {
  WidgetsFlutterBinding.ensureInitialized();
  await Firebase.initializeApp(
    options: DefaultFirebaseOptions.currentPlatform,
  );
  runApp(MyApp());
}
```

### –®–∞–≥ 4: –ù–∞—Å—Ç—Ä–æ–π–∫–∞ Service Worker –¥–ª—è –≤–µ–±–∞

–°–æ–∑–¥–∞—Ç—å —Ñ–∞–π–ª `web/firebase-messaging-sw.js`:

```javascript
// web/firebase-messaging-sw.js
importScripts('https://www.gstatic.com/firebasejs/10.7.1/firebase-app-compat.js');
importScripts('https://www.gstatic.com/firebasejs/10.7.1/firebase-messaging-compat.js');

// –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è Firebase
firebase.initializeApp({
  apiKey: "YOUR_API_KEY",
  authDomain: "YOUR_AUTH_DOMAIN",
  projectId: "YOUR_PROJECT_ID",
  storageBucket: "YOUR_STORAGE_BUCKET",
  messagingSenderId: "YOUR_MESSAGING_SENDER_ID",
  appId: "YOUR_APP_ID"
});

const messaging = firebase.messaging();

// –û–±—Ä–∞–±–æ—Ç–∫–∞ —Ñ–æ–Ω–æ–≤—ã—Ö —Å–æ–æ–±—â–µ–Ω–∏–π
messaging.onBackgroundMessage((payload) => {
  console.log('Background message received:', payload);
  
  const notificationTitle = payload.notification?.title || '–ù–æ–≤–æ–µ —Å–æ–æ–±—â–µ–Ω–∏–µ';
  const notificationOptions = {
    body: payload.notification?.body || '–£ –≤–∞—Å –Ω–æ–≤–æ–µ —Å–æ–æ–±—â–µ–Ω–∏–µ',
    icon: '/icons/Icon-192.png',
    badge: '/icons/Icon-192.png',
    tag: payload.data?.chatId,
    data: payload.data,
  };

  return self.registration.showNotification(
    notificationTitle,
    notificationOptions
  );
});

// –û–±—Ä–∞–±–æ—Ç–∫–∞ –∫–ª–∏–∫–∞ –ø–æ —É–≤–µ–¥–æ–º–ª–µ–Ω–∏—é
self.addEventListener('notificationclick', (event) => {
  event.notification.close();
  
  const chatId = event.notification.data?.chatId;
  if (chatId) {
    event.waitUntil(
      clients.openWindow(`/#/chat/${chatId}`)
    );
  }
});
```

### –®–∞–≥ 5: –ö–æ–¥ –≤ Flutter

```dart
// lib/services/notification_service.dart
import 'package:firebase_messaging/firebase_messaging.dart';
import 'package:flutter/foundation.dart';

class NotificationService {
  static final FirebaseMessaging _messaging = FirebaseMessaging.instance;

  // –ó–∞–ø—Ä–æ—Å —Ä–∞–∑—Ä–µ—à–µ–Ω–∏—è
  static Future<bool> requestPermission() async {
    if (kIsWeb) {
      // –î–ª—è –≤–µ–±–∞ –∏—Å–ø–æ–ª—å–∑—É–µ–º Web Notification API
      final permission = await _messaging.requestPermission(
        alert: true,
        badge: true,
        sound: true,
      );
      return permission.authorizationStatus == AuthorizationStatus.authorized;
    } else {
      // –î–ª—è –º–æ–±–∏–ª—å–Ω—ã—Ö
      final settings = await _messaging.requestPermission();
      return settings.authorizationStatus == AuthorizationStatus.authorized;
    }
  }

  // –ü–æ–ª—É—á–µ–Ω–∏–µ —Ç–æ–∫–µ–Ω–∞ –¥–ª—è –æ—Ç–ø—Ä–∞–≤–∫–∏ –Ω–∞ —Å–µ—Ä–≤–µ—Ä
  static Future<String?> getToken() async {
    try {
      final token = await _messaging.getToken();
      print('FCM Token: $token');
      return token;
    } catch (e) {
      print('Error getting FCM token: $e');
      return null;
    }
  }

  // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è
  static Future<void> initialize() async {
    // –û–±—Ä–∞–±–æ—Ç–∫–∞ —Å–æ–æ–±—â–µ–Ω–∏–π –∫–æ–≥–¥–∞ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ –æ—Ç–∫—Ä—ã—Ç–æ
    FirebaseMessaging.onMessage.listen((RemoteMessage message) {
      print('Message received: ${message.notification?.title}');
      // –ü–æ–∫–∞–∑–∞—Ç—å —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–µ –≤ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–∏
      _showInAppNotification(message);
    });

    // –û–±—Ä–∞–±–æ—Ç–∫–∞ —Å–æ–æ–±—â–µ–Ω–∏–π –∫–æ–≥–¥–∞ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ –≤ —Ñ–æ–Ω–µ
    FirebaseMessaging.onMessageOpenedApp.listen((RemoteMessage message) {
      print('Message opened app: ${message.data}');
      // –ù–∞–≤–∏–≥–∞—Ü–∏—è –∫ —á–∞—Ç—É
      _handleNotificationTap(message);
    });

    // –ü—Ä–æ–≤–µ—Ä–∫–∞, –±—ã–ª–æ –ª–∏ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ –æ—Ç–∫—Ä—ã—Ç–æ —á–µ—Ä–µ–∑ —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–µ
    final initialMessage = await _messaging.getInitialMessage();
    if (initialMessage != null) {
      _handleNotificationTap(initialMessage);
    }
  }

  static void _showInAppNotification(RemoteMessage message) {
    // –ü–æ–∫–∞–∑–∞—Ç—å –∫–∞—Å—Ç–æ–º–Ω–æ–µ —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–µ –≤ UI
    // –ú–æ–∂–Ω–æ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å SnackBar –∏–ª–∏ –∫–∞—Å—Ç–æ–º–Ω—ã–π –≤–∏–¥–∂–µ—Ç
  }

  static void _handleNotificationTap(RemoteMessage message) {
    final chatId = message.data['chatId'];
    if (chatId != null) {
      // –ù–∞–≤–∏–≥–∞—Ü–∏—è –∫ —á–∞—Ç—É
      // Navigator.pushNamed(context, '/chat/$chatId');
    }
  }
}
```

### –®–∞–≥ 6: –û—Ç–ø—Ä–∞–≤–∫–∞ —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–π —Å —Å–µ—Ä–≤–µ—Ä–∞

```javascript
// my_serve_chat_test/controllers/messagesController.js
import admin from 'firebase-admin';

// –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è Firebase Admin SDK
admin.initializeApp({
  credential: admin.credential.cert({
    projectId: process.env.FIREBASE_PROJECT_ID,
    privateKey: process.env.FIREBASE_PRIVATE_KEY?.replace(/\\n/g, '\n'),
    clientEmail: process.env.FIREBASE_CLIENT_EMAIL,
  }),
});

// –ü—Ä–∏ –æ—Ç–ø—Ä–∞–≤–∫–µ —Å–æ–æ–±—â–µ–Ω–∏—è
export const sendMessage = async (req, res) => {
  // ... —Å—É—â–µ—Å—Ç–≤—É—é—â–∏–π –∫–æ–¥ –æ—Ç–ø—Ä–∞–≤–∫–∏ —Å–æ–æ–±—â–µ–Ω–∏—è ...

  // –ü–æ–ª—É—á–∞–µ–º FCM —Ç–æ–∫–µ–Ω—ã –≤—Å–µ—Ö —É—á–∞—Å—Ç–Ω–∏–∫–æ–≤ —á–∞—Ç–∞ (–∫—Ä–æ–º–µ –æ—Ç–ø—Ä–∞–≤–∏—Ç–µ–ª—è)
  const members = await pool.query(
    'SELECT user_id, fcm_token FROM chat_users WHERE chat_id = $1 AND user_id != $2',
    [chatId, userId]
  );

  // –û—Ç–ø—Ä–∞–≤–ª—è–µ–º —É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è
  const tokens = members.rows
    .map(row => row.fcm_token)
    .filter(token => token != null);

  if (tokens.length > 0) {
    const message = {
      notification: {
        title: chatName,
        body: content,
      },
      data: {
        chatId: chatId.toString(),
        userId: userId.toString(),
        type: 'new_message',
      },
      tokens: tokens,
    };

    try {
      const response = await admin.messaging().sendMulticast(message);
      console.log(`Sent ${response.successCount} notifications`);
    } catch (error) {
      console.error('Error sending notifications:', error);
    }
  }

  // ... –æ—Å—Ç–∞–ª—å–Ω–æ–π –∫–æ–¥ ...
};
```

---

## üîÑ –ê–ª—å—Ç–µ—Ä–Ω–∞—Ç–∏–≤–∞: –ü—Ä–æ—Å—Ç—ã–µ –≤–µ–±-—É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è (–±–µ–∑ Firebase)

–ï—Å–ª–∏ –Ω–µ —Ö–æ—Ç–∏—Ç–µ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å Firebase, –º–æ–∂–Ω–æ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å Web Notification API –Ω–∞–ø—Ä—è–º—É—é:

```dart
// lib/services/web_notification_service.dart
import 'dart:html' as html;

class WebNotificationService {
  // –ó–∞–ø—Ä–æ—Å —Ä–∞–∑—Ä–µ—à–µ–Ω–∏—è
  static Future<bool> requestPermission() async {
    if (html.window.Notification == null) {
      print('Notifications not supported');
      return false;
    }

    final permission = await html.window.Notification.requestPermission();
    return permission == 'granted';
  }

  // –ü–æ–∫–∞–∑–∞—Ç—å —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–µ
  static void showNotification({
    required String title,
    required String body,
    String? icon,
    String? tag,
    Map<String, dynamic>? data,
    Function()? onClick,
  }) {
    if (html.window.Notification == null) return;

    final notification = html.window.Notification(
      title,
      NotificationOptions(
        body: body,
        icon: icon ?? '/icons/Icon-192.png',
        tag: tag,
        data: data,
      ),
    );

    if (onClick != null) {
      notification.onClick.listen((_) => onClick());
    }
  }
}
```

**–ù–æ —ç—Ç–æ —Ä–∞–±–æ—Ç–∞–µ—Ç —Ç–æ–ª—å–∫–æ –∫–æ–≥–¥–∞ –≤–∫–ª–∞–¥–∫–∞ –æ—Ç–∫—Ä—ã—Ç–∞!** –î–ª—è —Ñ–æ–Ω–æ–≤—ã—Ö —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–π –Ω—É–∂–µ–Ω Push Service (Firebase –∏–ª–∏ VAPID).

---

## üìä –°—Ä–∞–≤–Ω–µ–Ω–∏–µ –≤–∞—Ä–∏–∞–Ω—Ç–æ–≤

| –ö—Ä–∏—Ç–µ—Ä–∏–π | Firebase FCM | VAPID | Web Notifications API |
|---------|---------------|-------|---------------------|
| –†–∞–±–æ—Ç–∞–µ—Ç –≤ —Ñ–æ–Ω–µ | ‚úÖ | ‚úÖ | ‚ùå |
| –†–∞–±–æ—Ç–∞–µ—Ç –∫–æ–≥–¥–∞ –≤–∫–ª–∞–¥–∫–∞ –∑–∞–∫—Ä—ã—Ç–∞ | ‚úÖ | ‚úÖ | ‚ùå |
| –°–ª–æ–∂–Ω–æ—Å—Ç—å –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ | ‚≠ê‚≠ê‚≠ê | ‚≠ê‚≠ê‚≠ê‚≠ê | ‚≠ê‚≠ê |
| –ó–∞–≤–∏—Å–∏–º–æ—Å—Ç—å –æ—Ç –≤–Ω–µ—à–Ω–∏—Ö —Å–µ—Ä–≤–∏—Å–æ–≤ | ‚úÖ | ‚ùå | ‚ùå |
| –ö—Ä–æ—Å—Å–ø–ª–∞—Ç—Ñ–æ—Ä–º–µ–Ω–Ω–æ—Å—Ç—å | ‚úÖ | ‚ö†Ô∏è | ‚ùå |
| –ë–µ—Å–ø–ª–∞—Ç–Ω–æ | ‚úÖ (–¥–æ –ª–∏–º–∏—Ç–∞) | ‚úÖ | ‚úÖ |

---

## ‚ö†Ô∏è –û–≥—Ä–∞–Ω–∏—á–µ–Ω–∏—è –≤–µ–±-—É–≤–µ–¥–æ–º–ª–µ–Ω–∏–π

1. **Safari –Ω–∞ iOS**
   - –ù–µ –ø–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ—Ç Web Push API
   - –†–∞–±–æ—Ç–∞–µ—Ç —Ç–æ–ª—å–∫–æ —á–µ—Ä–µ–∑ –Ω–∞—Ç–∏–≤–Ω—ã–µ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è

2. **–¢—Ä–µ–±—É–µ—Ç—Å—è —Ä–∞–∑—Ä–µ—à–µ–Ω–∏–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è**
   - –ú–Ω–æ–≥–∏–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–∏ –±–ª–æ–∫–∏—Ä—É—é—Ç —É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è
   - –ù—É–∂–Ω–æ –æ–±—ä—è—Å–Ω—è—Ç—å –∑–∞—á–µ–º –æ–Ω–∏ –Ω—É–∂–Ω—ã

3. **HTTPS –æ–±—è–∑–∞—Ç–µ–ª–µ–Ω**
   - –ù–µ —Ä–∞–±–æ—Ç–∞–µ—Ç –Ω–∞ HTTP (–∫—Ä–æ–º–µ localhost)
   - Vercel —É–∂–µ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç HTTPS ‚úÖ

4. **Service Worker –æ–±—è–∑–∞—Ç–µ–ª–µ–Ω**
   - –£ –≤–∞—Å —É–∂–µ –µ—Å—Ç—å flutter_service_worker.js ‚úÖ
   - –ù—É–∂–Ω–æ –¥–æ–±–∞–≤–∏—Ç—å –æ–±—Ä–∞–±–æ—Ç–∫—É push-—Å–æ–±—ã—Ç–∏–π

---

## üéØ –†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏—è

**–î–ª—è –≤–∞—à–µ–≥–æ –ø—Ä–æ–µ–∫—Ç–∞ —Ä–µ–∫–æ–º–µ–Ω–¥—É—é:**

1. **–ù–∞—á–∞—Ç—å —Å –ø—Ä–æ—Å—Ç—ã—Ö in-app —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–π** (–∫–æ–≥–¥–∞ –≤–∫–ª–∞–¥–∫–∞ –æ—Ç–∫—Ä—ã—Ç–∞)
   - –ü–æ–∫–∞–∑—ã–≤–∞—Ç—å —É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è –≤–Ω—É—Ç—Ä–∏ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è
   - –ò—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å WebSocket –¥–ª—è real-time
   - –ü—Ä–æ—â–µ —Ä–µ–∞–ª–∏–∑–æ–≤–∞—Ç—å

2. **–ü–æ—Ç–æ–º –¥–æ–±–∞–≤–∏—Ç—å Firebase FCM** (–¥–ª—è —Ñ–æ–Ω–æ–≤—ã—Ö —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–π)
   - –ö–æ–≥–¥–∞ –Ω—É–∂–Ω–æ —É–≤–µ–¥–æ–º–ª—è—Ç—å –∫–æ–≥–¥–∞ –≤–∫–ª–∞–¥–∫–∞ –∑–∞–∫—Ä—ã—Ç–∞
   - –ë–æ–ª–µ–µ —Å–ª–æ–∂–Ω–∞—è –Ω–∞—Å—Ç—Ä–æ–π–∫–∞, –Ω–æ –Ω–∞–¥–µ–∂–Ω–µ–µ

3. **–ê–ª—å—Ç–µ—Ä–Ω–∞—Ç–∏–≤–∞: Browser Badge API**
   - –ü–æ–∫–∞–∑—ã–≤–∞—Ç—å —Å—á–µ—Ç—á–∏–∫ –Ω–µ–ø—Ä–æ—á–∏—Ç–∞–Ω–Ω—ã—Ö –Ω–∞ –∏–∫–æ–Ω–∫–µ
   - –†–∞–±–æ—Ç–∞–µ—Ç –±–µ–∑ —Ä–∞–∑—Ä–µ—à–µ–Ω–∏–π
   - –ü—Ä–æ—Å—Ç–∞—è —Ä–µ–∞–ª–∏–∑–∞—Ü–∏—è

---

## üí° –ß—Ç–æ –≤—ã–±—Ä–∞—Ç—å?

**–ï—Å–ª–∏ –Ω—É–∂–Ω–æ —É–≤–µ–¥–æ–º–ª—è—Ç—å –∫–æ–≥–¥–∞ –≤–∫–ª–∞–¥–∫–∞ –∑–∞–∫—Ä—ã—Ç–∞:**
‚Üí –ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ **Firebase FCM**

**–ï—Å–ª–∏ –¥–æ—Å—Ç–∞—Ç–æ—á–Ω–æ —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–π –∫–æ–≥–¥–∞ –≤–∫–ª–∞–¥–∫–∞ –æ—Ç–∫—Ä—ã—Ç–∞:**
‚Üí –ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ **Web Notifications API** –∏–ª–∏ **in-app —É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è**

**–ï—Å–ª–∏ –Ω—É–∂–µ–Ω —Ç–æ–ª—å–∫–æ —Å—á–µ—Ç—á–∏–∫:**
‚Üí –ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ **Badge API**

---

## üöÄ –ë—ã—Å—Ç—Ä—ã–π —Å—Ç–∞—Ä—Ç (In-App —É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è)

–°–∞–º—ã–π –ø—Ä–æ—Å—Ç–æ–π –≤–∞—Ä–∏–∞–Ω—Ç - –ø–æ–∫–∞–∑—ã–≤–∞—Ç—å —É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è –≤–Ω—É—Ç—Ä–∏ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è –∫–æ–≥–¥–∞ –≤–∫–ª–∞–¥–∫–∞ –æ—Ç–∫—Ä—ã—Ç–∞:

```dart
// –ü–æ–∫–∞–∑—ã–≤–∞—Ç—å —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–µ –≤ UI –∫–æ–≥–¥–∞ –ø—Ä–∏—Ö–æ–¥–∏—Ç —Å–æ–æ–±—â–µ–Ω–∏–µ —á–µ—Ä–µ–∑ WebSocket
// –£–∂–µ –µ—Å—Ç—å WebSocket –ø–æ–¥–∫–ª—é—á–µ–Ω–∏–µ - –º–æ–∂–Ω–æ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å –µ–≥–æ!
```

–≠—Ç–æ —Ä–∞–±–æ—Ç–∞–µ—Ç –≤—Å–µ–≥–¥–∞, –Ω–µ —Ç—Ä–µ–±—É–µ—Ç —Ä–∞–∑—Ä–µ—à–µ–Ω–∏–π, –∏ –ª–µ–≥–∫–æ —Ä–µ–∞–ª–∏–∑—É–µ—Ç—Å—è!

---

*–ö–∞–∫–æ–π –≤–∞—Ä–∏–∞–Ω—Ç –≤–∞–º –±–æ–ª—å—à–µ –ø–æ–¥—Ö–æ–¥–∏—Ç?*

