# –£—á–µ–±–Ω–∏–∫ –ø–æ –ø—Ä–æ–µ–∫—Ç—É: Flutter –∏ JavaScript

–≠—Ç–æ—Ç –¥–æ–∫—É–º–µ–Ω—Ç ‚Äî **—É—á–µ–±–Ω–∏–∫ –ø–æ –∫–æ–¥—É —ç—Ç–æ–≥–æ —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏—è**. –î–ª—è –∫–∞–∂–¥–æ–π —Ñ—É–Ω–∫—Ü–∏–∏/–∫–æ–Ω—Ü–µ–ø—Ü–∏–∏ –æ–±—ä—è—Å–Ω—è–µ—Ç—Å—è: **—á—Ç–æ –¥–µ–ª–∞–µ—Ç**, **–∫–∞–∫ —Ä–∞–±–æ—Ç–∞–µ—Ç**, **–∫–∞–∫–æ–π —Å–∏–Ω—Ç–∞–∫—Å–∏—Å**, **–∫–∞–∫–∏–µ –∫–æ–Ω—Ü–µ–ø—Ü–∏–∏ –Ω—É–∂–Ω–æ –∑–Ω–∞—Ç—å**, —á—Ç–æ–±—ã –ø–æ–Ω—è—Ç—å —ç—Ç–æ—Ç –∫–æ–¥. –í—Å–µ –ø—Ä–∏–º–µ—Ä—ã –≤–∑—è—Ç—ã –∏–∑ –ø—Ä–æ–µ–∫—Ç–∞.

---

## –î–ª—è –∫–æ–≥–æ —ç—Ç–æ—Ç —É—á–µ–±–Ω–∏–∫

–£—á–µ–±–Ω–∏–∫ –Ω–∞–ø–∏—Å–∞–Ω —Ç–∞–∫, —á—Ç–æ–±—ã –µ–≥–æ –º–æ–≥ –ø–æ–Ω—è—Ç—å **—á–µ–ª–æ–≤–µ–∫ –±–µ–∑ –æ–ø—ã—Ç–∞ –ø—Ä–æ–≥—Ä–∞–º–º–∏—Ä–æ–≤–∞–Ω–∏—è**. –ï—Å–ª–∏ –≤—ã –Ω–∏–∫–æ–≥–¥–∞ –Ω–µ –ø–∏—Å–∞–ª–∏ –∫–æ–¥ ‚Äî –Ω–µ —Å—Ç—Ä–∞—à–Ω–æ. –ú—ã –±—É–¥–µ–º –≤–≤–æ–¥–∏—Ç—å –≤—Å–µ –Ω—É–∂–Ω—ã–µ –ø–æ–Ω—è—Ç–∏—è –ø–æ —à–∞–≥–∞–º –∏ –æ–±—ä—è—Å–Ω—è—Ç—å –∏—Ö –ø—Ä–æ—Å—Ç—ã–º–∏ —Å–ª–æ–≤–∞–º–∏ –ø–µ—Ä–µ–¥ —Ç–µ–º, –∫–∞–∫ –ø–µ—Ä–µ—Ö–æ–¥–∏—Ç—å –∫ –∫–æ–¥—É.

---

## –ú–∏–Ω–∏–º—É–º –ø–µ—Ä–µ–¥ –Ω–∞—á–∞–ª–æ–º (–ø—Ä–æ—Å—Ç—ã–º–∏ —Å–ª–æ–≤–∞–º–∏)

–ü–µ—Ä–µ–¥ —Ç–µ–º –∫–∞–∫ –æ—Ç–∫—Ä—ã–≤–∞—Ç—å —Ñ–∞–π–ª—ã —Å –∫–æ–¥–æ–º, –ø–æ–ª–µ–∑–Ω–æ –ø—Ä–µ–¥—Å—Ç–∞–≤–ª—è—Ç—å —Å–µ–±–µ –æ–±—â—É—é –∫–∞—Ä—Ç–∏–Ω—É.

- **–ö–æ–¥ (–ø—Ä–æ–≥—Ä–∞–º–º–∞)** ‚Äî —ç—Ç–æ –Ω–∞–±–æ—Ä –∏–Ω—Å—Ç—Ä—É–∫—Ü–∏–π –¥–ª—è –∫–æ–º–ø—å—é—Ç–µ—Ä–∞, –∑–∞–ø–∏—Å–∞–Ω–Ω—ã—Ö –≤ —Ç–µ–∫—Å—Ç–æ–≤—ã—Ö —Ñ–∞–π–ª–∞—Ö. –ö–æ–º–ø—å—é—Ç–µ—Ä –≤—ã–ø–æ–ª–Ω—è–µ—Ç —ç—Ç–∏ –∏–Ω—Å—Ç—Ä—É–∫—Ü–∏–∏ –ø–æ—Å—Ç—Ä–æ—á–Ω–æ.
- **–§–∞–π–ª –∏ –ø–∞–ø–∫–∞** ‚Äî –∫–æ–¥ —Ö—Ä–∞–Ω–∏—Ç—Å—è –≤ —Ñ–∞–π–ª–∞—Ö (–Ω–∞–ø—Ä–∏–º–µ—Ä, `index.js`, `main.dart`). –§–∞–π–ª—ã –ª–µ–∂–∞—Ç –≤ –ø–∞–ø–∫–∞—Ö; –ø–∞–ø–∫–∏ –ø–æ–º–æ–≥–∞—é—Ç —Ä–∞–∑–ª–æ–∂–∏—Ç—å –∫–æ–¥ –ø–æ —Å–º—ã—Å–ª—É (–Ω–∞–ø—Ä–∏–º–µ—Ä, ¬´–≤—Å–µ —ç–∫—Ä–∞–Ω—ã ‚Äî –≤ –ø–∞–ø–∫–µ screens¬ª).
- **–°–µ—Ä–≤–µ—Ä** ‚Äî —ç—Ç–æ –ø—Ä–æ–≥—Ä–∞–º–º–∞, –∫–æ—Ç–æ—Ä–∞—è –ø–æ—Å—Ç–æ—è–Ω–Ω–æ –∑–∞–ø—É—â–µ–Ω–∞ –∏ **–∂–¥—ë—Ç –∑–∞–ø—Ä–æ—Å—ã –∏–∑ –∏–Ω—Ç–µ—Ä–Ω–µ—Ç–∞**. –ö–æ–≥–¥–∞ –≤—ã –æ—Ç–∫—Ä—ã–≤–∞–µ—Ç–µ —á–∞—Ç –≤ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–∏, –≤–∞—à–µ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ –æ—Ç–ø—Ä–∞–≤–ª—è–µ—Ç –∑–∞–ø—Ä–æ—Å—ã –Ω–∞ —Å–µ—Ä–≤–µ—Ä (–Ω–∞–ø—Ä–∏–º–µ—Ä: ¬´–≤–æ–π—Ç–∏¬ª, ¬´–ø–æ–∫–∞–∑–∞—Ç—å —Å–æ–æ–±—â–µ–Ω–∏—è¬ª). –°–µ—Ä–≤–µ—Ä –æ–±—Ä–∞–±–∞—Ç—ã–≤–∞–µ—Ç –∑–∞–ø—Ä–æ—Å –∏ –æ—Ç–ø—Ä–∞–≤–ª—è–µ—Ç –æ—Ç–≤–µ—Ç.
- **–ö–ª–∏–µ–Ω—Ç** ‚Äî —ç—Ç–æ –ø—Ä–æ–≥—Ä–∞–º–º–∞ –∏–ª–∏ —Å–∞–π—Ç, —Å –∫–æ—Ç–æ—Ä–æ–π **–≤–∑–∞–∏–º–æ–¥–µ–π—Å—Ç–≤—É–µ—Ç –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å**. –í –Ω–∞—à–µ–º –ø—Ä–æ–µ–∫—Ç–µ –∫–ª–∏–µ–Ω—Ç ‚Äî —ç—Ç–æ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ –Ω–∞ —Ç–µ–ª–µ—Ñ–æ–Ω–µ –∏–ª–∏ –≤ –±—Ä–∞—É–∑–µ—Ä–µ. –û–Ω–æ –æ—Ç–ø—Ä–∞–≤–ª—è–µ—Ç –∑–∞–ø—Ä–æ—Å—ã –Ω–∞ —Å–µ—Ä–≤–µ—Ä –∏ —Ä–∏—Å—É–µ—Ç –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å (–∫–Ω–æ–ø–∫–∏, –ø–æ–ª—è, —Å–æ–æ–±—â–µ–Ω–∏—è).
- **–ó–∞–ø—Ä–æ—Å –∏ –æ—Ç–≤–µ—Ç** ‚Äî –∫–ª–∏–µ–Ω—Ç –æ—Ç–ø—Ä–∞–≤–ª—è–µ—Ç **–∑–∞–ø—Ä–æ—Å** (–Ω–∞–ø—Ä–∏–º–µ—Ä: ¬´–ª–æ–≥–∏–Ω —Ç–∞–∫–æ–π-—Ç–æ, –ø–∞—Ä–æ–ª—å —Ç–∞–∫–æ–π-—Ç–æ¬ª). –°–µ—Ä–≤–µ—Ä –æ–±—Ä–∞–±–∞—Ç—ã–≤–∞–µ—Ç –µ–≥–æ –∏ –æ—Ç–ø—Ä–∞–≤–ª—è–µ—Ç **–æ—Ç–≤–µ—Ç** (–Ω–∞–ø—Ä–∏–º–µ—Ä: ¬´–≤—Ö–æ–¥ –≤—ã–ø–æ–ª–Ω–µ–Ω¬ª –∏–ª–∏ ¬´–æ—à–∏–±–∫–∞¬ª). –≠—Ç–æ –∫–∞–∫ –¥–∏–∞–ª–æ–≥: –≤–æ–ø—Ä–æ—Å ‚Äî –æ—Ç–≤–µ—Ç.

–î–∞–ª—å—à–µ –≤ —Ç–µ–∫—Å—Ç–µ –±—É–¥—É—Ç –≤—Å—Ç—Ä–µ—á–∞—Ç—å—Å—è —Ç–µ—Ä–º–∏–Ω—ã –≤—Ä–æ–¥–µ ¬´HTTP¬ª, ¬´JSON¬ª, ¬´—Ç–æ–∫–µ–Ω¬ª. –û–Ω–∏ –æ–±—ä—è—Å–Ω—è—é—Ç—Å—è –≤ –º–æ–º–µ–Ω—Ç –ø–µ—Ä–≤–æ–≥–æ –ø–æ—è–≤–ª–µ–Ω–∏—è –∏ –≤ –∫—Ä–∞—Ç–∫–æ–º —Å–ª–æ–≤–∞—Ä–∏–∫–µ –Ω–∏–∂–µ.

**–¢–µ–æ—Ä–∏—è (–æ–±—â–∏–π –∫–æ–Ω—Ç–µ–∫—Å—Ç).** –ü—Ä–æ–≥—Ä–∞–º–º–∞ –≤—ã–ø–æ–ª–Ω—è–µ—Ç—Å—è –Ω–∞ –ø—Ä–æ—Ü–µ—Å—Å–æ—Ä–µ: –æ–Ω–∞ —á–∏—Ç–∞–µ—Ç –∏–Ω—Å—Ç—Ä—É–∫—Ü–∏–∏ –∏–∑ –∫–æ–¥–∞ (—Ñ–∞–π–ª—ã —Å —Ç–µ–∫—Å—Ç–æ–º) –∏ –≤—ã–ø–æ–ª–Ω—è–µ—Ç –∏—Ö –ø–æ –ø–æ—Ä—è–¥–∫—É –∏–ª–∏ –ø–æ —É—Å–ª–æ–≤–∏—è–º. –°–µ—Ä–≤–µ—Ä–Ω–∞—è –ø—Ä–æ–≥—Ä–∞–º–º–∞ –ø–æ—Å–ª–µ –∑–∞–ø—É—Å–∫–∞ **–Ω–µ –∑–∞–≤–µ—Ä—à–∞–µ—Ç—Å—è**: –æ–Ω–∞ –≤—Ö–æ–¥–∏—Ç –≤ —Ü–∏–∫–ª ¬´–∂–¥–∞—Ç—å –∑–∞–ø—Ä–æ—Å ‚Äî –æ–±—Ä–∞–±–æ—Ç–∞—Ç—å ‚Äî –æ—Ç–≤–µ—Ç–∏—Ç—å ‚Äî –∂–¥–∞—Ç—å —Å–Ω–æ–≤–∞¬ª. –ö–ª–∏–µ–Ω—Ç—Å–∫–∞—è –ø—Ä–æ–≥—Ä–∞–º–º–∞ (–ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ –∏–ª–∏ —Å—Ç—Ä–∞–Ω–∏—Ü–∞ –≤ –±—Ä–∞—É–∑–µ—Ä–µ) —Ä–µ–∞–≥–∏—Ä—É–µ—Ç –Ω–∞ –¥–µ–π—Å—Ç–≤–∏—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è: –Ω–∞–∂–∞—Ç–∏—è, –≤–≤–æ–¥ —Ç–µ–∫—Å—Ç–∞ ‚Äî –∏ –≤ –æ—Ç–≤–µ—Ç –æ—Ç–ø—Ä–∞–≤–ª—è–µ—Ç –∑–∞–ø—Ä–æ—Å—ã –Ω–∞ —Å–µ—Ä–≤–µ—Ä –∏ –æ–±–Ω–æ–≤–ª—è–µ—Ç —Ç–æ, —á—Ç–æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –≤–∏–¥–∏—Ç –Ω–∞ —ç–∫—Ä–∞–Ω–µ. –°–µ—Ç—å —Å–≤—è–∑—ã–≤–∞–µ—Ç –∫–ª–∏–µ–Ω—Ç–∞ –∏ —Å–µ—Ä–≤–µ—Ä–∞: –∑–∞–ø—Ä–æ—Å –∏ –æ—Ç–≤–µ—Ç –ø–µ—Ä–µ–¥–∞—é—Ç—Å—è –ø–∞–∫–µ—Ç–∞–º–∏ –ø–æ –ø—Ä–æ—Ç–æ–∫–æ–ª–∞–º (HTTP, WebSocket). –ü–æ–Ω–∏–º–∞–Ω–∏–µ —ç—Ç–æ–π —Å—Ö–µ–º—ã –ø–æ–º–æ–≥–∞–µ—Ç –Ω–µ –ø—É—Ç–∞—Ç—å ¬´–≥–¥–µ —á—Ç–æ –≤—ã–ø–æ–ª–Ω—è–µ—Ç—Å—è¬ª: –ø—Ä–æ–≤–µ—Ä–∫–∞ –ø–∞—Ä–æ–ª—è –∏ —Ö—Ä–∞–Ω–µ–Ω–∏–µ –¥–∞–Ω–Ω—ã—Ö ‚Äî –Ω–∞ —Å–µ—Ä–≤–µ—Ä–µ; –æ—Ç—Ä–∏—Å–æ–≤–∫–∞ –∫–Ω–æ–ø–æ–∫ –∏ –ø–æ–ª–µ–π ‚Äî –Ω–∞ –∫–ª–∏–µ–Ω—Ç–µ.

---

## –ö—Ä–∞—Ç–∫–∏–π —Å–ª–æ–≤–∞—Ä–∏–∫ (–æ–¥–Ω–∏–º –ø—Ä–µ–¥–ª–æ–∂–µ–Ω–∏–µ–º)

| –¢–µ—Ä–º–∏–Ω | –ü—Ä–æ—Å—Ç–æ–µ –æ–±—ä—è—Å–Ω–µ–Ω–∏–µ |
|--------|---------------------|
| **–°–µ—Ä–≤–µ—Ä** | –ü—Ä–æ–≥—Ä–∞–º–º–∞, –∫–æ—Ç–æ—Ä–∞—è –∂–¥—ë—Ç –∑–∞–ø—Ä–æ—Å—ã –∏–∑ –∏–Ω—Ç–µ—Ä–Ω–µ—Ç–∞ –∏ –æ—Ç–≤–µ—á–∞–µ—Ç –Ω–∞ –Ω–∏—Ö. |
| **–ö–ª–∏–µ–Ω—Ç** | –ü—Ä–æ–≥—Ä–∞–º–º–∞ –∏–ª–∏ —Å–∞–π—Ç, —Å –∫–æ—Ç–æ—Ä–æ–π –≤—ã –≤–∑–∞–∏–º–æ–¥–µ–π—Å—Ç–≤—É–µ—Ç–µ; –æ–Ω–∞ –æ—Ç–ø—Ä–∞–≤–ª—è–µ—Ç –∑–∞–ø—Ä–æ—Å—ã —Å–µ—Ä–≤–µ—Ä—É. |
| **API** | –ù–∞–±–æ—Ä ¬´–ø—Ä–∞–≤–∏–ª¬ª, –ø–æ –∫–æ—Ç–æ—Ä—ã–º –∫–ª–∏–µ–Ω—Ç –æ–±—Ä–∞—â–∞–µ—Ç—Å—è –∫ —Å–µ—Ä–≤–µ—Ä—É (–∫–∞–∫–∏–µ –∞–¥—Ä–µ—Å–∞ –≤—ã–∑—ã–≤–∞—Ç—å, –≤ –∫–∞–∫–æ–º —Ñ–æ—Ä–º–∞—Ç–µ —Å–ª–∞—Ç—å –¥–∞–Ω–Ω—ã–µ). |
| **HTTP** | –ü—Ä–æ—Ç–æ–∫–æ–ª –æ–±–º–µ–Ω–∞ –¥–∞–Ω–Ω—ã–º–∏ –≤ –∏–Ω—Ç–µ—Ä–Ω–µ—Ç–µ: –∫–ª–∏–µ–Ω—Ç —à–ª—ë—Ç –∑–∞–ø—Ä–æ—Å (GET, POST –∏ —Ç.–¥.), —Å–µ—Ä–≤–µ—Ä –≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç –æ—Ç–≤–µ—Ç (–∫–æ–¥ 200, 401 –∏ —Ç.–¥.). |
| **JSON** | –¢–µ–∫—Å—Ç–æ–≤—ã–π —Ñ–æ—Ä–º–∞—Ç –¥–∞–Ω–Ω—ã—Ö: –ø–∞—Ä—ã ¬´–∫–ª—é—á ‚Äî –∑–Ω–∞—á–µ–Ω–∏–µ¬ª –≤ —Ñ–∏–≥—É—Ä–Ω—ã—Ö —Å–∫–æ–±–∫–∞—Ö. –ò —Å–µ—Ä–≤–µ—Ä, –∏ –∫–ª–∏–µ–Ω—Ç –ø–æ–Ω–∏–º–∞—é—Ç JSON. |
| **–¢–æ–∫–µ–Ω** | ¬´–ü—Ä–æ–ø—É—Å–∫¬ª –ø–æ—Å–ª–µ –≤—Ö–æ–¥–∞: —Å—Ç—Ä–æ–∫–∞, –∫–æ—Ç–æ—Ä—É—é –∫–ª–∏–µ–Ω—Ç –æ—Ç–ø—Ä–∞–≤–ª—è–µ—Ç —Å –∫–∞–∂–¥—ã–º –∑–∞–ø—Ä–æ—Å–æ–º, —á—Ç–æ–±—ã —Å–µ—Ä–≤–µ—Ä –ø–æ–Ω—è–ª, –∫—Ç–æ –≤—ã. |
| **–ë–î (–±–∞–∑–∞ –¥–∞–Ω–Ω—ã—Ö)** | –ú–µ—Å—Ç–æ, –≥–¥–µ —Å–µ—Ä–≤–µ—Ä —Ö—Ä–∞–Ω–∏—Ç –¥–∞–Ω–Ω—ã–µ –Ω–∞–¥–æ–ª–≥–æ (–ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–∏, —Å–æ–æ–±—â–µ–Ω–∏—è, —á–∞—Ç—ã). –í –ø—Ä–æ–µ–∫—Ç–µ ‚Äî PostgreSQL. |
| **–í–∏–¥–∂–µ—Ç** | ¬´–ö–∏—Ä–ø–∏—á–∏–∫¬ª –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å–∞ –≤–æ Flutter: –∫–Ω–æ–ø–∫–∞, –ø–æ–ª–µ –≤–≤–æ–¥–∞, —ç–∫—Ä–∞–Ω ‚Äî –≤—Å—ë —ç—Ç–æ –≤–∏–¥–∂–µ—Ç—ã. |
| **–†–æ—É—Ç / –º–∞—Ä—à—Ä—É—Ç** | –ü—Ä–∞–≤–∏–ª–æ –≤–∏–¥–∞: ¬´–µ—Å–ª–∏ –ø—Ä–∏—à—ë–ª –∑–∞–ø—Ä–æ—Å –Ω–∞ —Ç–∞–∫–æ–π-—Ç–æ –∞–¥—Ä–µ—Å –∏ –º–µ—Ç–æ–¥ ‚Äî –≤—ã–∑–≤–∞—Ç—å —Ç–∞–∫—É—é-—Ç–æ —Ñ—É–Ω–∫—Ü–∏—é¬ª. |

–ï—Å–ª–∏ –≤—Å—Ç—Ä–µ—Ç–∏—Ç–µ –Ω–µ–∑–Ω–∞–∫–æ–º–æ–µ —Å–ª–æ–≤–æ ‚Äî –º–æ–∂–Ω–æ –≤–µ—Ä–Ω—É—Ç—å—Å—è –∫ —ç—Ç–æ–º—É —Å–ø–∏—Å–∫—É –∏–ª–∏ –ø–æ–∏—Å–∫–∞—Ç—å –µ–≥–æ –≤ —Ç–µ–∫—Å—Ç–µ (–º—ã –æ–±—ä—è—Å–Ω—è–µ–º —Ç–µ—Ä–º–∏–Ω—ã –ø—Ä–∏ –ø–µ—Ä–≤–æ–º –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–∏).

---

## –û–≥–ª–∞–≤–ª–µ–Ω–∏–µ

- [–î–ª—è –∫–æ–≥–æ —ç—Ç–æ—Ç —É—á–µ–±–Ω–∏–∫](#–¥–ª—è-–∫–æ–≥–æ-—ç—Ç–æ—Ç-—É—á–µ–±–Ω–∏–∫)
- [–ú–∏–Ω–∏–º—É–º –ø–µ—Ä–µ–¥ –Ω–∞—á–∞–ª–æ–º (–ø—Ä–æ—Å—Ç—ã–º–∏ —Å–ª–æ–≤–∞–º–∏)](#–º–∏–Ω–∏–º—É–º-–ø–µ—Ä–µ–¥-–Ω–∞—á–∞–ª–æ–º-–ø—Ä–æ—Å—Ç—ã–º–∏-—Å–ª–æ–≤–∞–º–∏)
- [–ö—Ä–∞—Ç–∫–∏–π —Å–ª–æ–≤–∞—Ä–∏–∫](#–∫—Ä–∞—Ç–∫–∏–π-—Å–ª–æ–≤–∞—Ä–∏–∫-–æ–¥–Ω–∏–º-–ø—Ä–µ–¥–ª–æ–∂–µ–Ω–∏–µ–º)
1. [–û–±–∑–æ—Ä –ø—Ä–æ–µ–∫—Ç–∞](#1-–æ–±–∑–æ—Ä-–ø—Ä–æ–µ–∫—Ç–∞)
2. [–ß–∞—Å—Ç—å I: –°–µ—Ä–≤–µ—Ä (Node.js / Express)](#2-—á–∞—Å—Ç—å-i-—Å–µ—Ä–≤–µ—Ä-nodejs--express)
3. [–ß–∞—Å—Ç—å II: –ö–ª–∏–µ–Ω—Ç (Flutter / Dart)](#3-—á–∞—Å—Ç—å-ii-–∫–ª–∏–µ–Ω—Ç-flutter--dart)
4. [–ö–∞–∫ –∫–ª–∏–µ–Ω—Ç –∏ —Å–µ—Ä–≤–µ—Ä —Å–≤—è–∑–∞–Ω—ã](#4-–∫–∞–∫-–∫–ª–∏–µ–Ω—Ç-–∏-—Å–µ—Ä–≤–µ—Ä-—Å–≤—è–∑–∞–Ω—ã)
5. [–ü–æ—Ä—è–¥–æ–∫ –∏–∑—É—á–µ–Ω–∏—è –∫–æ–¥–∞](#5-–ø–æ—Ä—è–¥–æ–∫-–∏–∑—É—á–µ–Ω–∏—è-–∫–æ–¥–∞)
6. [–ë—ã—Å—Ç—Ä—ã–π —Å—Ç–∞—Ä—Ç](#6-–±—ã—Å—Ç—Ä—ã–π-—Å—Ç–∞—Ä—Ç)

---

## 1. –û–±–∑–æ—Ä –ø—Ä–æ–µ–∫—Ç–∞

**–ü—Ä–æ—Å—Ç—ã–º–∏ —Å–ª–æ–≤–∞–º–∏:** –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ —Å–æ—Å—Ç–æ–∏—Ç –∏–∑ –¥–≤—É—Ö —á–∞—Å—Ç–µ–π. –û–¥–Ω–∞ —á–∞—Å—Ç—å (—Å–µ—Ä–≤–µ—Ä) –∂–∏–≤—ë—Ç –Ω–∞ –∫–æ–º–ø—å—é—Ç–µ—Ä–µ –≤ –∏–Ω—Ç–µ—Ä–Ω–µ—Ç–µ –∏ —Ö—Ä–∞–Ω–∏—Ç –¥–∞–Ω–Ω—ã–µ, –æ–±—Ä–∞–±–∞—Ç—ã–≤–∞–µ—Ç –≤—Ö–æ–¥ –∏ —Å–æ–æ–±—â–µ–Ω–∏—è. –î—Ä—É–≥–∞—è —á–∞—Å—Ç—å (–∫–ª–∏–µ–Ω—Ç) ‚Äî —ç—Ç–æ —Ç–æ, —á—Ç–æ –≤—ã –æ—Ç–∫—Ä—ã–≤–∞–µ—Ç–µ –Ω–∞ —Ç–µ–ª–µ—Ñ–æ–Ω–µ –∏–ª–∏ –≤ –±—Ä–∞—É–∑–µ—Ä–µ: —ç–∫—Ä–∞–Ω—ã –≤—Ö–æ–¥–∞, —á–∞—Ç—ã, –∫–Ω–æ–ø–∫–∏. –û–Ω–∏ –æ–±—â–∞—é—Ç—Å—è –ø–æ –∏–Ω—Ç–µ—Ä–Ω–µ—Ç—É: –∫–ª–∏–µ–Ω—Ç —à–ª—ë—Ç –∑–∞–ø—Ä–æ—Å—ã, —Å–µ—Ä–≤–µ—Ä –æ—Ç–≤–µ—á–∞–µ—Ç.

**–¢–µ–æ—Ä–∏—è.** –°–æ–≤—Ä–µ–º–µ–Ω–Ω—ã–µ –≤–µ–±- –∏ –º–æ–±–∏–ª—å–Ω—ã–µ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è —á–∞—â–µ –≤—Å–µ–≥–æ —Å—Ç—Ä–æ—è—Ç—Å—è –ø–æ —Å—Ö–µ–º–µ **–∫–ª–∏–µ–Ω—Ç ‚Äî —Å–µ—Ä–≤–µ—Ä**. –°–µ—Ä–≤–µ—Ä ‚Äî —ç—Ç–æ –ø—Ä–æ–≥—Ä–∞–º–º–∞, –∫–æ—Ç–æ—Ä–∞—è –∫—Ä—É–≥–ª–æ—Å—É—Ç–æ—á–Ω–æ —Ä–∞–±–æ—Ç–∞–µ—Ç –Ω–∞ –∫–æ–º–ø—å—é—Ç–µ—Ä–µ —Å –ø–æ—Å—Ç–æ—è–Ω–Ω—ã–º –¥–æ—Å—Ç—É–ø–æ–º –≤ –∏–Ω—Ç–µ—Ä–Ω–µ—Ç (–∏–ª–∏ –≤ –æ–±–ª–∞–∫–µ). –û–Ω–∞ —Ö—Ä–∞–Ω–∏—Ç –¥–∞–Ω–Ω—ã–µ (–±–∞–∑–∞ –¥–∞–Ω–Ω—ã—Ö), –ø—Ä–æ–≤–µ—Ä—è–µ—Ç –ø—Ä–∞–≤–∞ –¥–æ—Å—Ç—É–ø–∞ –∏ –æ–±—Ä–∞–±–∞—Ç—ã–≤–∞–µ—Ç –±–∏–∑–Ω–µ—Å-–ª–æ–≥–∏–∫—É. –ö–ª–∏–µ–Ω—Ç ‚Äî —ç—Ç–æ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ –Ω–∞ —É—Å—Ç—Ä–æ–π—Å—Ç–≤–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è (–±—Ä–∞—É–∑–µ—Ä, —Ç–µ–ª–µ—Ñ–æ–Ω): –æ–Ω–æ —Ç–æ–ª—å–∫–æ –ø–æ–∫–∞–∑—ã–≤–∞–µ—Ç –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å –∏ –æ—Ç–ø—Ä–∞–≤–ª—è–µ—Ç –∑–∞–ø—Ä–æ—Å—ã –Ω–∞ —Å–µ—Ä–≤–µ—Ä. –¢–∞–∫ –º—ã –¥–æ—Å—Ç–∏–≥–∞–µ–º –Ω–µ—Å–∫–æ–ª—å–∫–∏—Ö —Ü–µ–ª–µ–π: –¥–∞–Ω–Ω—ã–µ —Ö—Ä–∞–Ω—è—Ç—Å—è –≤ –æ–¥–Ω–æ–º –º–µ—Å—Ç–µ –∏ –¥–æ—Å—Ç—É–ø–Ω—ã —Å –ª—é–±–æ–≥–æ —É—Å—Ç—Ä–æ–π—Å—Ç–≤–∞; –ª–æ–≥–∏–∫—É –∏ –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å –ø—Ä–æ—â–µ –∫–æ–Ω—Ç—Ä–æ–ª–∏—Ä–æ–≤–∞—Ç—å –Ω–∞ —Å–µ—Ä–≤–µ—Ä–µ; –∫–ª–∏–µ–Ω—Ç –º–æ–∂–Ω–æ –æ–±–Ω–æ–≤–ª—è—Ç—å –æ—Ç–¥–µ–ª—å–Ω–æ (–Ω–∞–ø—Ä–∏–º–µ—Ä, —Ç–æ–ª—å–∫–æ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ, –±–µ–∑ —Å–º–µ–Ω—ã —Å–µ—Ä–≤–µ—Ä–∞). –í –Ω–∞—à–µ–º –ø—Ä–æ–µ–∫—Ç–µ —Å–µ—Ä–≤–µ—Ä –Ω–∞–ø–∏—Å–∞–Ω –Ω–∞ **Node.js** (JavaScript –Ω–∞ —Å–µ—Ä–≤–µ—Ä–µ) —Å —Ñ—Ä–µ–π–º–≤–æ—Ä–∫–æ–º **Express**, –±–∞–∑–∞ –¥–∞–Ω–Ω—ã—Ö ‚Äî **PostgreSQL**. –ö–ª–∏–µ–Ω—Ç ‚Äî –Ω–∞ **Flutter** (—è–∑—ã–∫ **Dart**), –æ–¥–∏–Ω –∫–æ–¥ —Å–æ–±–∏—Ä–∞–µ—Ç—Å—è –ø–æ–¥ web –∏ iOS.

–ü—Ä–∏–ª–æ–∂–µ–Ω–∏–µ ‚Äî **—á–∞—Ç + —É—á—ë—Ç –∑–∞–Ω—è—Ç–∏–π**. –î–≤–µ —á–∞—Å—Ç–∏:

| –ß–∞—Å—Ç—å | –¢–µ—Ö–Ω–æ–ª–æ–≥–∏–∏ | –ü–∞–ø–∫–∞ |
|-------|------------|--------|
| **–°–µ—Ä–≤–µ—Ä** | Node.js, Express, PostgreSQL, WebSocket | `my_serve_chat_test/` |
| **–ö–ª–∏–µ–Ω—Ç** | Flutter (Dart), web + iOS | –∫–æ—Ä–µ–Ω—å: `lib/`, `pubspec.yaml` |

–°—Ç—Ä—É–∫—Ç—É—Ä–∞:

```
my_chat_app/
‚îú‚îÄ‚îÄ lib/                    # Flutter: —ç–∫—Ä–∞–Ω—ã, —Å–µ—Ä–≤–∏—Å—ã, –º–æ–¥–µ–ª–∏
‚îÇ   ‚îú‚îÄ‚îÄ main.dart
‚îÇ   ‚îú‚îÄ‚îÄ config/
‚îÇ   ‚îú‚îÄ‚îÄ models/
‚îÇ   ‚îú‚îÄ‚îÄ screens/
‚îÇ   ‚îú‚îÄ‚îÄ services/
‚îÇ   ‚îî‚îÄ‚îÄ utils/
‚îî‚îÄ‚îÄ my_serve_chat_test/     # Node.js: API –∏ WebSocket
    ‚îú‚îÄ‚îÄ index.js
    ‚îú‚îÄ‚îÄ db.js
    ‚îú‚îÄ‚îÄ routes/
    ‚îú‚îÄ‚îÄ controllers/
    ‚îú‚îÄ‚îÄ middleware/
    ‚îî‚îÄ‚îÄ websocket/
```

---

## 2. –ß–∞—Å—Ç—å I: –°–µ—Ä–≤–µ—Ä (Node.js / Express)

### 2.1. –¢–æ—á–∫–∞ –≤—Ö–æ–¥–∞: `index.js` ‚Äî —Å–æ–∑–¥–∞–Ω–∏–µ Express-–ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è

**–ü—Ä–æ—Å—Ç—ã–º–∏ —Å–ª–æ–≤–∞–º–∏:** —ç—Ç–æ—Ç —Ñ–∞–π–ª ‚Äî ¬´–≥–ª–∞–≤–Ω—ã–π –≤—ã–∫–ª—é—á–∞—Ç–µ–ª—å¬ª —Å–µ—Ä–≤–µ—Ä–∞. –û–Ω —Å–æ–∑–¥–∞—ë—Ç –ø—Ä–æ–≥—Ä–∞–º–º—É, –∫–æ—Ç–æ—Ä–∞—è —Å–ª—É—à–∞–µ—Ç –∏–Ω—Ç–µ—Ä–Ω–µ—Ç (–Ω–∞ –ø–æ—Ä—Ç—É), –ø—Ä–∏–Ω–∏–º–∞–µ—Ç –∑–∞–ø—Ä–æ—Å—ã –∏ —Ä–∞–∑–¥–∞—ë—Ç –∏—Ö –ø–æ –ø—Ä–∞–≤–∏–ª–∞–º: –æ–¥–Ω–∏ –∑–∞–ø—Ä–æ—Å—ã ‚Äî –Ω–∞ –≤—Ö–æ–¥/—Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—é, –¥—Ä—É–≥–∏–µ ‚Äî –Ω–∞ —á–∞—Ç—ã, —Ç—Ä–µ—Ç—å–∏ ‚Äî –Ω–∞ –∂–∏–≤–æ–µ —Å–æ–µ–¥–∏–Ω–µ–Ω–∏–µ –¥–ª—è —Å–æ–æ–±—â–µ–Ω–∏–π –≤ —Ä–µ–∞–ª—å–Ω–æ–º –≤—Ä–µ–º–µ–Ω–∏.

**–ß—Ç–æ –¥–µ–ª–∞–µ—Ç:** —Å–æ–∑–¥–∞—ë—Ç HTTP-—Å–µ—Ä–≤–µ—Ä, –Ω–∞—Å—Ç—Ä–∞–∏–≤–∞–µ—Ç –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å (CORS, –∑–∞–≥–æ–ª–æ–≤–∫–∏), –ø–æ–¥–∫–ª—é—á–∞–µ—Ç —Ä–æ—É—Ç—ã –∏ WebSocket, –∑–∞–ø—É—Å–∫–∞–µ—Ç —Å–ª—É—à–∞—Ç–µ–ª—å –Ω–∞ –ø–æ—Ä—Ç—É.

**–ö–∞–∫ —Ä–∞–±–æ—Ç–∞–µ—Ç:** Express ‚Äî —ç—Ç–æ –≥–æ—Ç–æ–≤—ã–π –Ω–∞–±–æ—Ä –∏–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç–æ–≤ –¥–ª—è —Å–æ–∑–¥–∞–Ω–∏—è —Å–µ—Ä–≤–µ—Ä–∞ (–ø—Ä–æ–≥—Ä–∞–º–º—ã, –ø—Ä–∏–Ω–∏–º–∞—é—â–µ–π –∑–∞–ø—Ä–æ—Å—ã –ø–æ –∏–Ω—Ç–µ—Ä–Ω–µ—Ç—É). `express()` —Å–æ–∑–¥–∞—ë—Ç –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ, `http.createServer(app)` ‚Äî —Å–∞–º —Å–µ—Ä–≤–µ—Ä. –û–¥–∏–Ω –∏ —Ç–æ—Ç –∂–µ `server` –æ–±—Å–ª—É–∂–∏–≤–∞–µ—Ç –∏ –æ–±—ã—á–Ω—ã–µ –∑–∞–ø—Ä–æ—Å—ã (–ª–æ–≥–∏–Ω, —á–∞—Ç—ã), –∏ –∂–∏–≤–æ–µ —Å–æ–µ–¥–∏–Ω–µ–Ω–∏–µ WebSocket.

**–¢–µ–æ—Ä–∏—è.** **Node.js** ‚Äî —ç—Ç–æ —Å—Ä–µ–¥–∞ –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è JavaScript –≤–Ω–µ –±—Ä–∞—É–∑–µ—Ä–∞: –≤—ã –ø–∏—à–µ—Ç–µ –∫–æ–¥ –Ω–∞ JavaScript, –∏ –æ–Ω –≤—ã–ø–æ–ª–Ω—è–µ—Ç—Å—è –Ω–∞ —Å–µ—Ä–≤–µ—Ä–µ. –¢–∞–∫ –æ–¥–∏–Ω —è–∑—ã–∫ –º–æ–∂–Ω–æ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å –∏ –¥–ª—è —Ñ—Ä–æ–Ω—Ç–µ–Ω–¥–∞, –∏ –¥–ª—è –±—ç–∫–µ–Ω–¥–∞. **HTTP-—Å–µ—Ä–≤–µ—Ä** ‚Äî –ø—Ä–æ–≥—Ä–∞–º–º–∞, –∫–æ—Ç–æ—Ä–∞—è ¬´—Å–ª—É—à–∞–µ—Ç¬ª –æ–ø—Ä–µ–¥–µ–ª—ë–Ω–Ω—ã–π **–ø–æ—Ä—Ç** (—á–∏—Å–ª–æ, –Ω–∞–ø—Ä–∏–º–µ—Ä 3000). –ü–æ—Ä—Ç ‚Äî —ç—Ç–æ –∫–∞–∫ –Ω–æ–º–µ—Ä –¥–≤–µ—Ä–∏ –Ω–∞ –æ–¥–Ω–æ–º –∫–æ–º–ø—å—é—Ç–µ—Ä–µ: –ø–æ –æ–¥–Ω–æ–º—É IP-–∞–¥—Ä–µ—Å—É –º–æ–∂–µ—Ç —Ä–∞–±–æ—Ç–∞—Ç—å –º–Ω–æ–≥–æ —Å–µ—Ä–≤–∏—Å–æ–≤, –∫–∞–∂–¥—ã–π –Ω–∞ —Å–≤–æ—ë–º –ø–æ—Ä—Ç—É. –ö–æ–≥–¥–∞ –∫–ª–∏–µ–Ω—Ç –æ—Ç–ø—Ä–∞–≤–ª—è–µ—Ç –∑–∞–ø—Ä–æ—Å –Ω–∞ `http://example.com:3000/auth/login`, –∑–∞–ø—Ä–æ—Å –ø–æ–ø–∞–¥–∞–µ—Ç –≤ –ø—Ä–æ–≥—Ä–∞–º–º—É, —Å–ª—É—à–∞—é—â—É—é –ø–æ—Ä—Ç 3000. **Express** ‚Äî —Ñ—Ä–µ–π–º–≤–æ—Ä–∫ –ø–æ–≤–µ—Ä—Ö –≤—Å—Ç—Ä–æ–µ–Ω–Ω–æ–≥–æ –≤ Node.js –º–æ–¥—É–ª—è `http`: –æ–Ω —É–ø—Ä–æ—â–∞–µ—Ç –º–∞—Ä—à—Ä—É—Ç–∏–∑–∞—Ü–∏—é (–ø—Ä–∏–≤—è–∑–∫—É URL –∫ —Ñ—É–Ω–∫—Ü–∏—è–º), —Ä–∞–∑–±–æ—Ä —Ç–µ–ª–∞ –∑–∞–ø—Ä–æ—Å–∞, –æ—Ç–ø—Ä–∞–≤–∫—É JSON –∏ –ø–æ–¥–∫–ª—é—á–µ–Ω–∏–µ –ø—Ä–æ–º–µ–∂—É—Ç–æ—á–Ω—ã—Ö –æ–±—Ä–∞–±–æ—Ç—á–∏–∫–æ–≤ (middleware). –ë–µ–∑ Express –ø—Ä–∏—à–ª–æ—Å—å –±—ã –≤—Ä—É—á–Ω—É—é —Ä–∞–∑–±–∏—Ä–∞—Ç—å URL –∏ –≤–µ—Ç–≤–∏—Ç—å –ª–æ–≥–∏–∫—É. **CORS** (Cross-Origin Resource Sharing) ‚Äî –º–µ—Ö–∞–Ω–∏–∑–º –±—Ä–∞—É–∑–µ—Ä–∞: –∑–∞–ø—Ä–æ—Å—ã —Å –æ–¥–Ω–æ–≥–æ –¥–æ–º–µ–Ω–∞ (–Ω–∞–ø—Ä–∏–º–µ—Ä, —Å —Å–∞–π—Ç–∞ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è) –Ω–∞ –¥—Ä—É–≥–æ–π (API-—Å–µ—Ä–≤–µ—Ä) –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é –º–æ–≥—É—Ç –±–ª–æ–∫–∏—Ä–æ–≤–∞—Ç—å—Å—è; –∑–∞–≥–æ–ª–æ–≤–∫–∏ CORS –≥–æ–≤–æ—Ä—è—Ç –±—Ä–∞—É–∑–µ—Ä—É, —á—Ç–æ —Å–µ—Ä–≤–µ—Ä —Ä–∞–∑—Ä–µ—à–∞–µ—Ç —Ç–∞–∫–∏–µ –∑–∞–ø—Ä–æ—Å—ã.

**–°–∏–Ω—Ç–∞–∫—Å–∏—Å –∏ –∫–æ–Ω—Ü–µ–ø—Ü–∏–∏:**

- **`import ... from '...'`** ‚Äî –ø–æ–¥–∫–ª—é—á–∞–µ—Ç –∫–æ–¥ –∏–∑ –¥—Ä—É–≥–æ–≥–æ —Ñ–∞–π–ª–∞. –¢–∞–∫ –º—ã ¬´–ø–æ–¥—Ç—è–≥–∏–≤–∞–µ–º¬ª —Ñ—É–Ω–∫—Ü–∏–∏ –∏ –æ–±—ä–µ–∫—Ç—ã, —á—Ç–æ–±—ã –Ω–µ –ø–∏—Å–∞—Ç—å –≤—Å—ë –≤ –æ–¥–Ω–æ–º —Ñ–∞–π–ª–µ.
- **`dotenv.config()`** ‚Äî —á–∏—Ç–∞–µ—Ç —Ñ–∞–π–ª `.env` (–≤ –Ω—ë–º —Ö—Ä–∞–Ω—è—Ç—Å—è –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ –≤—Ä–æ–¥–µ –ø–æ—Ä—Ç–∞ –∏ –∞–¥—Ä–µ—Å–∞ –±–∞–∑—ã) –∏ –¥–µ–ª–∞–µ—Ç –∏—Ö –¥–æ—Å—Ç—É–ø–Ω—ã–º–∏ –≤ –∫–æ–¥–µ –∫–∞–∫ `process.env.PORT`, `process.env.DATABASE_URL` –∏ —Ç.–¥.
- **`const app = express()`** ‚Äî —Å–æ–∑–¥–∞—ë—Ç –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ —Å–µ—Ä–≤–µ—Ä–∞. `app` ‚Äî –æ–±—ä–µ–∫—Ç, —É –∫–æ—Ç–æ—Ä–æ–≥–æ –µ—Å—Ç—å –º–µ—Ç–æ–¥—ã: –∑–∞—Ä–µ–≥–∏—Å—Ç—Ä–∏—Ä–æ–≤–∞—Ç—å –æ—Ç–≤–µ—Ç –Ω–∞ GET-–∑–∞–ø—Ä–æ—Å (`get`), –Ω–∞ POST (`post`), –ø–æ–¥–∫–ª—é—á–∏—Ç—å –æ–±—â—É—é –æ–±—Ä–∞–±–æ—Ç–∫—É (`use`) –∏ —Ç.–¥.
- **`app.use(...)`** ‚Äî –ø–æ–¥–∫–ª—é—á–∞–µ—Ç –æ–±—â–∏–π –æ–±—Ä–∞–±–æ—Ç—á–∏–∫ –∏–ª–∏ –Ω–∞–±–æ—Ä –ø—Ä–∞–≤–∏–ª (—Ä–æ—É—Ç–µ—Ä) –¥–ª—è –∑–∞–ø—Ä–æ—Å–æ–≤ –ø–æ –æ–ø—Ä–µ–¥–µ–ª—ë–Ω–Ω–æ–º—É –ø—É—Ç–∏ (–∏–ª–∏ –¥–ª—è –≤—Å–µ—Ö –∑–∞–ø—Ä–æ—Å–æ–≤, –µ—Å–ª–∏ –ø—É—Ç—å –Ω–µ —É–∫–∞–∑–∞–Ω).
- **`app.get('/healthz', ...)`** ‚Äî –≥–æ–≤–æ—Ä–∏—Ç: ¬´–∫–æ–≥–¥–∞ –ø—Ä–∏–¥—ë—Ç –∑–∞–ø—Ä–æ—Å —Ç–∏–ø–∞ GET –Ω–∞ –∞–¥—Ä–µ—Å /healthz, –≤—ã–∑–æ–≤–∏ —ç—Ç—É —Ñ—É–Ω–∫—Ü–∏—é¬ª. –ü–µ—Ä–≤—ã–π –∞—Ä–≥—É–º–µ–Ω—Ç ‚Äî –ø—É—Ç—å, –≤—Ç–æ—Ä–æ–π ‚Äî —Ñ—É–Ω–∫—Ü–∏—è, –∫–æ—Ç–æ—Ä–∞—è –ø–æ–ª—É—á–∞–µ—Ç –∑–∞–ø—Ä–æ—Å (`req`) –∏ –æ—Ç–ø—Ä–∞–≤–ª—è–µ—Ç –æ—Ç–≤–µ—Ç (`res`).
- **`res.status(200).send('ok')`** ‚Äî –æ—Ç–ø—Ä–∞–≤–ª—è–µ—Ç –æ—Ç–≤–µ—Ç –∫–ª–∏–µ–Ω—Ç—É: –∫–æ–¥ 200 (¬´–≤—Å—ë —Ö–æ—Ä–æ—à–æ¬ª) –∏ —Ç–µ–∫—Å—Ç ¬´ok¬ª.
- **`server.listen(PORT, callback)`** ‚Äî –∑–∞–ø—É—Å–∫–∞–µ—Ç —Å–µ—Ä–≤–µ—Ä –Ω–∞ —É–∫–∞–∑–∞–Ω–Ω–æ–º –ø–æ—Ä—Ç—É. –ö–æ–≥–¥–∞ —Å–µ—Ä–≤–µ—Ä –≥–æ—Ç–æ–≤ –ø—Ä–∏–Ω–∏–º–∞—Ç—å –∑–∞–ø—Ä–æ—Å—ã, –≤—ã–∑—ã–≤–∞–µ—Ç—Å—è —Ñ—É–Ω–∫—Ü–∏—è `callback` (–Ω–∞–ø—Ä–∏–º–µ—Ä, —á—Ç–æ–±—ã –≤—ã–≤–µ—Å—Ç–∏ –≤ –∫–æ–Ω—Å–æ–ª—å ¬´—Å–µ—Ä–≤–µ—Ä –∑–∞–ø—É—â–µ–Ω¬ª).

**–ö–æ–¥ –∏–∑ –ø—Ä–æ–µ–∫—Ç–∞.** –§–∞–π–ª: `my_serve_chat_test/index.js`

```javascript
import express from 'express';
import http from 'http';
import dotenv from 'dotenv';
import authRoutes from './routes/auth.js';
import { setupWebSocket } from './websocket/websocket.js';

dotenv.config();

const app = express();
const server = http.createServer(app);

// –ü—Ä–æ—Å—Ç–æ–π endpoint –±–µ–∑ –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏–∏
app.get('/healthz', (req, res) => {
  res.status(200).send('ok');
});

// –ü–æ–¥–∫–ª—é—á–µ–Ω–∏–µ —Ä–æ—É—Ç–æ–≤: –ø—Ä–µ—Ñ–∏–∫—Å + —Ä–æ—É—Ç–µ—Ä
app.use('/auth', authRoutes);
app.use('/chats', chatRoutes);
app.use('/messages', messageRoutes);
// ...

// WebSocket –≤–µ—à–∞–µ—Ç—Å—è –Ω–∞ —Ç–æ—Ç –∂–µ server
setupWebSocket(server);

const PORT = process.env.PORT || 3000;
server.listen(PORT, () => {
  console.log(`üöÄ Server running on port ${PORT}`);
});
```

**–ß—Ç–æ –Ω—É–∂–Ω–æ –∑–Ω–∞—Ç—å:** –±–∞–∑–æ–≤—ã–π JavaScript (–ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ, —Ñ—É–Ω–∫—Ü–∏–∏, –æ–±—ä–µ–∫—Ç—ã), —á—Ç–æ —Ç–∞–∫–æ–µ HTTP-–∑–∞–ø—Ä–æ—Å—ã (GET, POST), —á—Ç–æ —Ç–∞–∫–æ–µ –ø–æ—Ä—Ç (–Ω–æ–º–µ—Ä ¬´–≤—Ö–æ–¥–∞¬ª –Ω–∞ —Å–µ—Ä–≤–µ—Ä–µ, –ø–æ –∫–æ—Ç–æ—Ä–æ–º—É —Å—Ç—É—á–∞—Ç—Å—è –∫–ª–∏–µ–Ω—Ç—ã) –∏ —á—Ç–æ —Ç–∞–∫–æ–µ —Å–µ—Ä–≤–µ—Ä (—Å–º. —Å–ª–æ–≤–∞—Ä–∏–∫ –≤—ã—à–µ).

---

### 2.2. –†–æ—É—Ç—ã: –∫–∞–∫ –ø—É—Ç—å –≤–µ–¥—ë—Ç –≤ –∫–æ–Ω—Ç—Ä–æ–ª–ª–µ—Ä

**–ü—Ä–æ—Å—Ç—ã–º–∏ —Å–ª–æ–≤–∞–º–∏:** —Ä–æ—É—Ç—ã ‚Äî —ç—Ç–æ ¬´—Ç–∞–±–ª–∏—Ü–∞ –∞–¥—Ä–µ—Å–æ–≤¬ª: –∫–∞–∫–æ–π –∑–∞–ø—Ä–æ—Å –∫—É–¥–∞ –≤–µ—Å—Ç–∏. –ù–∞–ø—Ä–∏–º–µ—Ä: ¬´–µ—Å–ª–∏ –ø—Ä–∏—à—ë–ª POST –Ω–∞ /auth/register ‚Äî –≤—ã–∑–≤–∞—Ç—å —Ñ—É–Ω–∫—Ü–∏—é —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏–∏¬ª. –î–ª—è –Ω–µ–∫–æ—Ç–æ—Ä—ã—Ö –∞–¥—Ä–µ—Å–æ–≤ –ø–µ—Ä–µ–¥ –æ—Å–Ω–æ–≤–Ω–æ–π —Ñ—É–Ω–∫—Ü–∏–µ–π –∑–∞–ø—É—Å–∫–∞–µ—Ç—Å—è –ø—Ä–æ–≤–µ—Ä–∫–∞ (–Ω–∞–ø—Ä–∏–º–µ—Ä, –ø—Ä–æ–≤–µ—Ä–∫–∞ —Ç–æ–∫–µ–Ω–∞ –≤—Ö–æ–¥–∞); —Ç–∞–∫–∞—è –ø—Ä–æ–≤–µ—Ä–∫–∞ –Ω–∞–∑—ã–≤–∞–µ—Ç—Å—è middleware.

**–ß—Ç–æ –¥–µ–ª–∞–µ—Ç:** —Ä–æ—É—Ç–µ—Ä ‚Äî —ç—Ç–æ –Ω–∞–±–æ—Ä –ø—Ä–∞–≤–∏–ª ¬´–ø—É—Ç—å + –º–µ—Ç–æ–¥ HTTP ‚Üí —Ñ—É–Ω–∫—Ü–∏—è-–æ–±—Ä–∞–±–æ—Ç—á–∏–∫¬ª. –ó–∞—â–∏—â—ë–Ω–Ω—ã–µ –º–∞—Ä—à—Ä—É—Ç—ã —Å–Ω–∞—á–∞–ª–∞ –ø—Ä–æ–≥–æ–Ω—è—é—Ç –∑–∞–ø—Ä–æ—Å —á–µ—Ä–µ–∑ **middleware** (–Ω–∞–ø—Ä–∏–º–µ—Ä, –ø—Ä–æ–≤–µ—Ä–∫–∞ JWT), –ø–æ—Ç–æ–º –≤—ã–∑—ã–≤–∞—é—Ç **–∫–æ–Ω—Ç—Ä–æ–ª–ª–µ—Ä**.

**–ö–∞–∫ —Ä–∞–±–æ—Ç–∞–µ—Ç:** `express.Router()` —Å–æ–∑–¥–∞—ë—Ç —Ä–æ—É—Ç–µ—Ä ‚Äî –æ–±—ä–µ–∫—Ç —Å –ø—Ä–∞–≤–∏–ª–∞–º–∏. –£ –Ω–µ–≥–æ —Ç–µ –∂–µ –º–µ—Ç–æ–¥—ã, —á—Ç–æ —É `app` (`get`, `post`, `use`), –Ω–æ –æ–Ω –Ω–µ –∑–∞–ø—É—Å–∫–∞–µ—Ç —Å–µ—Ä–≤–µ—Ä, –∞ —Ç–æ–ª—å–∫–æ –æ–ø–∏—Å—ã–≤–∞–µ—Ç: ¬´–Ω–∞ —Ç–∞–∫–æ–π –ø—É—Ç—å ‚Äî —Ç–∞–∫–∞—è —Ñ—É–Ω–∫—Ü–∏—è¬ª. –í `index.js` —Ä–æ—É—Ç–µ—Ä –ø–æ–¥–∫–ª—é—á–∞–µ—Ç—Å—è —á–µ—Ä–µ–∑ `app.use('/auth', authRoutes)`, –∏ –≤—Å–µ –ø—É—Ç–∏ –∏–∑ —Ä–æ—É—Ç–µ—Ä–∞ –ø–æ–ª—É—á–∞—é—Ç –ø—Ä–µ—Ñ–∏–∫—Å `/auth` (–Ω–∞–ø—Ä–∏–º–µ—Ä, `/register` —Å—Ç–∞–Ω–æ–≤–∏—Ç—Å—è `/auth/register`).

**–¢–µ–æ—Ä–∏—è.** –ò–¥–µ—è **–º–∞—Ä—à—Ä—É—Ç–∏–∑–∞—Ü–∏–∏** (routing) ‚Äî —Å–æ–ø–æ—Å—Ç–∞–≤–∏—Ç—å –≤—Ö–æ–¥—è—â–∏–π –∑–∞–ø—Ä–æ—Å —Å –∫–æ–¥–æ–º, –∫–æ—Ç–æ—Ä—ã–π –µ–≥–æ –æ–±—Ä–∞–±–æ—Ç–∞–µ—Ç. –ó–∞–ø—Ä–æ—Å –æ–ø—Ä–µ–¥–µ–ª—è–µ—Ç—Å—è **–º–µ—Ç–æ–¥–æ–º HTTP** (GET ‚Äî –ø–æ–ª—É—á–∏—Ç—å –¥–∞–Ω–Ω—ã–µ, POST ‚Äî –æ—Ç–ø—Ä–∞–≤–∏—Ç—å/—Å–æ–∑–¥–∞—Ç—å, PUT/PATCH ‚Äî –æ–±–Ω–æ–≤–∏—Ç—å, DELETE ‚Äî —É–¥–∞–ª–∏—Ç—å) –∏ **–ø—É—Ç—ë–º** (URL –±–µ–∑ –¥–æ–º–µ–Ω–∞: `/auth/login`, `/chats/5`). –†–æ—É—Ç–µ—Ä ‚Äî —ç—Ç–æ —Ç–∞–±–ª–∏—Ü–∞ –ø—Ä–∞–≤–∏–ª: ¬´–¥–ª—è GET /users –≤—ã–∑–≤–∞—Ç—å —Ñ—É–Ω–∫—Ü–∏—é getAllUsers¬ª, ¬´–¥–ª—è POST /auth/register –≤—ã–∑–≤–∞—Ç—å register¬ª. –¢–∞–∫ —Å—Ç—Ä–æ–∏—Ç—Å—è **RESTful API**: —Ä–µ—Å—É—Ä—Å—ã (–ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–∏, —á–∞—Ç—ã, —Å–æ–æ–±—â–µ–Ω–∏—è) –ø—Ä–µ–¥—Å—Ç–∞–≤–ª–µ–Ω—ã URL, –æ–ø–µ—Ä–∞—Ü–∏–∏ –Ω–∞–¥ –Ω–∏–º–∏ ‚Äî –º–µ—Ç–æ–¥–∞–º–∏ HTTP. –†–∞–∑–±–∏–µ–Ω–∏–µ –Ω–∞ —Ä–æ—É—Ç—ã –ø–æ —Å–º—ã—Å–ª—É (`auth`, `chats`, `messages`) —É–ø—Ä–æ—â–∞–µ—Ç –ø–æ–¥–¥–µ—Ä–∂–∫—É: –≤—Å—ë, —á—Ç–æ –∫–∞—Å–∞–µ—Ç—Å—è –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏–∏, –ª–µ–∂–∏—Ç –≤ `routes/auth.js` –∏ –∫–æ–Ω—Ç—Ä–æ–ª–ª–µ—Ä–∞—Ö –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏–∏. **Middleware** ‚Äî —Ñ—É–Ω–∫—Ü–∏—è —Å —Å–∏–≥–Ω–∞—Ç—É—Ä–æ–π `(req, res, next)`. –û–Ω–∞ –º–æ–∂–µ—Ç –∏–∑–º–µ–Ω–∏—Ç—å –∑–∞–ø—Ä–æ—Å/–æ—Ç–≤–µ—Ç –∏–ª–∏ –ø—Ä–µ—Ä–≤–∞—Ç—å —Ü–µ–ø–æ—á–∫—É (–Ω–∞–ø—Ä–∏–º–µ—Ä, –æ—Ç–ø—Ä–∞–≤–∏—Ç—å 401 –∏ –Ω–µ –≤—ã–∑—ã–≤–∞—Ç—å `next()`). –¶–µ–ø–æ—á–∫–∞ middleware + –∫–æ–Ω—Ç—Ä–æ–ª–ª–µ—Ä –ø–æ–∑–≤–æ–ª—è–µ—Ç –≤—ã–Ω–æ—Å–∏—Ç—å –æ–±—â—É—é –ª–æ–≥–∏–∫—É (–ø—Ä–æ–≤–µ—Ä–∫–∞ —Ç–æ–∫–µ–Ω–∞, –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ) –≤ –æ—Ç–¥–µ–ª—å–Ω—ã–µ —Ñ—É–Ω–∫—Ü–∏–∏ –∏ –Ω–µ –¥—É–±–ª–∏—Ä–æ–≤–∞—Ç—å –µ—ë –≤ –∫–∞–∂–¥–æ–º –∫–æ–Ω—Ç—Ä–æ–ª–ª–µ—Ä–µ.

**–°–∏–Ω—Ç–∞–∫—Å–∏—Å –∏ –∫–æ–Ω—Ü–µ–ø—Ü–∏–∏:**

- **`const router = express.Router()`** ‚Äî —Å–æ–∑–¥–∞—ë—Ç —Ä–æ—É—Ç–µ—Ä.
- **`router.post('/register', register)`** ‚Äî –ø—Ä–∏ –∑–∞–ø—Ä–æ—Å–µ POST –Ω–∞ –∞–¥—Ä–µ—Å /auth/register –≤—ã–∑—ã–≤–∞–µ—Ç—Å—è —Ñ—É–Ω–∫—Ü–∏—è `register` –∏–∑ –∫–æ–Ω—Ç—Ä–æ–ª–ª–µ—Ä–∞.
- **`router.get('/users', authenticateToken, getAllUsers)`** ‚Äî –¥–≤–∞ —à–∞–≥–∞ –ø–æ–¥—Ä—è–¥: —Å–Ω–∞—á–∞–ª–∞ –≤—ã–∑—ã–≤–∞–µ—Ç—Å—è `authenticateToken` (–ø—Ä–æ–≤–µ—Ä–∫–∞ —Ç–æ–∫–µ–Ω–∞), –ø–æ—Ç–æ–º `getAllUsers`. –ï—Å–ª–∏ –ø—Ä–æ–≤–µ—Ä–∫–∞ –Ω–µ –ø—Ä–æ–π–¥–µ–Ω–∞, middleware –æ—Ç–ø—Ä–∞–≤–ª—è–µ—Ç –æ—Ç–≤–µ—Ç –∏ –Ω–µ –≤—ã–∑—ã–≤–∞–µ—Ç `next()` ‚Äî —Ç–æ–≥–¥–∞ –¥–æ `getAllUsers` –∑–∞–ø—Ä–æ—Å –Ω–µ –¥–æ–π–¥—ë—Ç.
- **`export default router`** ‚Äî ¬´–æ—Ç–¥–∞—ë—Ç¬ª —Ä–æ—É—Ç–µ—Ä –Ω–∞—Ä—É–∂—É, —á—Ç–æ–±—ã –≤ `index.js` –µ–≥–æ –º–æ–∂–Ω–æ –±—ã–ª–æ –ø–æ–¥–∫–ª—é—á–∏—Ç—å —á–µ—Ä–µ–∑ `import`.

**–ö–æ–¥ –∏–∑ –ø—Ä–æ–µ–∫—Ç–∞.** –§–∞–π–ª: `my_serve_chat_test/routes/auth.js`

```javascript
import express from 'express';
import { register, login, getAllUsers } from '../controllers/authController.js';
import { authenticateToken } from '../middleware/auth.js';

const router = express.Router();

// –ü—É–±–ª–∏—á–Ω—ã–µ ‚Äî –±–µ–∑ —Ç–æ–∫–µ–Ω–∞
router.post('/register', register);   // POST /auth/register
router.post('/login', login);         // POST /auth/login

// –ó–∞—â–∏—â—ë–Ω–Ω—ã–µ ‚Äî —Å–Ω–∞—á–∞–ª–∞ authenticateToken, –ø–æ—Ç–æ–º –∫–æ–Ω—Ç—Ä–æ–ª–ª–µ—Ä
router.get('/users', authenticateToken, getAllUsers);  // GET /auth/users

export default router;
```

**–ß—Ç–æ –Ω—É–∂–Ω–æ –∑–Ω–∞—Ç—å:** —á—Ç–æ —Ç–∞–∫–æ–µ HTTP-–º–µ—Ç–æ–¥—ã (GET, POST), —á—Ç–æ —Ç–∞–∫–æ–µ middleware (–ø—Ä–æ–º–µ–∂—É—Ç–æ—á–Ω—ã–π –æ–±—Ä–∞–±–æ—Ç—á–∏–∫), –∫–∞–∫ —Ä–∞–±–æ—Ç–∞–µ—Ç —Ü–µ–ø–æ—á–∫–∞ –≤—ã–∑–æ–≤–æ–≤.

---

### 2.3. –ö–æ–Ω—Ç—Ä–æ–ª–ª–µ—Ä: —Ñ—É–Ω–∫—Ü–∏—è `register` ‚Äî —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è

**–ü—Ä–æ—Å—Ç—ã–º–∏ —Å–ª–æ–≤–∞–º–∏:** —ç—Ç–æ —Ñ—É–Ω–∫—Ü–∏—è, –∫–æ—Ç–æ—Ä–∞—è –æ–±—Ä–∞–±–∞—Ç—ã–≤–∞–µ—Ç ¬´–∑–∞–ø—Ä–æ—Å –Ω–∞ —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—é¬ª. –û–Ω–∞ –±–µ—Ä—ë—Ç –ª–æ–≥–∏–Ω –∏ –ø–∞—Ä–æ–ª—å –∏–∑ –∑–∞–ø—Ä–æ—Å–∞, –ø—Ä–æ–≤–µ—Ä—è–µ—Ç, —á—Ç–æ —Ç–∞–∫–æ–≥–æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è –µ—â—ë –Ω–µ—Ç, —Å–æ—Ö—Ä–∞–Ω—è–µ—Ç –ø–∞—Ä–æ–ª—å –≤ –∑–∞—à–∏—Ñ—Ä–æ–≤–∞–Ω–Ω–æ–º –≤–∏–¥–µ –≤ –±–∞–∑—É, —Å–æ–∑–¥–∞—ë—Ç —Ç–æ–∫–µ–Ω (¬´–ø—Ä–æ–ø—É—Å–∫¬ª –¥–ª—è –≤—Ö–æ–¥–∞) –∏ –æ—Ç–ø—Ä–∞–≤–ª—è–µ—Ç –µ–≥–æ –æ–±—Ä–∞—Ç–Ω–æ –∫–ª–∏–µ–Ω—Ç—É.

**–ß—Ç–æ –¥–µ–ª–∞–µ—Ç:** –ø–æ–ª—É—á–∞–µ—Ç `username` –∏ `password` –∏–∑ —Ç–µ–ª–∞ –∑–∞–ø—Ä–æ—Å–∞, –ø—Ä–æ–≤–µ—Ä—è–µ—Ç, —á—Ç–æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è –Ω–µ—Ç –≤ –ë–î, —Ö–µ—à–∏—Ä—É–µ—Ç –ø–∞—Ä–æ–ª—å, —Å–æ—Ö—Ä–∞–Ω—è–µ—Ç –≤ –ë–î, –≥–µ–Ω–µ—Ä–∏—Ä—É–µ—Ç JWT-—Ç–æ–∫–µ–Ω, –≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç –æ—Ç–≤–µ—Ç —Å —Ç–æ–∫–µ–Ω–æ–º.

**–ö–∞–∫ —Ä–∞–±–æ—Ç–∞–µ—Ç:** Express –ø–µ—Ä–µ–¥–∞—ë—Ç –≤ —Ñ—É–Ω–∫—Ü–∏—é –¥–≤–∞ –æ–±—ä–µ–∫—Ç–∞: `req` (–∑–∞–ø—Ä–æ—Å: –≤ –Ω—ë–º —Ç–µ–ª–æ –∑–∞–ø—Ä–æ—Å–∞ `req.body`, –ø–∞—Ä–∞–º–µ—Ç—Ä—ã, –∑–∞–≥–æ–ª–æ–≤–∫–∏) –∏ `res` (–æ—Ç–≤–µ—Ç: –∏–º –º—ã –æ—Ç–ø—Ä–∞–≤–ª—è–µ–º —Å—Ç–∞—Ç—É—Å –∏ –¥–∞–Ω–Ω—ã–µ –∫–ª–∏–µ–Ω—Ç—É). –§—É–Ω–∫—Ü–∏—è –∞—Å–∏–Ω—Ö—Ä–æ–Ω–Ω–∞—è (`async`), –ø–æ—ç—Ç–æ–º—É –≤–Ω—É—Ç—Ä–∏ –º–æ–∂–Ω–æ ¬´–ø–æ–¥–æ–∂–¥–∞—Ç—å¬ª —Ä–µ–∑—É–ª—å—Ç–∞—Ç –∑–∞–ø—Ä–æ—Å–∞ –∫ –ë–î —á–µ—Ä–µ–∑ `await`.

**–¢–µ–æ—Ä–∏—è.** **–ö–æ–Ω—Ç—Ä–æ–ª–ª–µ—Ä** –≤ —Ç–∞–∫–æ–π –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–µ ‚Äî —ç—Ç–æ —Ñ—É–Ω–∫—Ü–∏—è, –∫–æ—Ç–æ—Ä–∞—è –ø–æ–ª—É—á–∞–µ—Ç –∑–∞–ø—Ä–æ—Å (req) –∏ —Ñ–æ—Ä–º–∏—Ä—É–µ—Ç –æ—Ç–≤–µ—Ç (res). –í—Å—è –ª–æ–≥–∏–∫–∞ ¬´—á—Ç–æ –¥–µ–ª–∞—Ç—å –ø—Ä–∏ —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏–∏¬ª —Å–æ—Å—Ä–µ–¥–æ—Ç–æ—á–µ–Ω–∞ –∑–¥–µ—Å—å: –≤–∞–ª–∏–¥–∞—Ü–∏—è –≤—Ö–æ–¥–Ω—ã—Ö –¥–∞–Ω–Ω—ã—Ö, –æ–±—Ä–∞—â–µ–Ω–∏–µ –∫ –ë–î, —Ö–µ—à–∏—Ä–æ–≤–∞–Ω–∏–µ –ø–∞—Ä–æ–ª—è, –≤—ã–¥–∞—á–∞ —Ç–æ–∫–µ–Ω–∞. **–ê—Å–∏–Ω—Ö—Ä–æ–Ω–Ω–æ—Å—Ç—å**: –æ–±—Ä–∞—â–µ–Ω–∏–µ –∫ –ë–î –∏ –∫ –≤–Ω–µ—à–Ω–∏–º —Å–µ—Ä–≤–∏—Å–∞–º –∑–∞–Ω–∏–º–∞–µ—Ç –≤—Ä–µ–º—è. –ï—Å–ª–∏ –±—ã –∫–æ–¥ –±—ã–ª —Å–∏–Ω—Ö—Ä–æ–Ω–Ω—ã–º, –ø–æ—Ç–æ–∫ –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è ¬´–∑–∞–≤–∏—Å¬ª –±—ã –Ω–∞ –≤—Ä–µ–º—è –∑–∞–ø—Ä–æ—Å–∞ –∏ —Å–µ—Ä–≤–µ—Ä –Ω–µ –º–æ–≥ –±—ã –æ–±—Ä–∞–±–∞—Ç—ã–≤–∞—Ç—å –¥—Ä—É–≥–∏–µ –∑–∞–ø—Ä–æ—Å—ã. –í Node.js –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è –æ–¥–Ω–æ–ø–æ—Ç–æ—á–Ω–∞—è –º–æ–¥–µ–ª—å —Å **—Ü–∏–∫–ª–æ–º —Å–æ–±—ã—Ç–∏–π**: –ø—Ä–∏ `await` –≤—ã–ø–æ–ª–Ω–µ–Ω–∏–µ —Ñ—É–Ω–∫—Ü–∏–∏ –ø—Ä–∏–æ—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ—Ç—Å—è, Node –æ–±—Ä–∞–±–∞—Ç—ã–≤–∞–µ—Ç –¥—Ä—É–≥–∏–µ –∑–∞–¥–∞—á–∏, –∞ –∫–æ–≥–¥–∞ –∑–∞–ø—Ä–æ—Å –∫ –ë–î –∑–∞–≤–µ—Ä—à—ë–Ω ‚Äî —Ñ—É–Ω–∫—Ü–∏—è –ø—Ä–æ–¥–æ–ª–∂–∞–µ—Ç—Å—è. –¢–∞–∫ –æ–¥–∏–Ω –ø—Ä–æ—Ü–µ—Å—Å –æ–±—Å–ª—É–∂–∏–≤–∞–µ—Ç –º–Ω–æ–≥–æ –æ–¥–Ω–æ–≤—Ä–µ–º–µ–Ω–Ω—ã—Ö –∑–∞–ø—Ä–æ—Å–æ–≤. **–•–µ—à–∏—Ä–æ–≤–∞–Ω–∏–µ –ø–∞—Ä–æ–ª—è**: —Ö—Ä–∞–Ω–∏—Ç—å –ø–∞—Ä–æ–ª–∏ –≤ –æ—Ç–∫—Ä—ã—Ç–æ–º –≤–∏–¥–µ –Ω–µ–ª—å–∑—è. –ò—Å–ø–æ–ª—å–∑—É—é—Ç –æ–¥–Ω–æ—Å—Ç–æ—Ä–æ–Ω–Ω—é—é —Ñ—É–Ω–∫—Ü–∏—é (—Ö–µ—à): –∏–∑ –ø–∞—Ä–æ–ª—è –ø–æ–ª—É—á–∞–µ—Ç—Å—è —Å—Ç—Ä–æ–∫–∞, –ø–æ –∫–æ—Ç–æ—Ä–æ–π –Ω–µ–ª—å–∑—è –≤–æ—Å—Å—Ç–∞–Ω–æ–≤–∏—Ç—å –ø–∞—Ä–æ–ª—å; –ø—Ä–∏ –≤—Ö–æ–¥–µ –≤–≤–µ–¥—ë–Ω–Ω—ã–π –ø–∞—Ä–æ–ª—å —Ö–µ—à–∏—Ä—É—é—Ç —Ç–µ–º –∂–µ –∞–ª–≥–æ—Ä–∏—Ç–º–æ–º –∏ —Å—Ä–∞–≤–Ω–∏–≤–∞—é—Ç —Å —Å–æ—Ö—Ä–∞–Ω—ë–Ω–Ω—ã–º —Ö–µ—à–µ–º. **bcrypt** –¥–æ–±–∞–≤–ª—è–µ—Ç ¬´—Å–æ–ª—å¬ª –∏ –∏—Ç–µ—Ä–∞—Ü–∏–∏, —á—Ç–æ–±—ã —É—Å–ª–æ–∂–Ω–∏—Ç—å –ø–æ–¥–±–æ—Ä –ø–∞—Ä–æ–ª—è. **HTTP-–∫–æ–¥—ã –æ—Ç–≤–µ—Ç–∞**: 200 ‚Äî —É—Å–ø–µ—Ö, 201 ‚Äî —Å–æ–∑–¥–∞–Ω–æ, 400 ‚Äî –æ—à–∏–±–∫–∞ –∑–∞–ø—Ä–æ—Å–∞ (–Ω–µ–≤–µ—Ä–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ), 401 ‚Äî –Ω–µ –∞–≤—Ç–æ—Ä–∏–∑–æ–≤–∞–Ω, 403 ‚Äî –¥–æ—Å—Ç—É–ø –∑–∞–ø—Ä–µ—â—ë–Ω, 500 ‚Äî –æ—à–∏–±–∫–∞ —Å–µ—Ä–≤–µ—Ä–∞. –ö–ª–∏–µ–Ω—Ç –ø–æ –∫–æ–¥—É –ø–æ–Ω–∏–º–∞–µ—Ç, —á—Ç–æ –ø—Ä–æ–∏–∑–æ—à–ª–æ.

**–°–∏–Ω—Ç–∞–∫—Å–∏—Å –∏ –∫–æ–Ω—Ü–µ–ø—Ü–∏–∏:**

- **`export const register = async (req, res) => { ... }`** ‚Äî —ç–∫—Å–ø–æ—Ä—Ç–∏—Ä—É–µ—Ç —Ñ—É–Ω–∫—Ü–∏—é. `async` –æ–∑–Ω–∞—á–∞–µ—Ç, —á—Ç–æ —Ñ—É–Ω–∫—Ü–∏—è –≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç Promise –∏ –≤–Ω—É—Ç—Ä–∏ –º–æ–∂–Ω–æ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å `await`.
- **`const { username, password } = req.body`** ‚Äî –¥–æ—Å—Ç–∞—ë–º –∏–∑ —Ç–µ–ª–∞ –∑–∞–ø—Ä–æ—Å–∞ –ø–æ–ª—è `username` –∏ `password` –≤ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ —Å —Ç–∞–∫–∏–º–∏ –∂–µ –∏–º–µ–Ω–∞–º–∏.
- **`if (!username || !password)`** ‚Äî –ø—Ä–æ–≤–µ—Ä–∫–∞: –µ—Å–ª–∏ –ª–æ–≥–∏–Ω –∏–ª–∏ –ø–∞—Ä–æ–ª—å –Ω–µ –ø–µ—Ä–µ–¥–∞–Ω—ã (–ø—É—Å—Ç—ã–µ –∏–ª–∏ –æ—Ç—Å—É—Ç—Å—Ç–≤—É—é—Ç), —É—Å–ª–æ–≤–∏–µ –≤—ã–ø–æ–ª–Ω—è–µ—Ç—Å—è.
- **`return res.status(400).json({ message: '...' })`** ‚Äî –æ—Ç–ø—Ä–∞–≤–ª—è–µ–º –∫–ª–∏–µ–Ω—Ç—É –æ—Ç–≤–µ—Ç —Å –∫–æ–¥–æ–º 400 (–æ—à–∏–±–∫–∞ –∑–∞–ø—Ä–æ—Å–∞) –∏ —Ç–µ–∫—Å—Ç–æ–º —Å–æ–æ–±—â–µ–Ω–∏—è –≤ —Ñ–æ—Ä–º–∞—Ç–µ JSON –∏ –≤—ã—Ö–æ–¥–∏–º –∏–∑ —Ñ—É–Ω–∫—Ü–∏–∏.
- **`await pool.query('SELECT ...', [param1])`** ‚Äî –≤—ã–ø–æ–ª–Ω—è–µ–º –∑–∞–ø—Ä–æ—Å –∫ –±–∞–∑–µ –¥–∞–Ω–Ω—ã—Ö. `pool` ‚Äî –æ–±—â–∏–π ¬´–ø—É–ª¬ª —Å–æ–µ–¥–∏–Ω–µ–Ω–∏–π —Å PostgreSQL. `await` –æ–∑–Ω–∞—á–∞–µ—Ç ¬´–ø–æ–¥–æ–∂–¥–∞—Ç—å —Ä–µ–∑—É–ª—å—Ç–∞—Ç¬ª. –ü–∞—Ä–∞–º–µ—Ç—Ä—ã –≤ –º–∞—Å—Å–∏–≤–µ –ø–æ–¥—Å—Ç–∞–≤–ª—è—é—Ç—Å—è –≤ –∑–∞–ø—Ä–æ—Å –≤–º–µ—Å—Ç–æ `$1`, `$2` ‚Äî —Ç–∞–∫ –±–µ–∑–æ–ø–∞—Å–Ω–µ–µ, —á–µ–º –≤—Å—Ç–∞–≤–ª—è—Ç—å –∑–Ω–∞—á–µ–Ω–∏—è –ø—Ä—è–º–æ –≤ —Å—Ç—Ä–æ–∫—É.
- **`existing.rows.length > 0`** ‚Äî —Ä–µ–∑—É–ª—å—Ç–∞—Ç –∑–∞–ø—Ä–æ—Å–∞ –∫ –ë–î –ø—Ä–∏—Ö–æ–¥–∏—Ç –≤ –≤–∏–¥–µ –æ–±—ä–µ–∫—Ç–∞ —Å –ø–æ–ª–µ–º `rows` (—Å–ø–∏—Å–æ–∫ —Å—Ç—Ä–æ–∫). –ï—Å–ª–∏ —Å—Ç—Ä–æ–∫ –±–æ–ª—å—à–µ –Ω—É–ª—è, –∑–Ω–∞—á–∏—Ç —Ç–∞–∫–æ–π –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å —É–∂–µ –µ—Å—Ç—å.
- **`await bcrypt.hash(password, saltRounds)`** ‚Äî –ø—Ä–µ–≤—Ä–∞—â–∞–µ—Ç –ø–∞—Ä–æ–ª—å –≤ ¬´—Ö–µ—à¬ª ‚Äî —Å—Ç—Ä–æ–∫—É, –∏–∑ –∫–æ—Ç–æ—Ä–æ–π –Ω–µ–ª—å–∑—è –≤–æ—Å—Å—Ç–∞–Ω–æ–≤–∏—Ç—å –∏—Å—Ö–æ–¥–Ω—ã–π –ø–∞—Ä–æ–ª—å. –ü—Ä–∏ —Å–ª–µ–¥—É—é—â–µ–º –≤—Ö–æ–¥–µ —Å–µ—Ä–≤–µ—Ä —Å—Ä–∞–≤–Ω–∏–≤–∞–µ—Ç –≤–≤–µ–¥—ë–Ω–Ω—ã–π –ø–∞—Ä–æ–ª—å —Å —Å–æ—Ö—Ä–∞–Ω—ë–Ω–Ω—ã–º —Ö–µ—à–µ–º —á–µ—Ä–µ–∑ `bcrypt.compare`.
- **`INSERT INTO users ... RETURNING id, email`** ‚Äî SQL: –≤—Å—Ç–∞–≤–ª—è–µ—Ç —Å—Ç—Ä–æ–∫—É –∏ –≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç —É–∫–∞–∑–∞–Ω–Ω—ã–µ –ø–æ–ª—è. `RETURNING` ‚Äî —Å–ø–µ—Ü–∏—Ñ–∏—á–Ω–æ –¥–ª—è PostgreSQL.
- **`res.status(201).json({ ... })`** ‚Äî –∫–æ–¥ 201 –æ–∑–Ω–∞—á–∞–µ—Ç ¬´—Å–æ–∑–¥–∞–Ω–æ¬ª. `json()` –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ —Å–µ—Ä–∏–∞–ª–∏–∑—É–µ—Ç –æ–±—ä–µ–∫—Ç –≤ JSON –∏ —Å—Ç–∞–≤–∏—Ç –∑–∞–≥–æ–ª–æ–≤–æ–∫ `Content-Type: application/json`.

**–ö–æ–¥ –∏–∑ –ø—Ä–æ–µ–∫—Ç–∞.** –§–∞–π–ª: `my_serve_chat_test/controllers/authController.js`

```javascript
import pool from '../db.js';
import bcrypt from 'bcryptjs';
import { generateToken } from '../middleware/auth.js';

export const register = async (req, res) => {
  const { username, password } = req.body;

  if (!username || !password) {
    return res.status(400).json({ message: '–õ–æ–≥–∏–Ω –∏ –ø–∞—Ä–æ–ª—å –æ–±—è–∑–∞—Ç–µ–ª—å–Ω—ã' });
  }

  const normalizedUsername = username.trim().toLowerCase();

  try {
    // –ü—Ä–æ–≤–µ—Ä—è–µ–º —Å—É—â–µ—Å—Ç–≤–æ–≤–∞–Ω–∏–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
    const existing = await pool.query(
      'SELECT id, email FROM users WHERE LOWER(TRIM(email)) = $1',
      [normalizedUsername]
    );
    
    if (existing.rows.length > 0) {
      return res.status(400).json({ message: '–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å —É–∂–µ —Å—É—â–µ—Å—Ç–≤—É–µ—Ç' });
    }

    // –•–µ—à–∏—Ä—É–µ–º –ø–∞—Ä–æ–ª—å
    const saltRounds = 10;
    const hashedPassword = await bcrypt.hash(password, saltRounds);

    // –°–æ—Ö—Ä–∞–Ω—è–µ–º –≤ –ë–î
    const result = await pool.query(
      'INSERT INTO users (email, password) VALUES ($1, $2) RETURNING id, email',
      [normalizedUsername, hashedPassword]
    );

    // –ì–µ–Ω–µ—Ä–∏—Ä—É–µ–º JWT —Ç–æ–∫–µ–Ω
    const token = generateToken(result.rows[0].id, result.rows[0].email, false);

    res.status(201).json({
      userId: result.rows[0].id,
      username: result.rows[0].email,
      token: token,
    });
  } catch (error) {
    console.error('–û—à–∏–±–∫–∞ —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏–∏:', error.message);
    res.status(500).json({ message: '–û—à–∏–±–∫–∞ —Å–µ—Ä–≤–µ—Ä–∞' });
  }
};
```

**–ß—Ç–æ –Ω—É–∂–Ω–æ –∑–Ω–∞—Ç—å:** async/await (–∞—Å–∏–Ω—Ö—Ä–æ–Ω–Ω—ã–π –∫–æ–¥), –¥–µ—Å—Ç—Ä—É–∫—Ç—É—Ä–∏–∑–∞—Ü–∏—è –æ–±—ä–µ–∫—Ç–æ–≤, SQL (SELECT, INSERT), —á—Ç–æ —Ç–∞–∫–æ–µ —Ö–µ—à–∏—Ä–æ–≤–∞–Ω–∏–µ –ø–∞—Ä–æ–ª–µ–π, HTTP-–∫–æ–¥—ã –æ—Ç–≤–µ—Ç–æ–≤ (200, 201, 400, 500).

---

### 2.4. –ë–∞–∑–∞ –¥–∞–Ω–Ω—ã—Ö: –ø—É–ª —Å–æ–µ–¥–∏–Ω–µ–Ω–∏–π PostgreSQL

**–ü—Ä–æ—Å—Ç—ã–º–∏ —Å–ª–æ–≤–∞–º–∏:** —ç—Ç–æ—Ç —Ñ–∞–π–ª –Ω–∞—Å—Ç—Ä–∞–∏–≤–∞–µ—Ç –ø–æ–¥–∫–ª—é—á–µ–Ω–∏–µ –∫ –±–∞–∑–µ –¥–∞–Ω–Ω—ã—Ö (PostgreSQL). –ë–∞–∑–∞ ‚Äî —ç—Ç–æ –º–µ—Å—Ç–æ, –≥–¥–µ —Ö—Ä–∞–Ω—è—Ç—Å—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–∏, —Å–æ–æ–±—â–µ–Ω–∏—è, —á–∞—Ç—ã. –°–µ—Ä–≤–µ—Ä –Ω–µ –æ—Ç–∫—Ä—ã–≤–∞–µ—Ç –Ω–æ–≤–æ–µ —Å–æ–µ–¥–∏–Ω–µ–Ω–∏–µ –Ω–∞ –∫–∞–∂–¥—ã–π –∑–∞–ø—Ä–æ—Å, –∞ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç ¬´–ø—É–ª¬ª ‚Äî –Ω–∞–±–æ—Ä —É–∂–µ –æ—Ç–∫—Ä—ã—Ç—ã—Ö —Å–æ–µ–¥–∏–Ω–µ–Ω–∏–π; —Ç–∞–∫ –±—ã—Å—Ç—Ä–µ–µ –∏ –Ω–∞–¥—ë–∂–Ω–µ–µ.

**–ß—Ç–æ –¥–µ–ª–∞–µ—Ç:** —Å–æ–∑–¥–∞—ë—Ç –ø—É–ª —Å–æ–µ–¥–∏–Ω–µ–Ω–∏–π –∫ PostgreSQL. –í—Å–µ –∫–æ–Ω—Ç—Ä–æ–ª–ª–µ—Ä—ã –∏—Å–ø–æ–ª—å–∑—É—é—Ç —ç—Ç–æ—Ç –ø—É–ª –¥–ª—è –∑–∞–ø—Ä–æ—Å–æ–≤ –∫ –ë–î.

**–ö–∞–∫ —Ä–∞–±–æ—Ç–∞–µ—Ç:** –ø—É–ª ‚Äî —ç—Ç–æ –Ω–∞–±–æ—Ä –≥–æ—Ç–æ–≤—ã—Ö —Å–æ–µ–¥–∏–Ω–µ–Ω–∏–π –∫ –ë–î. –ö–æ–≥–¥–∞ –∫–æ–Ω—Ç—Ä–æ–ª–ª–µ—Ä –≤—ã–∑—ã–≤–∞–µ—Ç `pool.query()`, –ø—É–ª –±–µ—Ä—ë—Ç —Å–≤–æ–±–æ–¥–Ω–æ–µ —Å–æ–µ–¥–∏–Ω–µ–Ω–∏–µ, –≤—ã–ø–æ–ª–Ω—è–µ—Ç –∑–∞–ø—Ä–æ—Å, –≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç —Å–æ–µ–¥–∏–Ω–µ–Ω–∏–µ –≤ –ø—É–ª. –≠—Ç–æ —ç—Ñ—Ñ–µ–∫—Ç–∏–≤–Ω–µ–µ, —á–µ–º –æ—Ç–∫—Ä—ã–≤–∞—Ç—å –Ω–æ–≤–æ–µ —Å–æ–µ–¥–∏–Ω–µ–Ω–∏–µ –Ω–∞ –∫–∞–∂–¥—ã–π –∑–∞–ø—Ä–æ—Å.

**–¢–µ–æ—Ä–∏—è.** **–†–µ–ª—è—Ü–∏–æ–Ω–Ω–∞—è –±–∞–∑–∞ –¥–∞–Ω–Ω—ã—Ö** (PostgreSQL ‚Äî –æ–¥–Ω–∞ –∏–∑ –Ω–∏—Ö) —Ö—Ä–∞–Ω–∏—Ç –¥–∞–Ω–Ω—ã–µ –≤ —Ç–∞–±–ª–∏—Ü–∞—Ö —Å –∫–æ–ª–æ–Ω–∫–∞–º–∏ –∏ —Å—Ç—Ä–æ–∫–∞–º–∏. –°–≤—è–∑–∏ –º–µ–∂–¥—É —Ç–∞–±–ª–∏—Ü–∞–º–∏ –∑–∞–¥–∞—é—Ç—Å—è —á–µ—Ä–µ–∑ –∫–ª—é—á–∏ (–Ω–∞–ø—Ä–∏–º–µ—Ä, –≤ —Ç–∞–±–ª–∏—Ü–µ —Å–æ–æ–±—â–µ–Ω–∏–π –µ—Å—Ç—å `user_id` ‚Äî —Å—Å—ã–ª–∫–∞ –Ω–∞ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è). –ó–∞–ø—Ä–æ—Å—ã –ø–∏—à—É—Ç—Å—è –Ω–∞ —è–∑—ã–∫–µ **SQL** (SELECT, INSERT, UPDATE, DELETE). –°–µ—Ä–≤–µ—Ä –Ω–µ —Ö—Ä–∞–Ω–∏—Ç –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π –∏ —Å–æ–æ–±—â–µ–Ω–∏—è –≤ –ø–∞–º—è—Ç–∏: –ø—Ä–∏ –ø–µ—Ä–µ–∑–∞–ø—É—Å–∫–µ –≤—Å—ë –±—ã –ø–æ—Ç–µ—Ä—è–ª–æ—Å—å; –ë–î —Å–æ—Ö—Ä–∞–Ω—è–µ—Ç –¥–∞–Ω–Ω—ã–µ –Ω–∞ –¥–∏—Å–∫ –∏ –º–∞—Å—à—Ç–∞–±–∏—Ä—É–µ—Ç—Å—è –æ—Ç–¥–µ–ª—å–Ω–æ. **–ü—É–ª —Å–æ–µ–¥–∏–Ω–µ–Ω–∏–π**: —É—Å—Ç–∞–Ω–æ–≤–∫–∞ —Å–æ–µ–¥–∏–Ω–µ–Ω–∏—è —Å –ë–î ‚Äî –¥–æ—Ä–æ–≥–∞—è –æ–ø–µ—Ä–∞—Ü–∏—è (—Å–µ—Ç–µ–≤–æ–π handshake, –∞—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏—è). –ü—É–ª –¥–µ—Ä–∂–∏—Ç –Ω–µ—Å–∫–æ–ª—å–∫–æ —É–∂–µ –æ—Ç–∫—Ä—ã—Ç—ã—Ö —Å–æ–µ–¥–∏–Ω–µ–Ω–∏–π; –ø—Ä–∏ –≤—ã–∑–æ–≤–µ `pool.query()` –±–µ—Ä—ë—Ç—Å—è —Å–≤–æ–±–æ–¥–Ω–æ–µ —Å–æ–µ–¥–∏–Ω–µ–Ω–∏–µ, –∑–∞–ø—Ä–æ—Å –≤—ã–ø–æ–ª–Ω—è–µ—Ç—Å—è, —Å–æ–µ–¥–∏–Ω–µ–Ω–∏–µ –≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç—Å—è –≤ –ø—É–ª. –¢–∞–∫ –º—ã –Ω–µ —Å–æ–∑–¥–∞—ë–º —Å–æ—Ç–Ω–∏ —Å–æ–µ–¥–∏–Ω–µ–Ω–∏–π –ø—Ä–∏ —Å–æ—Ç–Ω–µ –æ–¥–Ω–æ–≤—Ä–µ–º–µ–Ω–Ω—ã—Ö –∑–∞–ø—Ä–æ—Å–æ–≤. **–ü–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –æ–∫—Ä—É–∂–µ–Ω–∏—è** (`.env`, `process.env`): —Å–µ–∫—Ä–µ—Ç—ã (–ø–∞—Ä–æ–ª—å –ë–î, JWT_SECRET) –∏ –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ (–ø–æ—Ä—Ç, URL –ë–î) –Ω–µ –¥–æ–ª–∂–Ω—ã –±—ã—Ç—å –∑–∞—Ö–∞—Ä–¥–∫–æ–∂–µ–Ω—ã –≤ –∫–æ–¥–µ ‚Äî –∏–Ω–∞—á–µ –æ–Ω–∏ –ø–æ–ø–∞–¥—É—Ç –≤ —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏–π. –ò—Ö –∑–∞–¥–∞—é—Ç —á–µ—Ä–µ–∑ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –æ–∫—Ä—É–∂–µ–Ω–∏—è –Ω–∞ –º–∞—à–∏–Ω–µ –∏–ª–∏ –≤ –æ–±–ª–∞–∫–µ; –≤ —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–µ —É–¥–æ–±–Ω–æ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å —Ñ–∞–π–ª `.env`, –∫–æ—Ç–æ—Ä—ã–π –Ω–µ –∫–æ–º–º–∏—Ç–∏—Ç—Å—è.

**–°–∏–Ω—Ç–∞–∫—Å–∏—Å –∏ –∫–æ–Ω—Ü–µ–ø—Ü–∏–∏:**

- **`import pkg from 'pg'`** –∏ **`const { Pool } = pkg`** ‚Äî –∏–º–ø–æ—Ä—Ç–∏—Ä—É–µ—Ç –∫–ª–∞—Å—Å `Pool` –∏–∑ –±–∏–±–ª–∏–æ—Ç–µ–∫–∏ `pg` (PostgreSQL –∫–ª–∏–µ–Ω—Ç –¥–ª—è Node.js). –í ES6 –º–æ–¥—É–ª—è—Ö –∏–Ω–æ–≥–¥–∞ –Ω—É–∂–Ω–æ —Å–Ω–∞—á–∞–ª–∞ –∏–º–ø–æ—Ä—Ç–∏—Ä–æ–≤–∞—Ç—å –≤–µ—Å—å –ø–∞–∫–µ—Ç, –ø–æ—Ç–æ–º –¥–æ—Å—Ç–∞–≤–∞—Ç—å –∫–ª–∞—Å—Å.
- **`new Pool({ connectionString: ..., ssl: ... })`** ‚Äî —Å–æ–∑–¥–∞—ë—Ç –ø—É–ª. `connectionString` ‚Äî —Å—Ç—Ä–æ–∫–∞ –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è –≤–∏–¥–∞ `postgresql://user:password@host:port/database`. `ssl` ‚Äî –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ SSL (–¥–ª—è –æ–±–ª–∞—á–Ω—ã—Ö –ë–î –æ–±—ã—á–Ω–æ `rejectUnauthorized: false`).
- **`process.env.DATABASE_URL`** ‚Äî –ø–µ—Ä–µ–º–µ–Ω–Ω–∞—è –æ–∫—Ä—É–∂–µ–Ω–∏—è. –ë–µ—Ä—ë—Ç—Å—è –∏–∑ —Ñ–∞–π–ª–∞ `.env` –∏–ª–∏ –∏–∑ –Ω–∞—Å—Ç—Ä–æ–µ–∫ —Å–µ—Ä–≤–µ—Ä–∞ (Render, Heroku –∏ —Ç.–¥.).
- **`pool.on('error', ...)`** ‚Äî –æ–±—Ä–∞–±–æ—Ç—á–∏–∫ —Å–æ–±—ã—Ç–∏—è. –ï—Å–ª–∏ —Å–æ–µ–¥–∏–Ω–µ–Ω–∏–µ –≤ –ø—É–ª–µ —É–ø–∞–ª–æ, –≤—ã–∑—ã–≤–∞–µ—Ç—Å—è —ç—Ç–∞ —Ñ—É–Ω–∫—Ü–∏—è.
- **`pool.query('SELECT NOW()')`** ‚Äî —Ç–µ—Å—Ç–æ–≤—ã–π –∑–∞–ø—Ä–æ—Å. `NOW()` ‚Äî —Ñ—É–Ω–∫—Ü–∏—è PostgreSQL, –≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç —Ç–µ–∫—É—â–µ–µ –≤—Ä–µ–º—è.
- **`.then(...).catch(...)`** ‚Äî Promise API. –≠–∫–≤–∏–≤–∞–ª–µ–Ω—Ç–Ω–æ `async/await`, –Ω–æ –≤ —Å—Ç–∞—Ä–æ–º —Å—Ç–∏–ª–µ. `then` ‚Äî –ø—Ä–∏ —É—Å–ø–µ—Ö–µ, `catch` ‚Äî –ø—Ä–∏ –æ—à–∏–±–∫–µ.
- **`export default pool`** ‚Äî —ç–∫—Å–ø–æ—Ä—Ç–∏—Ä—É–µ—Ç –ø—É–ª, —á—Ç–æ–±—ã –µ–≥–æ –º–æ–∂–Ω–æ –±—ã–ª–æ –∏–º–ø–æ—Ä—Ç–∏—Ä–æ–≤–∞—Ç—å –≤ –∫–æ–Ω—Ç—Ä–æ–ª–ª–µ—Ä–∞—Ö.

**–ö–æ–¥ –∏–∑ –ø—Ä–æ–µ–∫—Ç–∞.** –§–∞–π–ª: `my_serve_chat_test/db.js`

```javascript
import pkg from 'pg';
const { Pool } = pkg;
import dotenv from 'dotenv';
dotenv.config();

const pool = new Pool({
  connectionString: process.env.DATABASE_URL,
  ssl: process.env.DATABASE_URL?.includes('localhost') ? false : {
    rejectUnauthorized: false,
  },
});

pool.on('error', (err) => {
  console.error('‚ùå –ù–µ–æ–∂–∏–¥–∞–Ω–Ω–∞—è –æ—à–∏–±–∫–∞ –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è –∫ –ë–î:', err);
});

// –ü—Ä–æ–≤–µ—Ä–∫–∞ –ø—Ä–∏ —Å—Ç–∞—Ä—Ç–µ
setTimeout(() => {
  pool.query('SELECT NOW()')
    .then(() => console.log('‚úÖ –ü–æ–¥–∫–ª—é—á–µ–Ω–∏–µ –∫ –±–∞–∑–µ –¥–∞–Ω–Ω—ã—Ö —É—Å–ø–µ—à–Ω–æ'))
    .catch((err) => console.error('‚ùå –û—à–∏–±–∫–∞ –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è –∫ –±–∞–∑–µ –¥–∞–Ω–Ω—ã—Ö:', err.message));
}, 1000);

export default pool;
```

**–ß—Ç–æ –Ω—É–∂–Ω–æ –∑–Ω–∞—Ç—å:** —á—Ç–æ —Ç–∞–∫–æ–µ –ø—É–ª —Å–æ–µ–¥–∏–Ω–µ–Ω–∏–π, —á—Ç–æ —Ç–∞–∫–æ–µ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –æ–∫—Ä—É–∂–µ–Ω–∏—è, Promise API –∏–ª–∏ async/await, —á—Ç–æ —Ç–∞–∫–æ–µ SSL.

---

### 2.5. Middleware: —Ñ—É–Ω–∫—Ü–∏—è `authenticateToken` ‚Äî –ø—Ä–æ–≤–µ—Ä–∫–∞ JWT

**–ü—Ä–æ—Å—Ç—ã–º–∏ —Å–ª–æ–≤–∞–º–∏:** —ç—Ç–æ ¬´–æ—Ö—Ä–∞–Ω–Ω–∏–∫¬ª –Ω–∞ –∑–∞—â–∏—â—ë–Ω–Ω—ã—Ö –∞–¥—Ä–µ—Å–∞—Ö. –ü–µ—Ä–µ–¥ —Ç–µ–º –∫–∞–∫ –≤—ã–ø–æ–ª–Ω–∏—Ç—å –æ—Å–Ω–æ–≤–Ω—É—é —Ñ—É–Ω–∫—Ü–∏—é (–Ω–∞–ø—Ä–∏–º–µ—Ä, –æ—Ç–¥–∞—Ç—å —Å–ø–∏—Å–æ–∫ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π), —Å–µ—Ä–≤–µ—Ä –ø—Ä–æ–≤–µ—Ä—è–µ—Ç: –µ—Å—Ç—å –ª–∏ –≤ –∑–∞–ø—Ä–æ—Å–µ —Ç–æ–∫–µ–Ω (—Ç–æ—Ç ¬´–ø—Ä–æ–ø—É—Å–∫¬ª, –∫–æ—Ç–æ—Ä—ã–π –≤—ã–¥–∞–ª–∏ –ø—Ä–∏ –≤—Ö–æ–¥–µ) –∏ –¥–µ–π—Å—Ç–≤–∏—Ç–µ–ª–µ–Ω –ª–∏ –æ–Ω. –ï—Å–ª–∏ —Ç–æ–∫–µ–Ω–∞ –Ω–µ—Ç –∏–ª–∏ –æ–Ω –Ω–µ–¥–µ–π—Å—Ç–≤–∏—Ç–µ–ª–µ–Ω ‚Äî —Å–µ—Ä–≤–µ—Ä –æ—Ç–ø—Ä–∞–≤–ª—è–µ—Ç –æ—à–∏–±–∫—É –∏ –¥–∞–ª—å—à–µ –∑–∞–ø—Ä–æ—Å –Ω–µ –∏–¥—ë—Ç.

**–ß—Ç–æ –¥–µ–ª–∞–µ—Ç:** —á–∏—Ç–∞–µ—Ç –∑–∞–≥–æ–ª–æ–≤–æ–∫ `Authorization: Bearer <token>`, –ø—Ä–æ–≤–µ—Ä—è–µ—Ç JWT-—Ç–æ–∫–µ–Ω; –µ—Å–ª–∏ —Ç–æ–∫–µ–Ω –≤–∞–ª–∏–¥–Ω—ã–π ‚Äî –∫–ª–∞–¥—ë—Ç —Ä–∞—Å—à–∏—Ñ—Ä–æ–≤–∞–Ω–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ –≤ `req.user` –∏ –≤—ã–∑—ã–≤–∞–µ—Ç `next()`; –µ—Å–ª–∏ –Ω–µ–≤–∞–ª–∏–¥–Ω—ã–π ‚Äî –æ—Ç–ø—Ä–∞–≤–ª—è–µ—Ç 401/403 –∏ –Ω–µ –≤—ã–∑—ã–≤–∞–µ—Ç `next()`.

**–ö–∞–∫ —Ä–∞–±–æ—Ç–∞–µ—Ç:** Express –≤—ã–∑—ã–≤–∞–µ—Ç middleware –ø–µ—Ä–µ–¥ –∫–æ–Ω—Ç—Ä–æ–ª–ª–µ—Ä–æ–º. Middleware ‚Äî —ç—Ç–æ —Ñ—É–Ω–∫—Ü–∏—è —Å —Ç—Ä–µ–º—è –∞—Ä–≥—É–º–µ–Ω—Ç–∞–º–∏: `req` (–∑–∞–ø—Ä–æ—Å), `res` (–æ—Ç–≤–µ—Ç), `next` (—Ñ—É–Ω–∫—Ü–∏—è ¬´–ø–µ—Ä–µ–¥–∞—Ç—å –¥–∞–ª—å—à–µ¬ª). –ï—Å–ª–∏ middleware –Ω–µ –≤—ã–∑—ã–≤–∞–µ—Ç `next()`, —Ü–µ–ø–æ—á–∫–∞ –ø—Ä–µ—Ä—ã–≤–∞–µ—Ç—Å—è –∏ –¥–æ –∫–æ–Ω—Ç—Ä–æ–ª–ª–µ—Ä–∞ –∑–∞–ø—Ä–æ—Å –Ω–µ –¥–æ—Ö–æ–¥–∏—Ç.

**–¢–µ–æ—Ä–∏—è.** –ü–æ—Å–ª–µ –≤—Ö–æ–¥–∞ —Å–µ—Ä–≤–µ—Ä –≤—ã–¥–∞—ë—Ç –∫–ª–∏–µ–Ω—Ç—É **—Ç–æ–∫–µ–Ω** (JWT ‚Äî JSON Web Token). –ü—Ä–∏ —Å–ª–µ–¥—É—é—â–∏—Ö –∑–∞–ø—Ä–æ—Å–∞—Ö –∫–ª–∏–µ–Ω—Ç –ø—Ä–∏–∫–ª–∞–¥—ã–≤–∞–µ—Ç —ç—Ç–æ—Ç —Ç–æ–∫–µ–Ω (–æ–±—ã—á–Ω–æ –≤ –∑–∞–≥–æ–ª–æ–≤–∫–µ `Authorization: Bearer <token>`). –°–µ—Ä–≤–µ—Ä—É –Ω–µ –Ω—É–∂–Ω–æ —Ö—Ä–∞–Ω–∏—Ç—å —Å–µ—Å—Å–∏–∏ –≤ –ø–∞–º—è—Ç–∏: –≤—Å—è –Ω—É–∂–Ω–∞—è –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è (–∫—Ç–æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å, —Å—Ä–æ–∫ –¥–µ–π—Å—Ç–≤–∏—è) –∑–∞–∫–æ–¥–∏—Ä–æ–≤–∞–Ω–∞ –≤ —Å–∞–º–æ–º —Ç–æ–∫–µ–Ω–µ –∏ –ø–æ–¥–ø–∏—Å–∞–Ω–∞ —Å–µ–∫—Ä–µ—Ç–Ω—ã–º –∫–ª—é—á–æ–º. –¢–∞–∫–æ–π –ø–æ–¥—Ö–æ–¥ –Ω–∞–∑—ã–≤–∞–µ—Ç—Å—è **stateless authentication**: —Å–µ—Ä–≤–µ—Ä –ø—Ä–æ–≤–µ—Ä—è–µ—Ç –ø–æ–¥–ø–∏—Å—å —Ç–æ–∫–µ–Ω–∞ –∏ –ø—Ä–∏ –Ω–µ–æ–±—Ö–æ–¥–∏–º–æ—Å—Ç–∏ —Ä–∞—Å—à–∏—Ñ—Ä–æ–≤—ã–≤–∞–µ—Ç –¥–∞–Ω–Ω—ã–µ (userId, email). –ï—Å–ª–∏ —Ç–æ–∫–µ–Ω –ø–æ–¥–¥–µ–ª–∞–Ω –∏–ª–∏ –∏—Å—Ç—ë–∫ ‚Äî –¥–æ—Å—Ç—É–ø –∑–∞–ø—Ä–µ—â—ë–Ω (401/403). **–°—Ç—Ä—É–∫—Ç—É—Ä–∞ JWT**: —Ç—Ä–∏ —á–∞—Å—Ç–∏, —Ä–∞–∑–¥–µ–ª—ë–Ω–Ω—ã–µ —Ç–æ—á–∫–æ–π ‚Äî –∑–∞–≥–æ–ª–æ–≤–æ–∫ (–∞–ª–≥–æ—Ä–∏—Ç–º), payload (–¥–∞–Ω–Ω—ã–µ: userId, email, —Å—Ä–æ–∫), –ø–æ–¥–ø–∏—Å—å. –ü–æ–¥–ø–∏—Å—å —Å—Ç—Ä–æ–∏—Ç—Å—è –∏–∑ –∑–∞–≥–æ–ª–æ–≤–∫–∞ + payload + —Å–µ–∫—Ä–µ—Ç–Ω—ã–π –∫–ª—é—á; –±–µ–∑ –∑–Ω–∞–Ω–∏—è –∫–ª—é—á–∞ –ø–æ–¥–¥–µ–ª–∞—Ç—å –ø–æ–¥–ø–∏—Å—å –Ω–µ–ª—å–∑—è. **–ó–∞–≥–æ–ª–æ–≤–∫–∏ HTTP**: –∫—Ä–æ–º–µ —Ç–µ–ª–∞ –∑–∞–ø—Ä–æ—Å–∞ (body), –∫–ª–∏–µ–Ω—Ç –æ—Ç–ø—Ä–∞–≤–ª—è–µ—Ç –∑–∞–≥–æ–ª–æ–≤–∫–∏ (headers) ‚Äî –ø–∞—Ä—ã ¬´–∏–º—è: –∑–Ω–∞—á–µ–Ω–∏–µ¬ª. –¢–∞–º –ø–µ—Ä–µ–¥–∞—ë—Ç—Å—è Content-Type (—Ç–∏–ø —Ç–µ–ª–∞), Authorization (—Ç–æ–∫–µ–Ω), –∏ —Ç.–¥. Middleware —á–∏—Ç–∞–µ—Ç –∑–∞–≥–æ–ª–æ–≤–æ–∫, –∏–∑–≤–ª–µ–∫–∞–µ—Ç —Ç–æ–∫–µ–Ω –∏ –≤—ã–∑—ã–≤–∞–µ—Ç `jwt.verify()`; –ø—Ä–∏ —É—Å–ø–µ—Ö–µ –∑–∞–ø–∏—Å—ã–≤–∞–µ—Ç –¥–∞–Ω–Ω—ã–µ –≤ `req.user`, —á—Ç–æ–±—ã –∫–æ–Ω—Ç—Ä–æ–ª–ª–µ—Ä –º–æ–≥ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å –∏—Ö –±–µ–∑ –ø–æ–≤—Ç–æ—Ä–Ω–æ–π –ø—Ä–æ–≤–µ—Ä–∫–∏.

**–°–∏–Ω—Ç–∞–∫—Å–∏—Å –∏ –∫–æ–Ω—Ü–µ–ø—Ü–∏–∏:**

- **`export const authenticateToken = (req, res, next) => { ... }`** ‚Äî —ç–∫—Å–ø–æ—Ä—Ç–∏—Ä—É–µ—Ç —Ñ—É–Ω–∫—Ü–∏—é-middleware. –¢—Ä–∏ –ø–∞—Ä–∞–º–µ—Ç—Ä–∞: `req` (–∑–∞–ø—Ä–æ—Å), `res` (–æ—Ç–≤–µ—Ç), `next` (—Å–ª–µ–¥—É—é—â–∏–π –æ–±—Ä–∞–±–æ—Ç—á–∏–∫).
- **`req.headers['authorization']`** ‚Äî –∑–∞–≥–æ–ª–æ–≤–∫–∏ HTTP-–∑–∞–ø—Ä–æ—Å–∞. `authorization` –æ–±—ã—á–Ω–æ –ø–∏—à–µ—Ç—Å—è –≤ –Ω–∏–∂–Ω–µ–º —Ä–µ–≥–∏—Å—Ç—Ä–µ, –Ω–æ Express –Ω–æ—Ä–º–∞–ª–∏–∑—É–µ—Ç –∫–ª—é—á–∏.
- **`authHeader && authHeader.split(' ')[1]`** ‚Äî –ø—Ä–æ–≤–µ—Ä–∫–∞ –∏ –∏–∑–≤–ª–µ—á–µ–Ω–∏–µ —Ç–æ–∫–µ–Ω–∞. `authHeader &&` ‚Äî –µ—Å–ª–∏ `authHeader` —Å—É—â–µ—Å—Ç–≤—É–µ—Ç, —Ç–æ –≤—ã–ø–æ–ª–Ω—è–µ—Ç—Å—è `split(' ')[1]`. `split(' ')` —Ä–∞–∑–±–∏–≤–∞–µ—Ç —Å—Ç—Ä–æ–∫—É –ø–æ –ø—Ä–æ–±–µ–ª—É, `[1]` –±–µ—Ä—ë—Ç –≤—Ç–æ—Ä–æ–π —ç–ª–µ–º–µ–Ω—Ç (—Ç–æ–∫–µ–Ω –ø–æ—Å–ª–µ "Bearer").
- **`jwt.verify(token, JWT_SECRET, callback)`** ‚Äî –ø—Ä–æ–≤–µ—Ä—è–µ—Ç JWT. `jwt` ‚Äî –±–∏–±–ª–∏–æ—Ç–µ–∫–∞ `jsonwebtoken`. `verify` ‚Äî –∞—Å–∏–Ω—Ö—Ä–æ–Ω–Ω–∞—è —Ñ—É–Ω–∫—Ü–∏—è —Å –∫–æ–ª–±—ç–∫–æ–º: –ø–µ—Ä–≤—ã–π –∞—Ä–≥—É–º–µ–Ω—Ç –∫–æ–ª–±—ç–∫–∞ ‚Äî –æ—à–∏–±–∫–∞ (–µ—Å–ª–∏ –µ—Å—Ç—å), –≤—Ç–æ—Ä–æ–π ‚Äî —Ä–∞—Å—à–∏—Ñ—Ä–æ–≤–∞–Ω–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ (–µ—Å–ª–∏ –≤–∞–ª–∏–¥–Ω–æ).
- **`req.user = user`** ‚Äî –∫–ª–∞–¥—ë—Ç –¥–∞–Ω–Ω—ã–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è –≤ –æ–±—ä–µ–∫—Ç –∑–∞–ø—Ä–æ—Å–∞. –¢–µ–ø–µ—Ä—å –≤ –∫–æ–Ω—Ç—Ä–æ–ª–ª–µ—Ä–µ –º–æ–∂–Ω–æ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å `req.user.userId`, `req.user.email` –∏ —Ç.–¥.
- **`next()`** ‚Äî –ø–µ—Ä–µ–¥–∞—ë—Ç —É–ø—Ä–∞–≤–ª–µ–Ω–∏–µ —Å–ª–µ–¥—É—é—â–µ–º—É –æ–±—Ä–∞–±–æ—Ç—á–∏–∫—É (–∫–æ–Ω—Ç—Ä–æ–ª–ª–µ—Ä—É). –ë–µ–∑ `next()` –∑–∞–ø—Ä–æ—Å –Ω–µ –¥–æ–π–¥—ë—Ç –¥–æ –∫–æ–Ω—Ç—Ä–æ–ª–ª–µ—Ä–∞.
- **`return res.status(401).json(...)`** ‚Äî –æ—Ç–ø—Ä–∞–≤–ª—è–µ—Ç –æ—Ç–≤–µ—Ç –∏ –ø—Ä–µ—Ä—ã–≤–∞–µ—Ç –≤—ã–ø–æ–ª–Ω–µ–Ω–∏–µ —Ñ—É–Ω–∫—Ü–∏–∏. `return` –∑–¥–µ—Å—å –Ω–µ –æ–±—è–∑–∞—Ç–µ–ª–µ–Ω, –Ω–æ —è–≤–Ω–æ –ø–æ–∫–∞–∑—ã–≤–∞–µ—Ç, —á—Ç–æ —Ñ—É–Ω–∫—Ü–∏—è –∑–∞–≤–µ—Ä—à–∞–µ—Ç—Å—è.

**–ö–æ–¥ –∏–∑ –ø—Ä–æ–µ–∫—Ç–∞.** –§–∞–π–ª: `my_serve_chat_test/middleware/auth.js`

```javascript
import jwt from 'jsonwebtoken';

const JWT_SECRET = process.env.JWT_SECRET;

export const authenticateToken = (req, res, next) => {
  if (!JWT_SECRET) {
    return res.status(500).json({ message: 'JWT_SECRET –Ω–µ –Ω–∞—Å—Ç—Ä–æ–µ–Ω –Ω–∞ —Å–µ—Ä–≤–µ—Ä–µ' });
  }

  const authHeader = req.headers['authorization'];
  const token = authHeader && authHeader.split(' ')[1]; // "Bearer TOKEN" -> TOKEN

  if (!token) {
    return res.status(401).json({ message: '–¢–æ–∫–µ–Ω –¥–æ—Å—Ç—É–ø–∞ –æ—Ç—Å—É—Ç—Å—Ç–≤—É–µ—Ç' });
  }

  jwt.verify(token, JWT_SECRET, (err, user) => {
    if (err) {
      return res.status(403).json({ message: '–ù–µ–¥–µ–π—Å—Ç–≤–∏—Ç–µ–ª—å–Ω—ã–π —Ç–æ–∫–µ–Ω' });
    }
    req.user = user;       // –¥–∞–Ω–Ω—ã–µ –∏–∑ —Ç–æ–∫–µ–Ω–∞ (userId, email, privateAccess...)
    req.userId = user.userId;
    req.user.privateAccess = user.privateAccess === true;
    next();                // –ø–µ—Ä–µ–¥–∞—ë–º —É–ø—Ä–∞–≤–ª–µ–Ω–∏–µ —Å–ª–µ–¥—É—é—â–µ–º—É –æ–±—Ä–∞–±–æ—Ç—á–∏–∫—É
  });
};
```

**–ì–µ–Ω–µ—Ä–∞—Ü–∏—è —Ç–æ–∫–µ–Ω–∞ (–∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è –≤ –∫–æ–Ω—Ç—Ä–æ–ª–ª–µ—Ä–µ –ø–æ—Å–ª–µ –ª–æ–≥–∏–Ω–∞/—Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏–∏):**

```javascript
export const generateToken = (userId, username, privateAccess = false) => {
  if (!JWT_SECRET) throw new Error('JWT_SECRET –Ω–µ –Ω–∞—Å—Ç—Ä–æ–µ–Ω');
  return jwt.sign(
    { userId, email: username, username, privateAccess: privateAccess === true },
    JWT_SECRET,
    { expiresIn: '7d' }
  );
};
```

**–°–∏–Ω—Ç–∞–∫—Å–∏—Å `generateToken`:**

- **`export const generateToken = (userId, username, privateAccess = false) => { ... }`** ‚Äî —Ñ—É–Ω–∫—Ü–∏—è —Å –ø–∞—Ä–∞–º–µ—Ç—Ä–∞–º–∏ –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é. –ï—Å–ª–∏ `privateAccess` –Ω–µ –ø–µ—Ä–µ–¥–∞–Ω, –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è `false`.
- **`jwt.sign(payload, secret, options)`** ‚Äî —Å–æ–∑–¥–∞—ë—Ç JWT. `payload` ‚Äî –¥–∞–Ω–Ω—ã–µ, –∫–æ—Ç–æ—Ä—ã–µ –±—É–¥—É—Ç –≤ —Ç–æ–∫–µ–Ω–µ (–æ–±—ä–µ–∫—Ç). `secret` ‚Äî —Å–µ–∫—Ä–µ—Ç–Ω—ã–π –∫–ª—é—á –¥–ª—è –ø–æ–¥–ø–∏—Å–∏. `options` ‚Äî –æ–ø—Ü–∏–∏ (–Ω–∞–ø—Ä–∏–º–µ—Ä, `expiresIn: '7d'` ‚Äî —Ç–æ–∫–µ–Ω –¥–µ–π—Å—Ç–≤–∏—Ç–µ–ª–µ–Ω 7 –¥–Ω–µ–π).
- **`{ userId, email: username, username, privateAccess: privateAccess === true }`** ‚Äî –æ–±—ä–µ–∫—Ç-–ª–∏—Ç–µ—Ä–∞–ª. `userId` ‚Äî –∫–æ—Ä–æ—Ç–∫–∞—è –∑–∞–ø–∏—Å—å –¥–ª—è `userId: userId`. `email: username` ‚Äî –ø–æ–ª–µ `email` –ø–æ–ª—É—á–∞–µ—Ç –∑–Ω–∞—á–µ–Ω–∏–µ `username`. `privateAccess === true` ‚Äî —è–≤–Ω–æ–µ –ø—Ä–∏–≤–µ–¥–µ–Ω–∏–µ –∫ boolean.

**–ß—Ç–æ –Ω—É–∂–Ω–æ –∑–Ω–∞—Ç—å:** —á—Ç–æ —Ç–∞–∫–æ–µ JWT (JSON Web Token), —á—Ç–æ —Ç–∞–∫–æ–µ middleware, –∫–∞–∫ —Ä–∞–±–æ—Ç–∞—é—Ç –∑–∞–≥–æ–ª–æ–≤–∫–∏ HTTP, —á—Ç–æ —Ç–∞–∫–æ–µ –∫–æ–ª–±—ç–∫–∏ (callbacks).

---

### 2.6. WebSocket: –ø–æ–¥–∫–ª—é—á–µ–Ω–∏–µ –∏ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ –∫–ª–∏–µ–Ω—Ç–∞

**–ü—Ä–æ—Å—Ç—ã–º–∏ —Å–ª–æ–≤–∞–º–∏:** –æ–±—ã—á–Ω—ã–π –∑–∞–ø—Ä–æ—Å ‚Äî —ç—Ç–æ ¬´–≤–æ–ø—Ä–æ—Å ‚Äî –æ—Ç–≤–µ—Ç¬ª: –∫–ª–∏–µ–Ω—Ç –æ—Ç–ø—Ä–∞–≤–∏–ª –∑–∞–ø—Ä–æ—Å, –ø–æ–ª—É—á–∏–ª –æ—Ç–≤–µ—Ç, —Å–≤—è–∑—å –∑–∞–∫–æ–Ω—á–∏–ª–∞—Å—å. –î–ª—è —á–∞—Ç–∞ –≤ —Ä–µ–∞–ª—å–Ω–æ–º –≤—Ä–µ–º–µ–Ω–∏ –Ω—É–∂–Ω–∞ ¬´–ø–æ—Å—Ç–æ—è–Ω–Ω–∞—è –ª–∏–Ω–∏—è¬ª: —Å–µ—Ä–≤–µ—Ä –º–æ–∂–µ—Ç –≤ –ª—é–±–æ–π –º–æ–º–µ–Ω—Ç –æ—Ç–ø—Ä–∞–≤–∏—Ç—å –Ω–æ–≤–æ–µ —Å–æ–æ–±—â–µ–Ω–∏–µ –∫–ª–∏–µ–Ω—Ç—É –±–µ–∑ –Ω–æ–≤–æ–≥–æ –∑–∞–ø—Ä–æ—Å–∞. WebSocket ‚Äî —ç—Ç–æ –∫–∞–∫ —Ä–∞–∑ —Ç–∞–∫–∞—è –ø–æ—Å—Ç–æ—è–Ω–Ω–∞—è —Å–≤—è–∑—å. –°–µ—Ä–≤–µ—Ä —Ö—Ä–∞–Ω–∏—Ç —Å–ø–∏—Å–æ–∫ –ø–æ–¥–∫–ª—é—á—ë–Ω–Ω—ã—Ö –∫–ª–∏–µ–Ω—Ç–æ–≤ –ø–æ –∏—Ö ID –∏ –ø—Ä–∏ –Ω–æ–≤–æ–º —Å–æ–æ–±—â–µ–Ω–∏–∏ —Ä–∞—Å—Å—ã–ª–∞–µ—Ç –µ–≥–æ –≤—Å–µ–º —É—á–∞—Å—Ç–Ω–∏–∫–∞–º —á–∞—Ç–∞.

**–ß—Ç–æ –¥–µ–ª–∞–µ—Ç:** –ø–æ–¥–Ω–∏–º–∞–µ—Ç WebSocket-—Å–µ—Ä–≤–µ—Ä –Ω–∞ —Ç–æ–º –∂–µ HTTP-—Å–µ—Ä–≤–µ—Ä–µ. –ü—Ä–∏ –ø–æ–¥–∫–ª—é—á–µ–Ω–∏–∏ –∫–ª–∏–µ–Ω—Ç –ø–µ—Ä–µ–¥–∞—ë—Ç —Ç–æ–∫–µ–Ω, —Å–µ—Ä–≤–µ—Ä –ø—Ä–æ–≤–µ—Ä—è–µ—Ç —Ç–æ–∫–µ–Ω, —Å–æ—Ö—Ä–∞–Ω—è–µ—Ç —Å–æ–µ–¥–∏–Ω–µ–Ω–∏–µ –≤ `Map` –ø–æ `userId`. –î–∞–ª—å—à–µ –ø—Ä–∏ —Å–æ–±—ã—Ç–∏—è—Ö (–Ω–æ–≤–æ–µ —Å–æ–æ–±—â–µ–Ω–∏–µ, ¬´–ø–µ—á–∞—Ç–∞–µ—Ç¬ª) —Å–µ—Ä–≤–µ—Ä —Ä–∞—Å—Å—ã–ª–∞–µ—Ç –¥–∞–Ω–Ω—ã–µ —É—á–∞—Å—Ç–Ω–∏–∫–∞–º —á–∞—Ç–∞ –ø–æ –æ—Ç–∫—Ä—ã—Ç—ã–º —Å–æ–∫–µ—Ç–∞–º.

**–ö–∞–∫ —Ä–∞–±–æ—Ç–∞–µ—Ç:** WebSocket ‚Äî –ø—Ä–æ—Ç–æ–∫–æ–ª –¥–ª—è –¥–≤—É—Å—Ç–æ—Ä–æ–Ω–Ω–µ–π —Å–≤—è–∑–∏ –ø–æ–≤–µ—Ä—Ö HTTP. –ö–ª–∏–µ–Ω—Ç –æ—Ç–∫—Ä—ã–≤–∞–µ—Ç —Å–æ–µ–¥–∏–Ω–µ–Ω–∏–µ, —Å–µ—Ä–≤–µ—Ä –µ–≥–æ –ø—Ä–∏–Ω–∏–º–∞–µ—Ç. –ü–æ—Å–ª–µ —ç—Ç–æ–≥–æ –∏ –∫–ª–∏–µ–Ω—Ç, –∏ —Å–µ—Ä–≤–µ—Ä –º–æ–≥—É—Ç –æ—Ç–ø—Ä–∞–≤–ª—è—Ç—å —Å–æ–æ–±—â–µ–Ω–∏—è –≤ –ª—é–±–æ–π –º–æ–º–µ–Ω—Ç (–±–µ–∑ —Ü–∏–∫–ª–∞ ¬´–∑–∞–ø—Ä–æ—Å ‚Äî –æ—Ç–≤–µ—Ç¬ª).

**–¢–µ–æ—Ä–∏—è.** **HTTP** ‚Äî –ø—Ä–æ—Ç–æ–∫–æ–ª ¬´–∑–∞–ø—Ä–æ—Å ‚Äî –æ—Ç–≤–µ—Ç¬ª: –∫–ª–∏–µ–Ω—Ç –æ—Ç–ø—Ä–∞–≤–ª—è–µ—Ç –æ–¥–∏–Ω –∑–∞–ø—Ä–æ—Å, —Å–µ—Ä–≤–µ—Ä –≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç –æ–¥–∏–Ω –æ—Ç–≤–µ—Ç, —Å–æ–µ–¥–∏–Ω–µ–Ω–∏–µ –º–æ–∂–Ω–æ –∑–∞–∫—Ä—ã—Ç—å. –î–ª—è —á–∞—Ç–∞ –≤ —Ä–µ–∞–ª—å–Ω–æ–º –≤—Ä–µ–º–µ–Ω–∏ —ç—Ç–æ –Ω–µ—É–¥–æ–±–Ω–æ: —á—Ç–æ–±—ã –ø–æ–ª—É—á–∞—Ç—å –Ω–æ–≤—ã–µ —Å–æ–æ–±—â–µ–Ω–∏—è, –ø—Ä–∏—à–ª–æ—Å—å –±—ã –ø–æ—Å—Ç–æ—è–Ω–Ω–æ –æ–ø—Ä–∞—à–∏–≤–∞—Ç—å —Å–µ—Ä–≤–µ—Ä (polling) ‚Äî –ª–∏—à–Ω—è—è –Ω–∞–≥—Ä—É–∑–∫–∞ –∏ –∑–∞–¥–µ—Ä–∂–∫–∞. **WebSocket** ‚Äî –ø—Ä–æ—Ç–æ–∫–æ–ª –ø–æ–ª–Ω–æ –¥—É–ø–ª–µ–∫—Å–Ω–æ–π —Å–≤—è–∑–∏ –ø–æ–≤–µ—Ä—Ö TCP: –ø–æ—Å–ª–µ —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∏—è —Å–æ–µ–¥–∏–Ω–µ–Ω–∏—è (handshake –ø–æ HTTP) –∫–∞–Ω–∞–ª –æ—Å—Ç–∞—ë—Ç—Å—è –æ—Ç–∫—Ä—ã—Ç—ã–º, –∏ –ª—é–±–∞—è —Å—Ç–æ—Ä–æ–Ω–∞ –º–æ–∂–µ—Ç –≤ –ª—é–±–æ–π –º–æ–º–µ–Ω—Ç –æ—Ç–ø—Ä–∞–≤–∏—Ç—å –∫–∞–¥—Ä –¥–∞–Ω–Ω—ã—Ö. –°–µ—Ä–≤–µ—Ä –ø—Ä–∏ –ø–æ—è–≤–ª–µ–Ω–∏–∏ –Ω–æ–≤–æ–≥–æ —Å–æ–æ–±—â–µ–Ω–∏—è —Å—Ä–∞–∑—É —à–ª—ë—Ç –µ–≥–æ –≤—Å–µ–º –ø–æ–¥–∫–ª—é—á—ë–Ω–Ω—ã–º –∫–ª–∏–µ–Ω—Ç–∞–º —ç—Ç–æ–≥–æ —á–∞—Ç–∞ ‚Äî –±–µ–∑ –æ–∂–∏–¥–∞–Ω–∏—è –∑–∞–ø—Ä–æ—Å–∞. –í –ø—Ä–æ–µ–∫—Ç–µ WebSocket –ø–æ–¥–Ω–∏–º–∞–µ—Ç—Å—è –Ω–∞ —Ç–æ–º –∂–µ HTTP-—Å–µ—Ä–≤–µ—Ä–µ (–æ–¥–∏–Ω –ø–æ—Ä—Ç): –ø—Ä–∏ –ø–µ—Ä–≤–æ–º –∑–∞–ø—Ä–æ—Å–µ –ø–æ —Å–ø–µ—Ü–∏–∞–ª—å–Ω–æ–º—É URL –±—Ä–∞—É–∑–µ—Ä –∏ —Å–µ—Ä–≤–µ—Ä ¬´–¥–æ–≥–æ–≤–∞—Ä–∏–≤–∞—é—Ç—Å—è¬ª –ø–µ—Ä–µ–π—Ç–∏ –Ω–∞ –ø—Ä–æ—Ç–æ–∫–æ–ª WebSocket (upgrade), –¥–∞–ª—å—à–µ –ø–æ —ç—Ç–æ–º—É —Å–æ–µ–¥–∏–Ω–µ–Ω–∏—é –∏–¥—É—Ç —É–∂–µ WebSocket-–∫–∞–¥—Ä—ã. **Map** –¥–ª—è —Ö—Ä–∞–Ω–µ–Ω–∏—è –∫–ª–∏–µ–Ω—Ç–æ–≤: –Ω—É–∂–Ω–∞ —Å—Ç—Ä—É–∫—Ç—É—Ä–∞ ¬´userId ‚Üí —Å–æ–µ–¥–∏–Ω–µ–Ω–∏–µ¬ª, —á—Ç–æ–±—ã –ø—Ä–∏ –Ω–æ–≤–æ–º —Å–æ–æ–±—â–µ–Ω–∏–∏ –≤ —á–∞—Ç –Ω–∞–π—Ç–∏ –≤—Å–µ —Å–æ–µ–¥–∏–Ω–µ–Ω–∏—è —É—á–∞—Å—Ç–Ω–∏–∫–æ–≤ –∏ —Ä–∞–∑–æ—Å–ª–∞—Ç—å –∏–º –¥–∞–Ω–Ω—ã–µ. Map –ø–æ–¥—Ö–æ–¥–∏—Ç –ª—É—á—à–µ –æ–±—ã—á–Ω–æ–≥–æ –æ–±—ä–µ–∫—Ç–∞, –∫–æ–≥–¥–∞ –∫–ª—é—á–∏ –¥–∏–Ω–∞–º–∏—á–µ—Å–∫–∏–µ –∏ —á–∞—Å—Ç–æ –¥–æ–±–∞–≤–ª—è—é—Ç—Å—è/—É–¥–∞–ª—è—é—Ç—Å—è (–ø–æ–¥–∫–ª—é—á–µ–Ω–∏–µ/–æ—Ç–∫–ª—é—á–µ–Ω–∏–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π).

**–°–∏–Ω—Ç–∞–∫—Å–∏—Å –∏ –∫–æ–Ω—Ü–µ–ø—Ü–∏–∏:**

- **`import { WebSocketServer } from 'ws'`** ‚Äî –∏–º–ø–æ—Ä—Ç–∏—Ä—É–µ—Ç –∫–ª–∞—Å—Å `WebSocketServer` –∏–∑ –±–∏–±–ª–∏–æ—Ç–µ–∫–∏ `ws` (WebSocket –¥–ª—è Node.js).
- **`const clients = new Map()`** ‚Äî —Å–æ–∑–¥–∞—ë—Ç Map (—Å–ª–æ–≤–∞—Ä—å). –ö–ª—é—á ‚Äî `userId` (—Å—Ç—Ä–æ–∫–∞), –∑–Ω–∞—á–µ–Ω–∏–µ ‚Äî WebSocket-—Å–æ–µ–¥–∏–Ω–µ–Ω–∏–µ. `Map` –ª—É—á—à–µ —á–µ–º –æ–±—ä–µ–∫—Ç `{}` –∫–æ–≥–¥–∞ –∫–ª—é—á–∏ –¥–∏–Ω–∞–º–∏—á–µ—Å–∫–∏–µ –∏ –Ω—É–∂–Ω–æ —á–∞—Å—Ç–æ –¥–æ–±–∞–≤–ª—è—Ç—å/—É–¥–∞–ª—è—Ç—å.
- **`const wss = new WebSocketServer({ server })`** ‚Äî —Å–æ–∑–¥–∞—ë—Ç WebSocket-—Å–µ—Ä–≤–µ—Ä –Ω–∞ —Ç–æ–º –∂–µ `server`, —á—Ç–æ –∏ Express. –û–¥–∏–Ω –ø–æ—Ä—Ç, –¥–≤–∞ –ø—Ä–æ—Ç–æ–∫–æ–ª–∞ (HTTP –∏ WebSocket).
- **`wss.on('connection', (ws, req) => { ... })`** ‚Äî –æ–±—Ä–∞–±–æ—Ç—á–∏–∫ —Å–æ–±—ã—Ç–∏—è `connection`. –ö–æ–≥–¥–∞ –∫–ª–∏–µ–Ω—Ç –ø–æ–¥–∫–ª—é—á–∞–µ—Ç—Å—è, –≤—ã–∑—ã–≤–∞–µ—Ç—Å—è —ç—Ç–∞ —Ñ—É–Ω–∫—Ü–∏—è. `ws` ‚Äî –æ–±—ä–µ–∫—Ç WebSocket-—Å–æ–µ–¥–∏–Ω–µ–Ω–∏—è, `req` ‚Äî HTTP-–∑–∞–ø—Ä–æ—Å (–∏–∑ –Ω–µ–≥–æ –º–æ–∂–Ω–æ –¥–æ—Å—Ç–∞—Ç—å –∑–∞–≥–æ–ª–æ–≤–∫–∏, query-–ø–∞—Ä–∞–º–µ—Ç—Ä—ã).
- **`req.headers['authorization']`** ‚Äî –∑–∞–≥–æ–ª–æ–≤–∫–∏ –∏–∑ HTTP-–∑–∞–ø—Ä–æ—Å–∞ (—Ç–æ—Ç –∂–µ —Ñ–æ—Ä–º–∞—Ç, —á—Ç–æ –∏ –≤ REST API).
- **`authHeader.toLowerCase().startsWith('bearer ')`** ‚Äî –ø—Ä–æ–≤–µ—Ä—è–µ—Ç, –Ω–∞—á–∏–Ω–∞–µ—Ç—Å—è –ª–∏ —Å—Ç—Ä–æ–∫–∞ —Å "bearer " (—Ä–µ–≥–∏—Å—Ç—Ä–æ–Ω–µ–∑–∞–≤–∏—Å–∏–º–æ). `toLowerCase()` ‚Äî –ø—Ä–∏–≤–æ–¥–∏—Ç –∫ –Ω–∏–∂–Ω–µ–º—É —Ä–µ–≥–∏—Å—Ç—Ä—É, `startsWith()` ‚Äî –ø—Ä–æ–≤–µ—Ä—è–µ—Ç –Ω–∞—á–∞–ª–æ —Å—Ç—Ä–æ–∫–∏.
- **`authHeader.slice(7).trim()`** ‚Äî –∏–∑–≤–ª–µ–∫–∞–µ—Ç —Ç–æ–∫–µ–Ω. `slice(7)` ‚Äî –±–µ—Ä—ë—Ç –ø–æ–¥—Å—Ç—Ä–æ–∫—É —Å 7-–≥–æ —Å–∏–º–≤–æ–ª–∞ (–ø–æ—Å–ª–µ "Bearer "), `trim()` ‚Äî —É–±–∏—Ä–∞–µ—Ç –ø—Ä–æ–±–µ–ª—ã –ø–æ –∫—Ä–∞—è–º.
- **`new URL(req.url, ...)`** ‚Äî –ø–∞—Ä—Å–∏—Ç URL. `req.url` ‚Äî –ø—É—Ç—å + query (–Ω–∞–ø—Ä–∏–º–µ—Ä, `/ws?token=...`). –í—Ç–æ—Ä–æ–π –∞—Ä–≥—É–º–µ–Ω—Ç ‚Äî –±–∞–∑–æ–≤—ã–π URL (–Ω—É–∂–µ–Ω –¥–ª—è –ø–∞—Ä—Å–∏–Ω–≥–∞).
- **`url.searchParams.get('token')`** ‚Äî –¥–æ—Å—Ç–∞—ë—Ç query-–ø–∞—Ä–∞–º–µ—Ç—Ä `token` –∏–∑ URL.
- **`ws.close(1008, '–¢–æ–∫–µ–Ω –æ—Ç—Å—É—Ç—Å—Ç–≤—É–µ—Ç')`** ‚Äî –∑–∞–∫—Ä—ã–≤–∞–µ—Ç WebSocket-—Å–æ–µ–¥–∏–Ω–µ–Ω–∏–µ. `1008` ‚Äî –∫–æ–¥ –∑–∞–∫—Ä—ã—Ç–∏—è (—Å—Ç–∞–Ω–¥–∞—Ä—Ç WebSocket), –≤—Ç–æ—Ä–æ–π –∞—Ä–≥—É–º–µ–Ω—Ç ‚Äî –ø—Ä–∏—á–∏–Ω–∞.
- **`clients.set(userId, ws)`** ‚Äî —Å–æ—Ö—Ä–∞–Ω—è–µ—Ç —Å–æ–µ–¥–∏–Ω–µ–Ω–∏–µ –≤ Map. `set(key, value)` ‚Äî –¥–æ–±–∞–≤–ª—è–µ—Ç –∏–ª–∏ –æ–±–Ω–æ–≤–ª—è–µ—Ç –ø–∞—Ä—É –∫–ª—é—á-–∑–Ω–∞—á–µ–Ω–∏–µ.
- **`ws.userId = userId`** ‚Äî –¥–æ–±–∞–≤–ª—è–µ—Ç —Å–≤–æ–π—Å—Ç–≤–æ –∫ –æ–±—ä–µ–∫—Ç—É `ws`. –≠—Ç–æ –Ω–µ —Å—Ç–∞–Ω–¥–∞—Ä—Ç–Ω–æ–µ —Å–≤–æ–π—Å—Ç–≤–æ WebSocket, –∞ –Ω–∞—à–µ ‚Äî —á—Ç–æ–±—ã –ø–æ—Ç–æ–º –∑–Ω–∞—Ç—å, –∫–∞–∫–æ–π –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –∑–∞ —ç—Ç–∏–º —Å–æ–µ–¥–∏–Ω–µ–Ω–∏–µ–º.
- **`ws.on('message', async (message) => { ... })`** ‚Äî –æ–±—Ä–∞–±–æ—Ç—á–∏–∫ –≤—Ö–æ–¥—è—â–∏—Ö —Å–æ–æ–±—â–µ–Ω–∏–π. –ö–æ–≥–¥–∞ –∫–ª–∏–µ–Ω—Ç –æ—Ç–ø—Ä–∞–≤–ª—è–µ—Ç —Å–æ–æ–±—â–µ–Ω–∏–µ, –≤—ã–∑—ã–≤–∞–µ—Ç—Å—è —ç—Ç–∞ —Ñ—É–Ω–∫—Ü–∏—è. `message` ‚Äî —Å—Ç—Ä–æ–∫–∞ –∏–ª–∏ Buffer (–æ–±—ã—á–Ω–æ JSON-—Å—Ç—Ä–æ–∫–∞).
- **`ws.on('close', () => { ... })`** ‚Äî –æ–±—Ä–∞–±–æ—Ç—á–∏–∫ –∑–∞–∫—Ä—ã—Ç–∏—è —Å–æ–µ–¥–∏–Ω–µ–Ω–∏—è. –ö–æ–≥–¥–∞ –∫–ª–∏–µ–Ω—Ç –æ—Ç–∫–ª—é—á–∞–µ—Ç—Å—è, –≤—ã–∑—ã–≤–∞–µ—Ç—Å—è —ç—Ç–∞ —Ñ—É–Ω–∫—Ü–∏—è. –ó–¥–µ—Å—å —É–¥–∞–ª—è–µ–º —Å–æ–µ–¥–∏–Ω–µ–Ω–∏–µ –∏–∑ Map.

**–ö–æ–¥ –∏–∑ –ø—Ä–æ–µ–∫—Ç–∞.** –§–∞–π–ª: `my_serve_chat_test/websocket/websocket.js`

```javascript
import { WebSocketServer } from 'ws';
import { verifyWebSocketToken } from '../middleware/auth.js';

const clients = new Map(); // userId -> WebSocket

export function setupWebSocket(server) {
  const wss = new WebSocketServer({ server });

  wss.on('connection', (ws, req) => {
    let token = null;
    const authHeader = (req.headers['authorization'] || '').toString();
    if (authHeader.toLowerCase().startsWith('bearer ')) {
      token = authHeader.slice(7).trim();
    }
    if (!token) {
      const url = new URL(req.url, `http://${req.headers.host}`);
      token = url.searchParams.get('token');
    }

    if (!token) {
      ws.close(1008, '–¢–æ–∫–µ–Ω –æ—Ç—Å—É—Ç—Å—Ç–≤—É–µ—Ç');
      return;
    }

    const decoded = verifyWebSocketToken(token);
    if (!decoded) {
      ws.close(1008, '–ù–µ–¥–µ–π—Å—Ç–≤–∏—Ç–µ–ª—å–Ω—ã–π —Ç–æ–∫–µ–Ω');
      return;
    }

    const userId = decoded.userId.toString();
    clients.set(userId, ws);
    ws.userId = userId;
    ws.userEmail = decoded.email;
    ws.subscriptions = new Set(); // –ø–æ–¥–ø–∏—Å–∫–∏ –Ω–∞ —á–∞—Ç—ã (presence, typing)

    ws.on('message', async (message) => {
      const data = JSON.parse(message);
      // –û–±—Ä–∞–±–æ—Ç–∫–∞ subscribe, typing, –∏ —Ç.–¥.
    });

    ws.on('close', () => {
      clients.delete(userId);
    });
  });
}
```

**–ß—Ç–æ –Ω—É–∂–Ω–æ –∑–Ω–∞—Ç—å:** —á—Ç–æ —Ç–∞–∫–æ–µ WebSocket, —á—Ç–æ —Ç–∞–∫–æ–µ Map –≤ JavaScript, –∫–∞–∫ —Ä–∞–±–æ—Ç–∞—é—Ç —Å–æ–±—ã—Ç–∏—è (event listeners), —á—Ç–æ —Ç–∞–∫–æ–µ JSON.parse.

---

## 3. –ß–∞—Å—Ç—å II: –ö–ª–∏–µ–Ω—Ç (Flutter / Dart)

**–ü—Ä–æ—Å—Ç—ã–º–∏ —Å–ª–æ–≤–∞–º–∏:** –∫–ª–∏–µ–Ω—Ç ‚Äî —ç—Ç–æ —Ç–æ, —á—Ç–æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –≤–∏–¥–∏—Ç –∏ —Ç—Ä–æ–≥–∞–µ—Ç: —ç–∫—Ä–∞–Ω—ã –≤—Ö–æ–¥–∞, —á–∞—Ç—ã, –∫–Ω–æ–ø–∫–∏. –í—Å—ë —ç—Ç–æ —Å–æ–±—Ä–∞–Ω–æ –≤–æ Flutter (—è–∑—ã–∫ Dart). –ò–Ω—Ç–µ—Ä—Ñ–µ–π—Å —Å—Ç—Ä–æ–∏—Ç—Å—è –∏–∑ ¬´–≤–∏–¥–∂–µ—Ç–æ–≤¬ª ‚Äî –º–∞–ª–µ–Ω—å–∫–∏—Ö –±–ª–æ–∫–æ–≤ (–∫–Ω–æ–ø–∫–∞, –ø–æ–ª–µ –≤–≤–æ–¥–∞, —ç–∫—Ä–∞–Ω). –í–∏–¥–∂–µ—Ç—ã —Å–∫–ª–∞–¥—ã–≤–∞—é—Ç—Å—è –≤ –¥–µ—Ä–µ–≤–æ: –æ–¥–∏–Ω –∫–æ—Ä–Ω–µ–≤–æ–π –≤–∏–¥–∂–µ—Ç, –≤–Ω—É—Ç—Ä–∏ –Ω–µ–≥–æ –¥—Ä—É–≥–∏–µ, –∏ —Ç–∞–∫ –¥–∞–ª–µ–µ.

**–¢–µ–æ—Ä–∏—è.** **Flutter** ‚Äî —Ñ—Ä–µ–π–º–≤–æ—Ä–∫ –æ—Ç Google –¥–ª—è –ø–æ—Å—Ç—Ä–æ–µ–Ω–∏—è –∫—Ä–æ—Å—Å–ø–ª–∞—Ç—Ñ–æ—Ä–º–µ–Ω–Ω–æ–≥–æ UI (–æ–¥–Ω–∞ –∫–æ–¥–æ–≤–∞—è –±–∞–∑–∞ ‚Äî –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ –¥–ª—è Android, iOS, web, –¥–µ—Å–∫—Ç–æ–ø). –Ø–∑—ã–∫ ‚Äî **Dart**. –ò–¥–µ—è Flutter ‚Äî **–¥–µ–∫–ª–∞—Ä–∞—Ç–∏–≤–Ω—ã–π –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å**: –≤—ã –æ–ø–∏—Å—ã–≤–∞–µ—Ç–µ, –∫–∞–∫ —ç–∫—Ä–∞–Ω –¥–æ–ª–∂–µ–Ω –≤—ã–≥–ª—è–¥–µ—Ç—å –≤ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏ –æ—Ç —Å–æ—Å—Ç–æ—è–Ω–∏—è (–¥–∞–Ω–Ω—ã–µ, —Ñ–ª–∞–≥–∏), –∞ —Ñ—Ä–µ–π–º–≤–æ—Ä–∫ –ø–µ—Ä–µ—Ä–∏—Å–æ–≤—ã–≤–∞–µ—Ç —Ç–æ–ª—å–∫–æ –∏–∑–º–µ–Ω–∏–≤—à–∏–µ—Å—è —á–∞—Å—Ç–∏. –í—Å—ë —Å—Ç—Ä–æ–∏—Ç—Å—è –∏–∑ **–≤–∏–¥–∂–µ—Ç–æ–≤** ‚Äî –Ω–µ–∏–∑–º–µ–Ω—è–µ–º—ã—Ö –æ–ø–∏—Å–∞–Ω–∏–π –∫—É—Å–∫–∞ UI (–≤–∏–¥–∂–µ—Ç –Ω–µ —Ö—Ä–∞–Ω–∏—Ç —Å–æ—Å—Ç–æ—è–Ω–∏–µ —Å–∞–º, –æ–Ω –ø–æ–ª—É—á–∞–µ—Ç –¥–∞–Ω–Ω—ã–µ –∏–∑–≤–Ω–µ –∏–ª–∏ –∏–∑ —Å–≤—è–∑–∞–Ω–Ω–æ–≥–æ –æ–±—ä–µ–∫—Ç–∞ State). –í–∏–¥–∂–µ—Ç—ã –æ–±—Ä–∞–∑—É—é—Ç –¥–µ—Ä–µ–≤–æ: –∫–æ—Ä–µ–Ω—å ‚Äî –Ω–∞–ø—Ä–∏–º–µ—Ä MaterialApp, –≤–Ω—É—Ç—Ä–∏ ‚Äî —ç–∫—Ä–∞–Ω—ã, –≤–Ω—É—Ç—Ä–∏ —ç–∫—Ä–∞–Ω–æ–≤ ‚Äî –∫–Ω–æ–ø–∫–∏, —Ç–µ–∫—Å—Ç—ã, —Å–ø–∏—Å–∫–∏. –ü—Ä–∏ –∏–∑–º–µ–Ω–µ–Ω–∏–∏ —Å–æ—Å—Ç–æ—è–Ω–∏—è (–Ω–∞–ø—Ä–∏–º–µ—Ä, –ø–æ—Å–ª–µ `setState`) Flutter —Å—Ä–∞–≤–Ω–∏–≤–∞–µ—Ç –Ω–æ–≤–æ–µ –¥–µ—Ä–µ–≤–æ —Å –ø—Ä–µ–¥—ã–¥—É—â–∏–º –∏ –æ–±–Ω–æ–≤–ª—è–µ—Ç —Ç–æ–ª—å–∫–æ —Ç–æ, —á—Ç–æ –∏–∑–º–µ–Ω–∏–ª–æ—Å—å. –¢–∞–∫ –¥–æ—Å—Ç–∏–≥–∞–µ—Ç—Å—è –∏ –ø—Ä–µ–¥—Å–∫–∞–∑—É–µ–º–æ—Å—Ç—å (UI = —Ñ—É–Ω–∫—Ü–∏—è –æ—Ç —Å–æ—Å—Ç–æ—è–Ω–∏—è), –∏ –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å. –†–∞–∑–¥–µ–ª–µ–Ω–∏–µ –Ω–∞ **screens**, **services**, **models** ‚Äî —Ç–∏–ø–∏—á–Ω–∞—è —Å—Ç—Ä—É–∫—Ç—É—Ä–∞: —ç–∫—Ä–∞–Ω—ã –æ—Ç–≤–µ—á–∞—é—Ç –∑–∞ –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏–µ –∏ —Ä–µ–∞–∫—Ü–∏—é –Ω–∞ –¥–µ–π—Å—Ç–≤–∏—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è, —Å–µ—Ä–≤–∏—Å—ã ‚Äî –∑–∞ –æ–±—Ä–∞—â–µ–Ω–∏–µ –∫ API –∏ –∫ —Ö—Ä–∞–Ω–∏–ª–∏—â—É, –º–æ–¥–µ–ª–∏ ‚Äî –∑–∞ —Å—Ç—Ä—É–∫—Ç—É—Ä—É –¥–∞–Ω–Ω—ã—Ö (—á–∞—Å—Ç–æ —Å –º–µ—Ç–æ–¥–∞–º–∏ fromJson/toJson –¥–ª—è –æ–±–º–µ–Ω–∞ —Å —Å–µ—Ä–≤–µ—Ä–æ–º).

---

### 3.1. –¢–æ—á–∫–∞ –≤—Ö–æ–¥–∞: `main()` –∏ `MyApp` ‚Äî –∑–∞–ø—É—Å–∫ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è

**–ü—Ä–æ—Å—Ç—ã–º–∏ —Å–ª–æ–≤–∞–º–∏:** `main()` ‚Äî —Å–∞–º–∞—è –ø–µ—Ä–≤–∞—è —Ñ—É–Ω–∫—Ü–∏—è, —Å –∫–æ—Ç–æ—Ä–æ–π –Ω–∞—á–∏–Ω–∞–µ—Ç—Å—è –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ. –û–Ω–∞ –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∏—Ä—É–µ—Ç —Ö—Ä–∞–Ω–∏–ª–∏—â–µ (–≥–¥–µ –±—É–¥—É—Ç —Ö—Ä–∞–Ω–∏—Ç—å—Å—è –ª–æ–≥–∏–Ω –∏ —Ç–æ–∫–µ–Ω) –∏ –∑–∞–ø—É—Å–∫–∞–µ—Ç –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ. `MyApp` ‚Äî –∫–æ—Ä–Ω–µ–≤–æ–π –≤–∏–¥–∂–µ—Ç: –æ–Ω —Ä–µ—à–∞–µ—Ç, —á—Ç–æ –ø–æ–∫–∞–∑–∞—Ç—å –ø–µ—Ä–≤—ã–º ‚Äî –≥–ª–∞–≤–Ω—ã–π —ç–∫—Ä–∞–Ω (–µ—Å–ª–∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å —É–∂–µ –≤—Ö–æ–¥–∏–ª –∏ –¥–∞–Ω–Ω—ã–µ —Å–æ—Ö—Ä–∞–Ω–µ–Ω—ã) –∏–ª–∏ —ç–∫—Ä–∞–Ω –≤—Ö–æ–¥–∞.

**–ß—Ç–æ –¥–µ–ª–∞–µ—Ç:** `main()` ‚Äî —Ç–æ—á–∫–∞ –≤—Ö–æ–¥–∞. –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∏—Ä—É–µ—Ç –ª–æ–∫–∞–ª—å–Ω–æ–µ —Ö—Ä–∞–Ω–∏–ª–∏—â–µ, –∑–∞–ø—É—Å–∫–∞–µ—Ç –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ. `MyApp` ‚Äî –∫–æ—Ä–Ω–µ–≤–æ–π –≤–∏–¥–∂–µ—Ç. –†–µ—à–∞–µ—Ç, —á—Ç–æ –ø–æ–∫–∞–∑–∞—Ç—å –ø–µ—Ä–≤—ã–º: –≥–ª–∞–≤–Ω—ã–π —ç–∫—Ä–∞–Ω (–µ—Å–ª–∏ –µ—Å—Ç—å —Å–æ—Ö—Ä–∞–Ω—ë–Ω–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ) –∏–ª–∏ —ç–∫—Ä–∞–Ω –≤—Ö–æ–¥–∞.

**–ö–∞–∫ —Ä–∞–±–æ—Ç–∞–µ—Ç:** Flutter ‚Äî —Ñ—Ä–µ–π–º–≤–æ—Ä–∫, –≥–¥–µ –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å —Å—Ç—Ä–æ–∏—Ç—Å—è –∏–∑ **–≤–∏–¥–∂–µ—Ç–æ–≤** (–¥–µ—Ä–µ–≤–æ –≤–∏–¥–∂–µ—Ç–æ–≤). `runApp(MyApp())` –∑–∞–ø—É—Å–∫–∞–µ—Ç –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ –∏ –ø–µ—Ä–µ–¥–∞—ë—Ç —É–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –≤–∏–¥–∂–µ—Ç—É `MyApp`. `MyApp` —Å—Ç—Ä–æ–∏—Ç `MaterialApp` (–∫–æ—Ä–µ–Ω—å –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è —Å —Ç–µ–º–æ–π, –Ω–∞–≤–∏–≥–∞—Ü–∏–µ–π), –∞ `home` –æ–ø—Ä–µ–¥–µ–ª—è–µ—Ç –ø–µ—Ä–≤—ã–π —ç–∫—Ä–∞–Ω.

**–¢–µ–æ—Ä–∏—è.** **–¢–æ—á–∫–∞ –≤—Ö–æ–¥–∞** ‚Äî —Ñ—É–Ω–∫—Ü–∏—è `main()`, —Å –∫–æ—Ç–æ—Ä–æ–π –Ω–∞—á–∏–Ω–∞–µ—Ç—Å—è –≤—ã–ø–æ–ª–Ω–µ–Ω–∏–µ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è. –í Dart –æ–Ω–∞ –æ–±—è–∑–∞—Ç–µ–ª—å–Ω–∞ –∏ –æ–¥–Ω–∞. –ü–µ—Ä–µ–¥ –æ—Ç—Ä–∏—Å–æ–≤–∫–æ–π UI —á–∞—Å—Ç–æ –Ω—É–∂–Ω–æ –≤—ã–ø–æ–ª–Ω–∏—Ç—å –∞—Å–∏–Ω—Ö—Ä–æ–Ω–Ω—É—é –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—é (–ø–æ–¥–∫–ª—é—á–µ–Ω–∏–µ –∫ —Ö—Ä–∞–Ω–∏–ª–∏—â—É, –∑–∞–≥—Ä—É–∑–∫–∞ –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏); –ø–æ—ç—Ç–æ–º—É `main()` –≤—ã–∑—ã–≤–∞–µ—Ç `WidgetsFlutterBinding.ensureInitialized()` (—Å–≤—è–∑–∫–∞ Flutter —Å –ø–ª–∞—Ç—Ñ–æ—Ä–º–æ–π) –∏ `await LocalMessagesService.init()`, –∏ —Ç–æ–ª—å–∫–æ –ø–æ—Ç–æ–º `runApp()`. **StatefulWidget –∏ State**: –≤–∏–¥–∂–µ—Ç –≤ Flutter –æ–ø–∏—Å—ã–≤–∞–µ—Ç UI, –Ω–æ —Å–∞–º –ø–æ —Å–µ–±–µ –Ω–µ–∏–∑–º–µ–Ω—è–µ–º (immutable). –ß—Ç–æ–±—ã —ç–∫—Ä–∞–Ω –º–æ–≥ –º–µ–Ω—è—Ç—å—Å—è (—Ç–µ–º–∞, –∑–∞–≥—Ä—É–∑–∫–∞ –¥–∞–Ω–Ω—ã—Ö), –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è –ø–∞—Ä–∞: StatefulWidget —Å–æ–∑–¥–∞—ë—Ç –æ–±—ä–µ–∫—Ç State, –≤ State —Ö—Ä–∞–Ω—è—Ç—Å—è –∏–∑–º–µ–Ω—è–µ–º—ã–µ –¥–∞–Ω–Ω—ã–µ –∏ –≤—ã–∑—ã–≤–∞–µ—Ç—Å—è `setState()`; –ø—Ä–∏ –≤—ã–∑–æ–≤–µ `setState()` Flutter –ø–µ—Ä–µ—Å—Ç—Ä–∞–∏–≤–∞–µ—Ç –≤–∏–¥–∂–µ—Ç (–≤—ã–∑—ã–≤–∞–µ—Ç `build()`). **FutureBuilder** ‚Äî –≤–∏–¥–∂–µ—Ç, –∫–æ—Ç–æ—Ä—ã–π –ø–æ–¥–ø–∏—Å—ã–≤–∞–µ—Ç—Å—è –Ω–∞ Future –∏ –ø–µ—Ä–µ—Å—Ç—Ä–∞–∏–≤–∞–µ—Ç –¥–æ—á–µ—Ä–Ω–∏–π UI –≤ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏ –æ—Ç —Å–æ—Å—Ç–æ—è–Ω–∏—è Future: –æ–∂–∏–¥–∞–Ω–∏–µ (–ø–æ–∫–∞–∑–∞—Ç—å –∏–Ω–¥–∏–∫–∞—Ç–æ—Ä), –¥–∞–Ω–Ω—ã–µ (–ø–æ–∫–∞–∑–∞—Ç—å —ç–∫—Ä–∞–Ω —Å –¥–∞–Ω–Ω—ã–º–∏), –æ—à–∏–±–∫–∞ (–ø–æ–∫–∞–∑–∞—Ç—å —Å–æ–æ–±—â–µ–Ω–∏–µ). –¢–∞–∫ –º—ã ¬´–≤—Å—Ç—Ä–∞–∏–≤–∞–µ–º¬ª –∞—Å–∏–Ω—Ö—Ä–æ–Ω–Ω–æ—Å—Ç—å –≤ –¥–µ—Ä–µ–≤–æ –≤–∏–¥–∂–µ—Ç–æ–≤: –ø–µ—Ä–≤—ã–π —ç–∫—Ä–∞–Ω –∑–∞–≤–∏—Å–∏—Ç –æ—Ç —Ä–µ–∑—É–ª—å—Ç–∞—Ç–∞ —á—Ç–µ–Ω–∏—è —Å–æ—Ö—Ä–∞–Ω—ë–Ω–Ω—ã—Ö –¥–∞–Ω–Ω—ã—Ö (–µ—Å—Ç—å —Ç–æ–∫–µ–Ω ‚Äî –≥–ª–∞–≤–Ω—ã–π —ç–∫—Ä–∞–Ω, –Ω–µ—Ç ‚Äî —ç–∫—Ä–∞–Ω –≤—Ö–æ–¥–∞).

**–°–∏–Ω—Ç–∞–∫—Å–∏—Å –∏ –∫–æ–Ω—Ü–µ–ø—Ü–∏–∏:**

- **`void main() { ... }`** ‚Äî —Ç–æ—á–∫–∞ –≤—Ö–æ–¥–∞: —Å —ç—Ç–æ–π —Ñ—É–Ω–∫—Ü–∏–∏ –Ω–∞—á–∏–Ω–∞–µ—Ç—Å—è –≤—ã–ø–æ–ª–Ω–µ–Ω–∏–µ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è. `void` –æ–∑–Ω–∞—á–∞–µ—Ç, —á—Ç–æ —Ñ—É–Ω–∫—Ü–∏—è –Ω–∏—á–µ–≥–æ –Ω–µ –≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç.
- **`FlutterError.onError = ...`** ‚Äî –≥–ª–æ–±–∞–ª—å–Ω—ã–π –æ–±—Ä–∞–±–æ—Ç—á–∏–∫ –æ—à–∏–±–æ–∫: –∫–æ–≥–¥–∞ –≤ –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å–µ –ø—Ä–æ–∏—Å—Ö–æ–¥–∏—Ç –æ—à–∏–±–∫–∞, –≤—ã–∑—ã–≤–∞–µ—Ç—Å—è —ç—Ç–∞ —Ñ—É–Ω–∫—Ü–∏—è, —á—Ç–æ–±—ã –µ—ë –∑–∞–ª–æ–≥–∏—Ä–æ–≤–∞—Ç—å –∏–ª–∏ –ø–æ–∫–∞–∑–∞—Ç—å.
- **`runZonedGuarded(() async { ... }, (error, stack) => { ... })`** ‚Äî –æ–±–æ—Ä–∞—á–∏–≤–∞–µ—Ç –∑–∞–ø—É—Å–∫ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è –≤ ¬´–∑–æ–Ω—É¬ª, –∫–æ—Ç–æ—Ä–∞—è –ø–µ—Ä–µ—Ö–≤–∞—Ç—ã–≤–∞–µ—Ç –æ—à–∏–±–∫–∏ –≤ –∞—Å–∏–Ω—Ö—Ä–æ–Ω–Ω–æ–º –∫–æ–¥–µ. –ï—Å–ª–∏ –≥–¥–µ-—Ç–æ –ø—Ä–æ–∏–∑–æ–π–¥—ë—Ç –Ω–µ–æ–±—Ä–∞–±–æ—Ç–∞–Ω–Ω–∞—è –æ—à–∏–±–∫–∞, –≤—ã–∑–æ–≤–µ—Ç—Å—è –≤—Ç–æ—Ä–æ–π –∞—Ä–≥—É–º–µ–Ω—Ç (–æ–±—Ä–∞–±–æ—Ç—á–∏–∫).
- **`WidgetsFlutterBinding.ensureInitialized()`** ‚Äî –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∏—Ä—É–µ—Ç —Å–≤—è–∑–∫—É Flutter —Å –ø–ª–∞—Ç—Ñ–æ—Ä–º–æ–π. –ù—É–∂–Ω–æ –≤—ã–∑–≤–∞—Ç—å –¥–æ –ª—é–±—ã—Ö –ø–ª–∞–≥–∏–Ω–æ–≤ –∏ –¥–æ —á—Ç–µ–Ω–∏—è/–∑–∞–ø–∏—Å–∏ –≤ —Ö—Ä–∞–Ω–∏–ª–∏—â–µ.
- **`await LocalMessagesService.init()`** ‚Äî –∂–¥—ë—Ç, –ø–æ–∫–∞ –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∏—Ä—É–µ—Ç—Å—è –ª–æ–∫–∞–ª—å–Ω–æ–µ —Ö—Ä–∞–Ω–∏–ª–∏—â–µ (–≥–¥–µ —Ö—Ä–∞–Ω—è—Ç—Å—è —Å–æ–æ–±—â–µ–Ω–∏—è –∏ —Ç.–ø.). `await` –æ–∑–Ω–∞—á–∞–µ—Ç ¬´–ø–æ–¥–æ–∂–¥–∞—Ç—å –∑–∞–≤–µ—Ä—à–µ–Ω–∏—è¬ª.
- **`runApp(MyApp())`** ‚Äî –∑–∞–ø—É—Å–∫–∞–µ—Ç –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ –∏ –ø–µ—Ä–µ–¥–∞—ë—Ç —É–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –≤–∏–¥–∂–µ—Ç—É `MyApp`.
- **`class MyApp extends StatefulWidget`** ‚Äî –∫–ª–∞—Å—Å –≤–∏–¥–∂–µ—Ç–∞ —Å —Å–æ—Å—Ç–æ—è–Ω–∏–µ–º. `StatefulWidget` ‚Äî –≤–∏–¥–∂–µ—Ç, –∫–æ—Ç–æ—Ä—ã–π –º–æ–∂–µ—Ç –º–µ–Ω—è—Ç—å—Å—è (–Ω–∞–ø—Ä–∏–º–µ—Ä, –ø–µ—Ä–µ–∫–ª—é—á–∞—Ç—å —Ç–µ–º—É); —É –Ω–µ–≥–æ –µ—Å—Ç—å —Å–≤—è–∑–∞–Ω–Ω—ã–π –æ–±—ä–µ–∫—Ç ¬´—Å–æ—Å—Ç–æ—è–Ω–∏–µ¬ª, –≥–¥–µ —Ö—Ä–∞–Ω—è—Ç—Å—è –¥–∞–Ω–Ω—ã–µ –∏ –≤—ã–∑—ã–≤–∞–µ—Ç—Å—è `setState()` –¥–ª—è –ø–µ—Ä–µ—Ä–∏—Å–æ–≤–∫–∏.
- **`@override`** ‚Äî –∞–Ω–Ω–æ—Ç–∞—Ü–∏—è. –£–∫–∞–∑—ã–≤–∞–µ—Ç, —á—Ç–æ –º–µ—Ç–æ–¥ –ø–µ—Ä–µ–æ–ø—Ä–µ–¥–µ–ª—è–µ—Ç –º–µ—Ç–æ–¥ –∏–∑ —Ä–æ–¥–∏—Ç–µ–ª—å—Å–∫–æ–≥–æ –∫–ª–∞—Å—Å–∞. –ù–µ –æ–±—è–∑–∞—Ç–µ–ª—å–Ω–∞, –Ω–æ –ø–æ–º–æ–≥–∞–µ—Ç IDE –Ω–∞–π—Ç–∏ –æ—à–∏–±–∫–∏.
- **`_MyAppState createState() => _MyAppState()`** ‚Äî —Å–æ–∑–¥–∞—ë—Ç –æ–±—ä–µ–∫—Ç —Å–æ—Å—Ç–æ—è–Ω–∏—è. `=>` ‚Äî –∫–æ—Ä–æ—Ç–∫–∞—è –∑–∞–ø–∏—Å—å —Ñ—É–Ω–∫—Ü–∏–∏: `() { return _MyAppState(); }`.
- **`class _MyAppState extends State<MyApp>`** ‚Äî –∫–ª–∞—Å—Å —Å–æ—Å—Ç–æ—è–Ω–∏—è. `_` –≤ –Ω–∞—á–∞–ª–µ –∏–º–µ–Ω–∏ –æ–∑–Ω–∞—á–∞–µ—Ç ¬´–ø—Ä–∏–≤–∞—Ç–Ω—ã–π¬ª (–∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è —Ç–æ–ª—å–∫–æ –≤ —ç—Ç–æ–º —Ñ–∞–π–ª–µ). `State<MyApp>` ‚Äî —Å–æ—Å—Ç–æ—è–Ω–∏–µ –¥–ª—è –≤–∏–¥–∂–µ—Ç–∞ `MyApp`.
- **`bool _isDarkMode = false`** ‚Äî –ø–æ–ª–µ —Å–æ—Å—Ç–æ—è–Ω–∏—è. –ö–æ–≥–¥–∞ —ç—Ç–æ –ø–æ–ª–µ –º–µ–Ω—è–µ—Ç—Å—è, –Ω—É–∂–Ω–æ –≤—ã–∑–≤–∞—Ç—å `setState()`, —á—Ç–æ–±—ã Flutter –ø–µ—Ä–µ—Ä–∏—Å–æ–≤–∞–ª –≤–∏–¥–∂–µ—Ç.
- **`@override void initState() { ... }`** ‚Äî –º–µ—Ç–æ–¥, –∫–æ—Ç–æ—Ä—ã–π –≤—ã–∑—ã–≤–∞–µ—Ç—Å—è –æ–¥–∏–Ω —Ä–∞–∑ –ø—Ä–∏ —Å–æ–∑–¥–∞–Ω–∏–∏ –≤–∏–¥–∂–µ—Ç–∞. –ó–¥–µ—Å—å –æ–±—ã—á–Ω–æ –∑–∞–ø—É—Å–∫–∞–µ—Ç—Å—è –∑–∞–≥—Ä—É–∑–∫–∞ –¥–∞–Ω–Ω—ã—Ö.
- **`super.initState()`** ‚Äî –≤—ã–∑–æ–≤ –º–µ—Ç–æ–¥–∞ —Ä–æ–¥–∏—Ç–µ–ª—å—Å–∫–æ–≥–æ –∫–ª–∞—Å—Å–∞. –û–±—è–∑–∞—Ç–µ–ª—å–Ω–æ –≤—ã–∑—ã–≤–∞—Ç—å –≤ `initState()`.
- **`Future<void> _loadThemePreference() async { ... }`** ‚Äî –∞—Å–∏–Ω—Ö—Ä–æ–Ω–Ω–∞—è —Ñ—É–Ω–∫—Ü–∏—è. `Future<void>` ‚Äî –≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç Future –±–µ–∑ –∑–Ω–∞—á–µ–Ω–∏—è (—Ç–æ–ª—å–∫–æ —É—Å–ø–µ—Ö/–æ—à–∏–±–∫–∞). `async` ‚Äî –≤–Ω—É—Ç—Ä–∏ –º–æ–∂–Ω–æ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å `await`.
- **`final isDark = await StorageService.getThemeMode()`** ‚Äî –∂–¥—ë—Ç —Ä–µ–∑—É–ª—å—Ç–∞—Ç. `final` ‚Äî –∫–æ–Ω—Å—Ç–∞–Ω—Ç–∞ (–Ω–µ–ª—å–∑—è –ø–µ—Ä–µ–ø—Ä–∏—Å–≤–æ–∏—Ç—å). `await` ‚Äî –ø—Ä–∏–æ—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ—Ç –≤—ã–ø–æ–ª–Ω–µ–Ω–∏–µ –¥–æ –∑–∞–≤–µ—Ä—à–µ–Ω–∏—è `getThemeMode()`.
- **`if (mounted) { ... }`** ‚Äî –ø—Ä–æ–≤–µ—Ä–∫–∞, —á—Ç–æ –≤–∏–¥–∂–µ—Ç –µ—â—ë –≤ –¥–µ—Ä–µ–≤–µ. –ï—Å–ª–∏ –≤–∏–¥–∂–µ—Ç —É–¥–∞–ª—ë–Ω –∏–∑ –¥–µ—Ä–µ–≤–∞, `mounted` –±—É–¥–µ—Ç `false`, –∏ –≤—ã–∑—ã–≤–∞—Ç—å `setState()` –Ω–µ–ª—å–∑—è (–æ—à–∏–±–∫–∞).
- **`setState(() { _isDarkMode = isDark; })`** ‚Äî –æ–±–Ω–æ–≤–ª—è–µ—Ç —Å–æ—Å—Ç–æ—è–Ω–∏–µ. `setState` ‚Äî –º–µ—Ç–æ–¥ –∏–∑ `State`. –§—É–Ω–∫—Ü–∏—è –≤–Ω—É—Ç—Ä–∏ `setState` –º–µ–Ω—è–µ—Ç –ø–æ–ª—è, –ø–æ—Å–ª–µ —ç—Ç–æ–≥–æ Flutter –≤—ã–∑—ã–≤–∞–µ—Ç `build()` –∏ –ø–µ—Ä–µ—Ä–∏—Å–æ–≤—ã–≤–∞–µ—Ç –≤–∏–¥–∂–µ—Ç.
- **`Widget build(BuildContext context)`** ‚Äî –º–µ—Ç–æ–¥, –∫–æ—Ç–æ—Ä—ã–π —Å—Ç—Ä–æ–∏—Ç –¥–µ—Ä–µ–≤–æ –≤–∏–¥–∂–µ—Ç–æ–≤. –í—ã–∑—ã–≤–∞–µ—Ç—Å—è Flutter'–æ–º –ø—Ä–∏ —Å–æ–∑–¥–∞–Ω–∏–∏ –≤–∏–¥–∂–µ—Ç–∞ –∏ –ø–æ—Å–ª–µ `setState()`. `context` ‚Äî –∫–æ–Ω—Ç–µ–∫—Å—Ç –≤–∏–¥–∂–µ—Ç–∞ (–Ω—É–∂–µ–Ω –¥–ª—è –Ω–∞–≤–∏–≥–∞—Ü–∏–∏, —Ç–µ–º –∏ —Ç.–¥.).
- **`return MaterialApp(...)`** ‚Äî –≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç –∫–æ—Ä–Ω–µ–≤–æ–π –≤–∏–¥–∂–µ—Ç. `MaterialApp` ‚Äî –≤–∏–¥–∂–µ—Ç, –∫–æ—Ç–æ—Ä—ã–π –Ω–∞—Å—Ç—Ä–∞–∏–≤–∞–µ—Ç —Ç–µ–º—É, –Ω–∞–≤–∏–≥–∞—Ü–∏—é, –ª–æ–∫–∞–ª–∏–∑–∞—Ü–∏—é –∏ —Ç.–¥.
- **`theme: ThemeData(...)`** ‚Äî —Å–≤–µ—Ç–ª–∞—è —Ç–µ–º–∞. `ThemeData` ‚Äî –æ–±—ä–µ–∫—Ç —Å –Ω–∞—Å—Ç—Ä–æ–π–∫–∞–º–∏ —Ç–µ–º—ã (—Ü–≤–µ—Ç–∞, —à—Ä–∏—Ñ—Ç—ã, —Å—Ç–∏–ª–∏ –≤–∏–¥–∂–µ—Ç–æ–≤).
- **`darkTheme: ThemeData(...)`** ‚Äî —Ç—ë–º–Ω–∞—è —Ç–µ–º–∞.
- **`themeMode: _isDarkMode ? ThemeMode.dark : ThemeMode.light`** ‚Äî –∫–∞–∫–∞—è —Ç–µ–º–∞ –∞–∫—Ç–∏–≤–Ω–∞. –¢–µ—Ä–Ω–∞—Ä–Ω—ã–π –æ–ø–µ—Ä–∞—Ç–æ—Ä: –µ—Å–ª–∏ `_isDarkMode` true, —Ç–æ `ThemeMode.dark`, –∏–Ω–∞—á–µ `ThemeMode.light`.
- **`home: FutureBuilder<Map<String, String>?>(...)`** ‚Äî –ø–µ—Ä–≤—ã–π —ç–∫—Ä–∞–Ω –æ–ø—Ä–µ–¥–µ–ª—è–µ—Ç—Å—è –ø–æ Future. `FutureBuilder` ‚Äî –≤–∏–¥–∂–µ—Ç, –∫–æ—Ç–æ—Ä—ã–π —Å—Ç—Ä–æ–∏—Ç UI –≤ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏ –æ—Ç —Å–æ—Å—Ç–æ—è–Ω–∏—è Future (loading, data, error).

**–ö–æ–¥ –∏–∑ –ø—Ä–æ–µ–∫—Ç–∞.** –§–∞–π–ª: `lib/main.dart`

```dart
void main() {
  FlutterError.onError = (FlutterErrorDetails details) {
    FlutterError.presentError(details);
    if (kDebugMode) {
      print('Flutter Error: ${details.exception}');
    }
  };

  runZonedGuarded(() async {
    WidgetsFlutterBinding.ensureInitialized();
    await LocalMessagesService.init();
    runApp(MyApp());
  }, (error, stack) {
    if (kDebugMode) {
      print('Uncaught error: $error');
    }
  });
}

class MyApp extends StatefulWidget {
  @override
  _MyAppState createState() => _MyAppState();
}

class _MyAppState extends State<MyApp> {
  bool _isDarkMode = false;

  @override
  void initState() {
    super.initState();
    _loadThemePreference();
  }

  Future<void> _loadThemePreference() async {
    final isDark = await StorageService.getThemeMode();
    if (mounted) {
      setState(() {
        _isDarkMode = isDark;
      });
    }
  }

  @override
  Widget build(BuildContext context) {
    return MaterialApp(
      theme: ThemeData(...),
      darkTheme: ThemeData(...),
      themeMode: _isDarkMode ? ThemeMode.dark : ThemeMode.light,
      home: FutureBuilder<Map<String, String>?>(
        future: StorageService.getUserData(),
        builder: (context, snapshot) {
          if (snapshot.connectionState == ConnectionState.waiting) {
            return Scaffold(
              body: Center(
                child: CircularProgressIndicator(...),
              ),
            );
          }

          if (snapshot.hasData && snapshot.data != null && snapshot.data!['token'] != null) {
            final userData = snapshot.data!;
            return MainTabsScreen(
              userId: userData['id']!,
              userEmail: userData['email'] ?? userData['username'] ?? '',
            );
          }

          return LoginScreen();
        },
      ),
    );
  }
}
```

**FutureBuilder ‚Äî –∫–∞–∫ —Ä–∞–±–æ—Ç–∞–µ—Ç:**

- **`future: StorageService.getUserData()`** ‚Äî Future, –∫–æ—Ç–æ—Ä—ã–π –º—ã –æ—Ç—Å–ª–µ–∂–∏–≤–∞–µ–º. `getUserData()` –≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç `Future<Map<String, String>?>`.
- **`builder: (context, snapshot) => { ... }`** ‚Äî —Ñ—É–Ω–∫—Ü–∏—è, –∫–æ—Ç–æ—Ä–∞—è —Å—Ç—Ä–æ–∏—Ç –≤–∏–¥–∂–µ—Ç. –í—ã–∑—ã–≤–∞–µ—Ç—Å—è –Ω–µ—Å–∫–æ–ª—å–∫–æ —Ä–∞–∑: –∫–æ–≥–¥–∞ Future –µ—â—ë –Ω–µ –∑–∞–≤–µ—Ä—à—ë–Ω (loading), –∫–æ–≥–¥–∞ –∑–∞–≤–µ—Ä—à—ë–Ω —Å –¥–∞–Ω–Ω—ã–º–∏, –∫–æ–≥–¥–∞ –∑–∞–≤–µ—Ä—à—ë–Ω —Å –æ—à–∏–±–∫–æ–π.
- **`snapshot.connectionState`** ‚Äî —Å–æ—Å—Ç–æ—è–Ω–∏–µ Future. `ConnectionState.waiting` ‚Äî –µ—â—ë –≤—ã–ø–æ–ª–Ω—è–µ—Ç—Å—è, `ConnectionState.done` ‚Äî –∑–∞–≤–µ—Ä—à—ë–Ω.
- **`snapshot.hasData`** ‚Äî –µ—Å—Ç—å –ª–∏ –¥–∞–Ω–Ω—ã–µ. `true` –µ—Å–ª–∏ Future –∑–∞–≤–µ—Ä—à–∏–ª—Å—è —É—Å–ø–µ—à–Ω–æ –∏ –≤–µ—Ä–Ω—É–ª –Ω–µ-null –∑–Ω–∞—á–µ–Ω–∏–µ.
- **`snapshot.data`** ‚Äî –¥–∞–Ω–Ω—ã–µ –∏–∑ Future. –¢–∏–ø ‚Äî `Map<String, String>?` (–º–æ–∂–µ—Ç –±—ã—Ç—å null).
- **`snapshot.data!['token']`** ‚Äî –æ–±—Ä–∞—â–µ–Ω–∏–µ –∫ Map. `!` ‚Äî –æ–ø–µ—Ä–∞—Ç–æ—Ä ¬´–Ω–µ-null assertion¬ª (–≥–æ–≤–æ—Ä–∏—Ç Dart: ¬´—è —É–≤–µ—Ä–µ–Ω, —á—Ç–æ —ç—Ç–æ –Ω–µ null¬ª). `['token']` ‚Äî –¥–æ—Å—Ç–∞—ë—Ç –∑–Ω–∞—á–µ–Ω–∏–µ –ø–æ –∫–ª—é—á—É `'token'`.
- **`userData['email'] ?? userData['username'] ?? ''`** ‚Äî –æ–ø–µ—Ä–∞—Ç–æ—Ä `??` (null-coalescing). –ï—Å–ª–∏ `userData['email']` null, –±–µ—Ä—ë—Ç—Å—è `userData['username']`, –µ—Å–ª–∏ –∏ –æ–Ω null ‚Äî –±–µ—Ä—ë—Ç—Å—è `''`.

**–ß—Ç–æ –Ω—É–∂–Ω–æ –∑–Ω–∞—Ç—å:** —á—Ç–æ —Ç–∞–∫–æ–µ –∫–ª–∞—Å—Å—ã –∏ –Ω–∞—Å–ª–µ–¥–æ–≤–∞–Ω–∏–µ (`extends`), —á—Ç–æ —Ç–∞–∫–æ–µ async/await –∏ Future, —á—Ç–æ —Ç–∞–∫–æ–µ –≤–∏–¥–∂–µ—Ç—ã –∏ –¥–µ—Ä–µ–≤–æ –≤–∏–¥–∂–µ—Ç–æ–≤, —á—Ç–æ —Ç–∞–∫–æ–µ `setState` –∏ —Å–æ—Å—Ç–æ—è–Ω–∏–µ, —á—Ç–æ —Ç–∞–∫–æ–µ —Ç–µ—Ä–Ω–∞—Ä–Ω—ã–π –æ–ø–µ—Ä–∞—Ç–æ—Ä (`? :`), —á—Ç–æ —Ç–∞–∫–æ–µ –æ–ø–µ—Ä–∞—Ç–æ—Ä `??`.

---

### 3.2. –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è: –∫–ª–∞—Å—Å `ApiConfig` ‚Äî –±–∞–∑–æ–≤—ã–π URL API

**–ü—Ä–æ—Å—Ç—ã–º–∏ —Å–ª–æ–≤–∞–º–∏:** —á—Ç–æ–±—ã –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ –∑–Ω–∞–ª–æ, –∫—É–¥–∞ —Å–ª–∞—Ç—å –∑–∞–ø—Ä–æ—Å—ã (–ª–æ–≥–∏–Ω, —Å–æ–æ–±—â–µ–Ω–∏—è), –Ω—É–∂–µ–Ω –∞–¥—Ä–µ—Å —Å–µ—Ä–≤–µ—Ä–∞. –≠—Ç–æ—Ç –∞–¥—Ä–µ—Å —Ö—Ä–∞–Ω–∏—Ç—Å—è –≤ –æ–¥–Ω–æ–º –º–µ—Å—Ç–µ ‚Äî –≤ `ApiConfig`. –¢–∞–∫ –Ω–µ –ø—Ä–∏–¥—ë—Ç—Å—è –∏—Å–∫–∞—Ç—å –µ–≥–æ –ø–æ –≤—Å–µ–º—É –∫–æ–¥—É; –ø—Ä–∏ —Å–±–æ—Ä–∫–µ –ø–æ–¥ –¥—Ä—É–≥–æ–π —Å–µ—Ä–≤–µ—Ä –º–æ–∂–Ω–æ –∑–∞–¥–∞—Ç—å –¥—Ä—É–≥–æ–π –∞–¥—Ä–µ—Å.

**–ß—Ç–æ –¥–µ–ª–∞–µ—Ç:** —Ö—Ä–∞–Ω–∏—Ç –±–∞–∑–æ–≤—ã–π URL —Å–µ—Ä–≤–µ—Ä–∞ –≤ –æ–¥–Ω–æ–º –º–µ—Å—Ç–µ. –ü—Ä–∏ —Å–±–æ—Ä–∫–µ –º–æ–∂–Ω–æ –ø–µ—Ä–µ–æ–ø—Ä–µ–¥–µ–ª–∏—Ç—å —á–µ—Ä–µ–∑ `--dart-define=API_BASE_URL=...`.

**–ö–∞–∫ —Ä–∞–±–æ—Ç–∞–µ—Ç:** —ç—Ç–æ —Å—Ç–∞—Ç–∏—á–µ—Å–∫–∏–π –∫–ª–∞—Å—Å (–≤—Å–µ –º–µ—Ç–æ–¥—ã/–ø–æ–ª—è —Å—Ç–∞—Ç–∏—á–µ—Å–∫–∏–µ, —ç–∫–∑–µ–º–ø–ª—è—Ä —Å–æ–∑–¥–∞–≤–∞—Ç—å –Ω–µ –Ω—É–∂–Ω–æ). `baseUrl` ‚Äî –≥–µ—Ç—Ç–µ—Ä: –ø—Ä–∏ –æ–±—Ä–∞—â–µ–Ω–∏–∏ –∫ `ApiConfig.baseUrl` –≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç—Å—è –∞–¥—Ä–µ—Å –∏–∑ –ø–µ—Ä–µ–º–µ–Ω–Ω–æ–π –æ–∫—Ä—É–∂–µ–Ω–∏—è –∏–ª–∏ –∑–Ω–∞—á–µ–Ω–∏–µ –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é.

**–¢–µ–æ—Ä–∏—è.** **–ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è** –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è (URL API, –∫–ª—é—á–∏, —Ñ–ª–∞–≥–∏) –Ω–µ –¥–æ–ª–∂–Ω–∞ –±—ã—Ç—å —Ä–∞–∑–º–∞–∑–∞–Ω–∞ –ø–æ –∫–æ–¥—É: –ø—Ä–∏ —Å–º–µ–Ω–µ —Å–µ—Ä–≤–µ—Ä–∞ –∏–ª–∏ –æ–∫—Ä—É–∂–µ–Ω–∏—è (dev/stage/prod) –ø—Ä–∏–¥—ë—Ç—Å—è –∏—Å–∫–∞—Ç—å –≤—Å–µ –≤—Ö–æ–∂–¥–µ–Ω–∏—è. –í—ã–Ω–æ—Å–∏–º –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ –≤ –æ–¥–Ω–æ –º–µ—Å—Ç–æ ‚Äî –∫–ª–∞—Å—Å –∏–ª–∏ —Ñ–∞–π–ª –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏. **–ë–∞–∑–æ–≤—ã–π URL API** ‚Äî –æ–±—â–∏–π –ø—Ä–µ—Ñ–∏–∫—Å –¥–ª—è –≤—Å–µ—Ö –∑–∞–ø—Ä–æ—Å–æ–≤: –ª–æ–≥–∏–Ω ‚Äî `$baseUrl/auth/login`, —á–∞—Ç—ã ‚Äî `$baseUrl/chats` –∏ —Ç.–¥. –í —Ä–∞–∑–Ω—ã—Ö –æ–∫—Ä—É–∂–µ–Ω–∏—è—Ö baseUrl —Ä–∞–∑–Ω—ã–π (–ª–æ–∫–∞–ª—å–Ω—ã–π —Å–µ—Ä–≤–µ—Ä –ø—Ä–∏ —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–µ, –ø—Ä–æ–¥–æ–≤—ã–π ‚Äî –≤ –ø—Ä–æ–¥–∞–∫—à–µ–Ω–µ). –í–æ Flutter –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –≤—Ä–µ–º–µ–Ω–∏ –∫–æ–º–ø–∏–ª—è—Ü–∏–∏ –∑–∞–¥–∞—é—Ç—Å—è —á–µ—Ä–µ–∑ `--dart-define=KEY=value`; `String.fromEnvironment('KEY', defaultValue: ...)` —á–∏—Ç–∞–µ—Ç –∏—Ö. –¢–∞–∫ –ø—Ä–∏ —Å–±–æ—Ä–∫–µ –ø–æ–¥ –ø—Ä–æ–¥ –º–æ–∂–Ω–æ –ø–µ—Ä–µ–¥–∞—Ç—å –¥—Ä—É–≥–æ–π URL –±–µ–∑ –∏–∑–º–µ–Ω–µ–Ω–∏—è –∫–æ–¥–∞. **–°—Ç–∞—Ç–∏—á–µ—Å–∫–∏–µ —á–ª–µ–Ω—ã –∫–ª–∞—Å—Å–∞**: –º–µ—Ç–æ–¥—ã –∏ –ø–æ–ª—è —Å –º–æ–¥–∏—Ñ–∏–∫–∞—Ç–æ—Ä–æ–º `static` –ø—Ä–∏–Ω–∞–¥–ª–µ–∂–∞—Ç —Å–∞–º–æ–º—É –∫–ª–∞—Å—Å—É, –∞ –Ω–µ —ç–∫–∑–µ–º–ø–ª—è—Ä—É. –í—ã–∑–æ–≤ –±–µ–∑ —Å–æ–∑–¥–∞–Ω–∏—è –æ–±—ä–µ–∫—Ç–∞: `ApiConfig.baseUrl`. –£–¥–æ–±–Ω–æ –¥–ª—è —É—Ç–∏–ª–∏—Ç –∏ –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏, –∫–æ–≥–¥–∞ –æ–¥–∏–Ω –æ–±—â–∏–π –æ–±—ä–µ–∫—Ç –Ω–∞ –≤—Å—ë –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ.

**–°–∏–Ω—Ç–∞–∫—Å–∏—Å –∏ –∫–æ–Ω—Ü–µ–ø—Ü–∏–∏:**

- **`class ApiConfig { ... }`** ‚Äî –∫–ª–∞—Å—Å. –í Dart –∫–ª–∞—Å—Å—ã –º–æ–≥—É—Ç –±—ã—Ç—å –±–µ–∑ –∫–æ–Ω—Å—Ç—Ä—É–∫—Ç–æ—Ä–∞, –µ—Å–ª–∏ –≤—Å–µ –ø–æ–ª—è/–º–µ—Ç–æ–¥—ã —Å—Ç–∞—Ç–∏—á–µ—Å–∫–∏–µ.
- **`static const String _defaultBaseUrl = '...'`** ‚Äî —Å—Ç–∞—Ç–∏—á–µ—Å–∫–∞—è –∫–æ–Ω—Å—Ç–∞–Ω—Ç–∞. `static` ‚Äî –ø—Ä–∏–Ω–∞–¥–ª–µ–∂–∏—Ç –∫–ª–∞—Å—Å—É, –∞ –Ω–µ —ç–∫–∑–µ–º–ø–ª—è—Ä—É. `const` ‚Äî –∫–æ–Ω—Å—Ç–∞–Ω—Ç–∞ –≤—Ä–µ–º–µ–Ω–∏ –∫–æ–º–ø–∏–ª—è—Ü–∏–∏. `_` –≤ –Ω–∞—á–∞–ª–µ ‚Äî –ø—Ä–∏–≤–∞—Ç–Ω–∞—è (–∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è —Ç–æ–ª—å–∫–æ –≤ —ç—Ç–æ–º —Ñ–∞–π–ª–µ).
- **`static String get baseUrl { ... }`** ‚Äî —Å—Ç–∞—Ç–∏—á–µ—Å–∫–∏–π –≥–µ—Ç—Ç–µ—Ä. –ì–µ—Ç—Ç–µ—Ä ‚Äî —ç—Ç–æ –º–µ—Ç–æ–¥, –∫–æ—Ç–æ—Ä—ã–π –≤—ã–≥–ª—è–¥–∏—Ç –∫–∞–∫ –ø–æ–ª–µ. –í—ã–∑—ã–≤–∞–µ—Ç—Å—è –∫–∞–∫ `ApiConfig.baseUrl` (–±–µ–∑ —Å–∫–æ–±–æ–∫).
- **`const String.fromEnvironment('API_BASE_URL', defaultValue: _defaultBaseUrl)`** ‚Äî —á–∏—Ç–∞–µ—Ç –ø–µ—Ä–µ–º–µ–Ω–Ω—É—é –æ–∫—Ä—É–∂–µ–Ω–∏—è –≤—Ä–µ–º–µ–Ω–∏ –∫–æ–º–ø–∏–ª—è—Ü–∏–∏. `fromEnvironment` ‚Äî –≤—Å—Ç—Ä–æ–µ–Ω–Ω—ã–π –∫–æ–Ω—Å—Ç—Ä—É–∫—Ç–æ—Ä String. –ü–µ—Ä–≤—ã–π –∞—Ä–≥—É–º–µ–Ω—Ç ‚Äî –∏–º—è –ø–µ—Ä–µ–º–µ–Ω–Ω–æ–π, `defaultValue` ‚Äî –∑–Ω–∞—á–µ–Ω–∏–µ –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é. –ü–µ—Ä–µ–º–µ–Ω–Ω–∞—è –∑–∞–¥–∞—ë—Ç—Å—è –ø—Ä–∏ —Å–±–æ—Ä–∫–µ: `flutter build --dart-define=API_BASE_URL=https://...`.
- **`.trim()`** ‚Äî —É–±–∏—Ä–∞–µ—Ç –ø—Ä–æ–±–µ–ª—ã –ø–æ –∫—Ä–∞—è–º —Å—Ç—Ä–æ–∫–∏.
- **`v.isEmpty`** ‚Äî –ø—Ä–æ–≤–µ—Ä–∫–∞, –ø—É—Å—Ç–∞—è –ª–∏ —Å—Ç—Ä–æ–∫–∞. `isEmpty` ‚Äî —Å–≤–æ–π—Å—Ç–≤–æ String.
- **`v.endsWith('/') ? v.substring(0, v.length - 1) : v`** ‚Äî —Ç–µ—Ä–Ω–∞—Ä–Ω—ã–π –æ–ø–µ—Ä–∞—Ç–æ—Ä. –ï—Å–ª–∏ —Å—Ç—Ä–æ–∫–∞ –∑–∞–∫–∞–Ω—á–∏–≤–∞–µ—Ç—Å—è –Ω–∞ `/`, —É–±–∏—Ä–∞–µ–º –ø–æ—Å–ª–µ–¥–Ω–∏–π —Å–∏–º–≤–æ–ª (`substring(0, v.length - 1)`), –∏–Ω–∞—á–µ –≤–æ–∑–≤—Ä–∞—â–∞–µ–º –∫–∞–∫ –µ—Å—Ç—å.

**–ö–æ–¥ –∏–∑ –ø—Ä–æ–µ–∫—Ç–∞.** –§–∞–π–ª: `lib/config/api_config.dart`

```dart
class ApiConfig {
  static const String _defaultBaseUrl = 'https://my-server-chat.onrender.com';

  static String get baseUrl {
    final v = const String.fromEnvironment(
      'API_BASE_URL',
      defaultValue: _defaultBaseUrl,
    ).trim();

    if (v.isEmpty) return _defaultBaseUrl;
    return v.endsWith('/') ? v.substring(0, v.length - 1) : v;
  }
}
```

**–ß—Ç–æ –Ω—É–∂–Ω–æ –∑–Ω–∞—Ç—å:** —á—Ç–æ —Ç–∞–∫–æ–µ —Å—Ç–∞—Ç–∏—á–µ—Å–∫–∏–µ –º–µ—Ç–æ–¥—ã/–ø–æ–ª—è, —á—Ç–æ —Ç–∞–∫–æ–µ –≥–µ—Ç—Ç–µ—Ä—ã, —á—Ç–æ —Ç–∞–∫–æ–µ –∫–æ–Ω—Å—Ç–∞–Ω—Ç—ã (`const`), —á—Ç–æ —Ç–∞–∫–æ–µ –º–µ—Ç–æ–¥—ã —Å—Ç—Ä–æ–∫ (`trim`, `isEmpty`, `endsWith`, `substring`).

---

### 3.3. –°–µ—Ä–≤–∏—Å: –∫–ª–∞—Å—Å `AuthService` –∏ –º–µ—Ç–æ–¥ `loginUser`

**–ü—Ä–æ—Å—Ç—ã–º–∏ —Å–ª–æ–≤–∞–º–∏:** —ç—Ç–æ ¬´–ø–æ—Å—Ä–µ–¥–Ω–∏–∫¬ª –º–µ–∂–¥—É —ç–∫—Ä–∞–Ω–æ–º –≤—Ö–æ–¥–∞ –∏ —Å–µ—Ä–≤–µ—Ä–æ–º. –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –Ω–∞–∂–∞–ª ¬´–í–æ–π—Ç–∏¬ª ‚Äî —ç–∫—Ä–∞–Ω –≤—ã–∑—ã–≤–∞–µ—Ç `loginUser(–ª–æ–≥–∏–Ω, –ø–∞—Ä–æ–ª—å)`. –°–µ—Ä–≤–∏—Å –æ—Ç–ø—Ä–∞–≤–ª—è–µ—Ç –Ω–∞ —Å–µ—Ä–≤–µ—Ä –∑–∞–ø—Ä–æ—Å —Å –ª–æ–≥–∏–Ω–æ–º –∏ –ø–∞—Ä–æ–ª–µ–º, –ø–æ–ª—É—á–∞–µ—Ç –æ—Ç–≤–µ—Ç (—É—Å–ø–µ—Ö –∏–ª–∏ –æ—à–∏–±–∫–∞), –ø—Ä–∏ —É—Å–ø–µ—Ö–µ —Å–æ—Ö—Ä–∞–Ω—è–µ—Ç —Ç–æ–∫–µ–Ω –∏ –¥–∞–Ω–Ω—ã–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è –≤ –ª–æ–∫–∞–ª—å–Ω–æ–µ —Ö—Ä–∞–Ω–∏–ª–∏—â–µ –∏ –≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç –∏—Ö —ç–∫—Ä–∞–Ω—É.

**–ß—Ç–æ –¥–µ–ª–∞–µ—Ç:** –æ—Ç–ø—Ä–∞–≤–ª—è–µ—Ç HTTP POST-–∑–∞–ø—Ä–æ—Å –Ω–∞ `/auth/login` —Å –ª–æ–≥–∏–Ω–æ–º –∏ –ø–∞—Ä–æ–ª–µ–º, –ø–∞—Ä—Å–∏—Ç JSON-–æ—Ç–≤–µ—Ç, –ø—Ä–∏ —É—Å–ø–µ—Ö–µ —Å–æ—Ö—Ä–∞–Ω—è–µ—Ç —Ç–æ–∫–µ–Ω –∏ –¥–∞–Ω–Ω—ã–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è —á–µ—Ä–µ–∑ `StorageService`, –≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç –¥–∞–Ω–Ω—ã–µ.

**–ö–∞–∫ —Ä–∞–±–æ—Ç–∞–µ—Ç:** —ç—Ç–æ –∫–ª–∞—Å—Å –±–µ–∑ –≤–∏–¥–∂–µ—Ç–æ–≤, —Ç–æ–ª—å–∫–æ –ª–æ–≥–∏–∫–∞. –ú–µ—Ç–æ–¥ `loginUser` –∞—Å–∏–Ω—Ö—Ä–æ–Ω–Ω—ã–π: –¥–µ–ª–∞–µ—Ç HTTP-–∑–∞–ø—Ä–æ—Å, –∂–¥—ë—Ç –æ—Ç–≤–µ—Ç, —Ä–∞–∑–±–∏—Ä–∞–µ—Ç JSON, –æ–±—Ä–∞–±–∞—Ç—ã–≤–∞–µ—Ç –æ—à–∏–±–∫–∏, —Å–æ—Ö—Ä–∞–Ω—è–µ—Ç –¥–∞–Ω–Ω—ã–µ.

**–¢–µ–æ—Ä–∏—è.** **–†–∞–∑–¥–µ–ª–µ–Ω–∏–µ –æ—Ç–≤–µ—Ç—Å—Ç–≤–µ–Ω–Ω–æ—Å—Ç–∏**: —ç–∫—Ä–∞–Ω (LoginScreen) –Ω–µ –¥–æ–ª–∂–µ–Ω –∑–Ω–∞—Ç—å, –∫–∞–∫ –∏–º–µ–Ω–Ω–æ –æ—Ç–ø—Ä–∞–≤–ª—è–µ—Ç—Å—è –∑–∞–ø—Ä–æ—Å –∏ –≤ –∫–∞–∫–æ–º —Ñ–æ—Ä–º–∞—Ç–µ; –æ–Ω –≤—ã–∑—ã–≤–∞–µ—Ç ¬´–≤–æ–π—Ç–∏ —Å —Ç–∞–∫–∏–º–∏ –ª–æ–≥–∏–Ω–æ–º –∏ –ø–∞—Ä–æ–ª–µ–º¬ª –∏ –ø–æ–ª—É—á–∞–µ—Ç —Ä–µ–∑—É–ª—å—Ç–∞—Ç –∏–ª–∏ –æ—à–∏–±–∫—É. –í—Å—è —Ä–∞–±–æ—Ç–∞ —Å —Å–µ—Ç—å—é –∏ —Ä–∞–∑–±–æ—Ä –æ—Ç–≤–µ—Ç–∞ —Å–æ—Å—Ä–µ–¥–æ—Ç–æ—á–µ–Ω—ã –≤ **—Å–µ—Ä–≤–∏—Å–µ** (AuthService). –¢–∞–∫ –ø—Ä–æ—â–µ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞—Ç—å (—Å–µ—Ä–≤–∏—Å –º–æ–∂–Ω–æ –≤—ã–∑—ã–≤–∞—Ç—å –±–µ–∑ UI), –º–µ–Ω—è—Ç—å —Ä–µ–∞–ª–∏–∑–∞—Ü–∏—é (–Ω–∞–ø—Ä–∏–º–µ—Ä, –¥—Ä—É–≥–æ–π HTTP-–∫–ª–∏–µ–Ω—Ç) –∏ –ø–µ—Ä–µ–∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å –ª–æ–≥–∏–∫—É (–ª–æ–≥–∏–Ω –º–æ–∂–µ—Ç –ø–æ–Ω–∞–¥–æ–±–∏—Ç—å—Å—è –∏ –Ω–∞ –¥—Ä—É–≥–æ–º —ç–∫—Ä–∞–Ω–µ). **HTTP-–∫–ª–∏–µ–Ω—Ç**: –ø–∞–∫–µ—Ç `http` –≤–æ Flutter –ø—Ä–µ–¥–æ—Å—Ç–∞–≤–ª—è–µ—Ç –º–µ—Ç–æ–¥—ã `get`, `post` –∏ —Ç.–¥. –ó–∞–ø—Ä–æ—Å –∑–∞–¥–∞—ë—Ç—Å—è URL, –∑–∞–≥–æ–ª–æ–≤–∫–∞–º–∏ –∏ —Ç–µ–ª–æ–º; –æ—Ç–≤–µ—Ç –ø—Ä–∏—Ö–æ–¥–∏—Ç —Å –ø–æ–ª—è–º–∏ `statusCode` –∏ `body` (—Å—Ç—Ä–æ–∫–∞). –¢–µ–ª–æ –æ–±—ã—á–Ω–æ –≤ —Ñ–æ—Ä–º–∞—Ç–µ **JSON**; –∫–ª–∏–µ–Ω—Ç –ø–∞—Ä—Å–∏—Ç –µ–≥–æ —á–µ—Ä–µ–∑ `jsonDecode()` –∏ –¥–∞–ª—å—à–µ —Ä–∞–±–æ—Ç–∞–µ—Ç —Å Map/List. **–û–±—Ä–∞–±–æ—Ç–∫–∞ –æ—à–∏–±–æ–∫**: —Å–µ—Ç—å –Ω–µ–Ω–∞–¥—ë–∂–Ω–∞ (—Ç–∞–π–º–∞—É—Ç, –Ω–µ—Ç –∏–Ω—Ç–µ—Ä–Ω–µ—Ç–∞, —Å–µ—Ä–≤–µ—Ä –≤–µ—Ä–Ω—É–ª 500). –ö–æ–¥ –æ–±–æ—Ä–∞—á–∏–≤–∞—é—Ç –≤ `try/catch`; –ø—Ä–∏ –æ—à–∏–±–∫–µ –ª–∏–±–æ –ø–æ–∫–∞–∑—ã–≤–∞—é—Ç –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—é —Å–æ–æ–±—â–µ–Ω–∏–µ, –ª–∏–±–æ –ø—Ä–æ–±—Ä–∞—Å—ã–≤–∞—é—Ç –∏—Å–∫–ª—é—á–µ–Ω–∏–µ –≤—ã—à–µ. –ü–æ –∫–æ–¥—É –æ—Ç–≤–µ—Ç–∞ (200, 401, 500) –∫–ª–∏–µ–Ω—Ç –ø–æ–Ω–∏–º–∞–µ—Ç, —É—Å–ø–µ—à–µ–Ω –ª–∏ –∑–∞–ø—Ä–æ—Å –∏ —á—Ç–æ –¥–µ–ª–∞—Ç—å –¥–∞–ª—å—à–µ (—Å–æ—Ö—Ä–∞–Ω–∏—Ç—å —Ç–æ–∫–µ–Ω, –ø–æ–∫–∞–∑–∞—Ç—å ¬´–Ω–µ–≤–µ—Ä–Ω—ã–π –ø–∞—Ä–æ–ª—å¬ª, –ø–æ–∫–∞–∑–∞—Ç—å ¬´–æ—à–∏–±–∫–∞ —Å–µ—Ä–≤–µ—Ä–∞¬ª).

**–°–∏–Ω—Ç–∞–∫—Å–∏—Å –∏ –∫–æ–Ω—Ü–µ–ø—Ü–∏–∏:**

- **`class AuthService { ... }`** ‚Äî –∫–ª–∞—Å—Å. –ú–æ–∂–Ω–æ —Å–æ–∑–¥–∞—Ç—å —ç–∫–∑–µ–º–ø–ª—è—Ä: `final _authService = AuthService();`.
- **`final String baseUrl = ApiConfig.baseUrl`** ‚Äî –ø–æ–ª–µ –∫–ª–∞—Å—Å–∞. `final` ‚Äî –Ω–µ–ª—å–∑—è –ø–µ—Ä–µ–ø—Ä–∏—Å–≤–æ–∏—Ç—å –ø–æ—Å–ª–µ –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏–∏. –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∏—Ä—É–µ—Ç—Å—è –∑–Ω–∞—á–µ–Ω–∏–µ–º –∏–∑ `ApiConfig.baseUrl`.
- **`Future<Map<String, dynamic>?> loginUser(String username, String password) async { ... }`** ‚Äî –∞—Å–∏–Ω—Ö—Ä–æ–Ω–Ω—ã–π –º–µ—Ç–æ–¥. `Future<Map<String, dynamic>?>` ‚Äî –≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç Future —Å Map –∏–ª–∏ null. `async` ‚Äî –≤–Ω—É—Ç—Ä–∏ –º–æ–∂–Ω–æ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å `await`.
- **`try { ... } catch (e) { ... }`** ‚Äî –æ–±—Ä–∞–±–æ—Ç–∫–∞ –æ—à–∏–±–æ–∫. –ö–æ–¥ –≤ `try` –≤—ã–ø–æ–ª–Ω—è–µ—Ç—Å—è, –µ—Å–ª–∏ –ø—Ä–æ–∏—Å—Ö–æ–¥–∏—Ç –æ—à–∏–±–∫–∞ ‚Äî –≤—ã–ø–æ–ª–Ω—è–µ—Ç—Å—è `catch`. `e` ‚Äî –æ–±—ä–µ–∫—Ç –æ—à–∏–±–∫–∏ (–æ–±—ã—á–Ω–æ `Exception` –∏–ª–∏ `Error`).
- **`await http.post(Uri.parse('$baseUrl/auth/login'), ...)`** ‚Äî HTTP POST-–∑–∞–ø—Ä–æ—Å. `http` ‚Äî –ø–∞–∫–µ—Ç `http`. `post` ‚Äî –º–µ—Ç–æ–¥ –¥–ª—è POST-–∑–∞–ø—Ä–æ—Å–∞. `Uri.parse(...)` ‚Äî –ø–∞—Ä—Å–∏—Ç —Å—Ç—Ä–æ–∫—É –≤ –æ–±—ä–µ–∫—Ç URI. `$baseUrl` ‚Äî –∏–Ω—Ç–µ—Ä–ø–æ–ª—è—Ü–∏—è —Å—Ç—Ä–æ–∫ (–ø–æ–¥—Å—Ç–∞–Ω–æ–≤–∫–∞ –∑–Ω–∞—á–µ–Ω–∏—è –ø–µ—Ä–µ–º–µ–Ω–Ω–æ–π).
- **`headers: {'Content-Type': 'application/json'}`** ‚Äî –∑–∞–≥–æ–ª–æ–≤–∫–∏ HTTP. `headers` ‚Äî –∏–º–µ–Ω–æ–≤–∞–Ω–Ω—ã–π –ø–∞—Ä–∞–º–µ—Ç—Ä (Map). `'Content-Type': 'application/json'` ‚Äî –≥–æ–≤–æ—Ä–∏—Ç —Å–µ—Ä–≤–µ—Ä—É, —á—Ç–æ —Ç–µ–ª–æ –∑–∞–ø—Ä–æ—Å–∞ ‚Äî JSON.
- **`body: jsonEncode({'username': username, 'password': password})`** ‚Äî —Ç–µ–ª–æ –∑–∞–ø—Ä–æ—Å–∞. `jsonEncode` ‚Äî —Ñ—É–Ω–∫—Ü–∏—è –∏–∑ `dart:convert`, –ø—Ä–µ–≤—Ä–∞—â–∞–µ—Ç –æ–±—ä–µ–∫—Ç –≤ JSON-—Å—Ç—Ä–æ–∫—É. `{'username': username, ...}` ‚Äî Map-–ª–∏—Ç–µ—Ä–∞–ª (–æ–±—ä–µ–∫—Ç).
- **`response.statusCode == 200`** ‚Äî –ø—Ä–æ–≤–µ—Ä–∫–∞ –∫–æ–¥–∞ –æ—Ç–≤–µ—Ç–∞. `200` ‚Äî —É—Å–ø–µ—Ö. `statusCode` ‚Äî —Å–≤–æ–π—Å—Ç–≤–æ –æ–±—ä–µ–∫—Ç–∞ `Response`.
- **`jsonDecode(response.body)`** ‚Äî –ø–∞—Ä—Å–∏—Ç JSON-—Å—Ç—Ä–æ–∫—É –≤ –æ–±—ä–µ–∫—Ç. `response.body` ‚Äî —Ç–µ–ª–æ –æ—Ç–≤–µ—Ç–∞ (—Å—Ç—Ä–æ–∫–∞). `jsonDecode` ‚Äî —Ñ—É–Ω–∫—Ü–∏—è –∏–∑ `dart:convert`, –≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç `Map<String, dynamic>` –∏–ª–∏ `List`.
- **`data['token'] != null`** ‚Äî –ø—Ä–æ–≤–µ—Ä–∫–∞, –µ—Å—Ç—å –ª–∏ –ø–æ–ª–µ `token` –≤ Map. `!= null` ‚Äî —è–≤–Ω–∞—è –ø—Ä–æ–≤–µ—Ä–∫–∞ –Ω–∞ null (–≤ Dart null-safety —ç—Ç–æ –≤–∞–∂–Ω–æ).
- **`data['username'] ?? data['email'] ?? ''`** ‚Äî –æ–ø–µ—Ä–∞—Ç–æ—Ä `??`. –ï—Å–ª–∏ `data['username']` null, –±–µ—Ä—ë—Ç—Å—è `data['email']`, –µ—Å–ª–∏ –∏ –æ–Ω null ‚Äî `''`.
- **`await StorageService.saveUserData(...)`** ‚Äî –≤—ã–∑–æ–≤ —Å—Ç–∞—Ç–∏—á–µ—Å–∫–æ–≥–æ –º–µ—Ç–æ–¥–∞. `StorageService` ‚Äî –∫–ª–∞—Å—Å —Å–æ —Å—Ç–∞—Ç–∏—á–µ—Å–∫–∏–º–∏ –º–µ—Ç–æ–¥–∞–º–∏, –Ω–µ –Ω—É–∂–Ω–æ —Å–æ–∑–¥–∞–≤–∞—Ç—å —ç–∫–∑–µ–º–ø–ª—è—Ä.
- **`data['id'].toString()`** ‚Äî –ø—Ä–µ–æ–±—Ä–∞–∑–æ–≤–∞–Ω–∏–µ –≤ —Å—Ç—Ä–æ–∫—É. `data['id']` –º–æ–∂–µ—Ç –±—ã—Ç—å int –∏–ª–∏ String, `toString()` –ø—Ä–∏–≤–æ–¥–∏—Ç –∫ —Å—Ç—Ä–æ–∫–µ.
- **`throw Exception('...')`** ‚Äî –≤—ã–±—Ä–∞—Å—ã–≤–∞–µ—Ç –∏—Å–∫–ª—é—á–µ–Ω–∏–µ. –ü—Ä–µ—Ä—ã–≤–∞–µ—Ç –≤—ã–ø–æ–ª–Ω–µ–Ω–∏–µ —Ñ—É–Ω–∫—Ü–∏–∏, —É–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –ø–µ—Ä–µ—Ö–æ–¥–∏—Ç –≤ `catch`.
- **`if (e is Exception) rethrow`** ‚Äî –ø—Ä–æ–≤–µ—Ä–∫–∞ —Ç–∏–ø–∞. `is` ‚Äî –æ–ø–µ—Ä–∞—Ç–æ—Ä –ø—Ä–æ–≤–µ—Ä–∫–∏ —Ç–∏–ø–∞. `rethrow` ‚Äî –ø—Ä–æ–±—Ä–∞—Å—ã–≤–∞–µ—Ç –∏—Å–∫–ª—é—á–µ–Ω–∏–µ –¥–∞–ª—å—à–µ (–Ω–µ –æ–±—Ä–∞–±–∞—Ç—ã–≤–∞–µ—Ç, –∞ –ø–µ—Ä–µ–¥–∞—ë—Ç –≤—ã–∑—ã–≤–∞—é—â–µ–º—É –∫–æ–¥—É).

**–ö–æ–¥ –∏–∑ –ø—Ä–æ–µ–∫—Ç–∞.** –§–∞–π–ª: `lib/services/auth_service.dart`

```dart
import 'dart:convert';
import 'package:http/http.dart' as http;
import '../config/api_config.dart';
import 'storage_service.dart';

class AuthService {
  final String baseUrl = ApiConfig.baseUrl;

  Future<Map<String, dynamic>?> loginUser(String username, String password) async {
    try {
      final response = await http.post(
        Uri.parse('$baseUrl/auth/login'),
        headers: {'Content-Type': 'application/json'},
        body: jsonEncode({'username': username, 'password': password}),
      );

      if (response.statusCode == 200) {
        final data = jsonDecode(response.body);
        if (data['token'] != null) {
          final userIdentifier = data['username'] ?? data['email'] ?? '';
          await StorageService.saveUserData(
            data['id'].toString(),
            userIdentifier,
            data['token'],
          );
          await StorageService.setPrivateFeaturesUnlocked(data['id'].toString(), false);
        }
        return data;
      } else if (response.statusCode == 401) {
        throw Exception('–ù–µ–≤–µ—Ä–Ω—ã–π –ª–æ–≥–∏–Ω –∏–ª–∏ –ø–∞—Ä–æ–ª—å');
      } else {
        throw Exception('–û—à–∏–±–∫–∞ –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è –∫ —Å–µ—Ä–≤–µ—Ä—É (${response.statusCode})');
      }
    } catch (e) {
      if (e is Exception) rethrow;
      throw Exception('–û—à–∏–±–∫–∞ —Å–µ—Ç–∏: $e');
    }
  }
}
```

**–ß—Ç–æ –Ω—É–∂–Ω–æ –∑–Ω–∞—Ç—å:** —á—Ç–æ —Ç–∞–∫–æ–µ –∫–ª–∞—Å—Å—ã –∏ –º–µ—Ç–æ–¥—ã, —á—Ç–æ —Ç–∞–∫–æ–µ async/await –∏ Future, —á—Ç–æ —Ç–∞–∫–æ–µ try/catch, —á—Ç–æ —Ç–∞–∫–æ–µ HTTP-–∑–∞–ø—Ä–æ—Å—ã (POST, —Å—Ç–∞—Ç—É—Å-–∫–æ–¥—ã), —á—Ç–æ —Ç–∞–∫–æ–µ JSON (jsonEncode/jsonDecode), —á—Ç–æ —Ç–∞–∫–æ–µ Map –∏ –æ–±—Ä–∞—â–µ–Ω–∏–µ –ø–æ –∫–ª—é—á–∞–º, —á—Ç–æ —Ç–∞–∫–æ–µ –æ–ø–µ—Ä–∞—Ç–æ—Ä `??` –∏ `is`.

---

### 3.4. –•—Ä–∞–Ω–∏–ª–∏—â–µ: –∫–ª–∞—Å—Å `StorageService` ‚Äî —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ —Ç–æ–∫–µ–Ω–∞

**–ü—Ä–æ—Å—Ç—ã–º–∏ —Å–ª–æ–≤–∞–º–∏:** –ø–æ—Å–ª–µ –≤—Ö–æ–¥–∞ –Ω—É–∂–Ω–æ ¬´–∑–∞–ø–æ–º–Ω–∏—Ç—å¬ª –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è –∏ —Ç–æ–∫–µ–Ω, —á—Ç–æ–±—ã –ø—Ä–∏ —Å–ª–µ–¥—É—é—â–µ–º –æ—Ç–∫—Ä—ã—Ç–∏–∏ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è –Ω–µ –≤–≤–æ–¥–∏—Ç—å –ª–æ–≥–∏–Ω —Å–Ω–æ–≤–∞. `StorageService` ‚Äî —ç—Ç–æ —Å–ª–æ–π, –∫–æ—Ç–æ—Ä—ã–π —Å–æ—Ö—Ä–∞–Ω—è–µ—Ç –∏ —á–∏—Ç–∞–µ—Ç —ç—Ç–∏ –¥–∞–Ω–Ω—ã–µ —Å —É—Å—Ç—Ä–æ–π—Å—Ç–≤–∞ (–Ω–∞ web ‚Äî –≤ –±—Ä–∞—É–∑–µ—Ä–µ, –Ω–∞ —Ç–µ–ª–µ—Ñ–æ–Ω–µ ‚Äî –≤ –∑–∞—â–∏—â—ë–Ω–Ω–æ–º —Ö—Ä–∞–Ω–∏–ª–∏—â–µ).

**–ß—Ç–æ –¥–µ–ª–∞–µ—Ç:** —Å–æ—Ö—Ä–∞–Ω—è–µ—Ç –∏ —á–∏—Ç–∞–µ—Ç –¥–∞–Ω–Ω—ã–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è (userId, email, —Ç–æ–∫–µ–Ω) –∏–∑ –ª–æ–∫–∞–ª—å–Ω–æ–≥–æ —Ö—Ä–∞–Ω–∏–ª–∏—â–∞. –ù–∞ web –∏—Å–ø–æ–ª—å–∑—É–µ—Ç `SharedPreferences`, –Ω–∞ –º–æ–±–∏–ª—å–Ω—ã—Ö ‚Äî `FlutterSecureStorage` –¥–ª—è —Ç–æ–∫–µ–Ω–∞ (–±–µ–∑–æ–ø–∞—Å–Ω–æ–µ —Ö—Ä–∞–Ω–∏–ª–∏—â–µ).

**–ö–∞–∫ —Ä–∞–±–æ—Ç–∞–µ—Ç:** —ç—Ç–æ –∫–ª–∞—Å—Å —Å–æ —Å—Ç–∞—Ç–∏—á–µ—Å–∫–∏–º–∏ –º–µ—Ç–æ–¥–∞–º–∏ (—ç–∫–∑–µ–º–ø–ª—è—Ä —Å–æ–∑–¥–∞–≤–∞—Ç—å –Ω–µ –Ω—É–∂–Ω–æ). –ú–µ—Ç–æ–¥—ã –∞—Å–∏–Ω—Ö—Ä–æ–Ω–Ω—ã–µ: —á—Ç–µ–Ω–∏–µ/–∑–∞–ø–∏—Å—å –≤ —Ö—Ä–∞–Ω–∏–ª–∏—â–µ –∑–∞–Ω–∏–º–∞–µ—Ç –≤—Ä–µ–º—è, –ø–æ—ç—Ç–æ–º—É –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è `await`.

**–¢–µ–æ—Ä–∏—è.** **–õ–æ–∫–∞–ª—å–Ω–æ–µ —Ö—Ä–∞–Ω–∏–ª–∏—â–µ** ‚Äî –¥–∞–Ω–Ω—ã–µ, –∫–æ—Ç–æ—Ä—ã–µ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ —Å–æ—Ö—Ä–∞–Ω—è–µ—Ç –Ω–∞ —É—Å—Ç—Ä–æ–π—Å—Ç–≤–µ –∏ —á–∏—Ç–∞–µ—Ç –ø—Ä–∏ —Å–ª–µ–¥—É—é—â–µ–º –∑–∞–ø—É—Å–∫–µ. –ë–µ–∑ –Ω–µ–≥–æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—é –ø—Ä–∏—à–ª–æ—Å—å –±—ã –∫–∞–∂–¥—ã–π —Ä–∞–∑ –≤–≤–æ–¥–∏—Ç—å –ª–æ–≥–∏–Ω –∏ –ø–∞—Ä–æ–ª—å. –¢–æ–∫–µ–Ω –∏ –∏–¥–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ç–æ—Ä –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è —Å–æ—Ö—Ä–∞–Ω—è—é—Ç—Å—è –ø–æ—Å–ª–µ –≤—Ö–æ–¥–∞ –∏ –ø—Ä–∏ –∫–∞–∂–¥–æ–º –∑–∞–ø—Ä–æ—Å–µ –∫ API (–∏ –ø—Ä–∏ –æ—Ç–∫—Ä—ã—Ç–∏–∏ WebSocket) –ø–æ–¥—Å—Ç–∞–≤–ª—è—é—Ç—Å—è –≤ –∑–∞–≥–æ–ª–æ–≤–æ–∫ Authorization. **SharedPreferences** (–∏ –∞–Ω–∞–ª–æ–≥–∏ –≤ –¥—Ä—É–≥–∏—Ö —Ñ—Ä–µ–π–º–≤–æ—Ä–∫–∞—Ö) ‚Äî –∫–ª—é—á-–∑–Ω–∞—á–µ–Ω–∏–µ —Ö—Ä–∞–Ω–∏–ª–∏—â–µ: —Å—Ç—Ä–æ–∫–∏, —á–∏—Å–ª–∞, –±—É–ª–µ–≤—ã –∑–Ω–∞—á–µ–Ω–∏—è. –ù–∞ web –¥–∞–Ω–Ω—ã–µ —Ö—Ä–∞–Ω—è—Ç—Å—è –≤ localStorage –±—Ä–∞—É–∑–µ—Ä–∞. **FlutterSecureStorage** –Ω–∞ –º–æ–±–∏–ª—å–Ω—ã—Ö –∏—Å–ø–æ–ª—å–∑—É–µ—Ç –∑–∞—â–∏—â—ë–Ω–Ω—ã–µ —Ö—Ä–∞–Ω–∏–ª–∏—â–∞ –û–° (Keychain –Ω–∞ iOS, EncryptedSharedPreferences –Ω–∞ Android), —á—Ç–æ–±—ã —Ç–æ–∫–µ–Ω –Ω–µ –ª–µ–∂–∞–ª –≤ –æ—Ç–∫—Ä—ã—Ç–æ–º –≤–∏–¥–µ. –ù–∞ web –±–µ–∑–æ–ø–∞—Å–Ω–æ–µ —Ö—Ä–∞–Ω–∏–ª–∏—â–µ –¥–ª—è —Ç–æ–∫–µ–Ω–∞ —á–∞—Å—Ç–æ –Ω–µ–¥–æ—Å—Ç—É–ø–Ω–æ –≤ —Ç–æ–º –∂–µ –≤–∏–¥–µ, –ø–æ—ç—Ç–æ–º—É –≤ –ø—Ä–æ–µ–∫—Ç–µ –Ω–∞ web —Ç–æ–∫–µ–Ω –∫–ª–∞–¥—É—Ç –≤ SharedPreferences, –∞ –Ω–∞ –º–æ–±–∏–ª—å–Ω—ã—Ö ‚Äî –≤ secure storage. **–°–∏–Ω–≥–ª—Ç–æ–Ω** (`getInstance()`): –æ–¥–∏–Ω –æ–±—â–∏–π —ç–∫–∑–µ–º–ø–ª—è—Ä —Ö—Ä–∞–Ω–∏–ª–∏—â–∞ –Ω–∞ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ, —á—Ç–æ–±—ã –Ω–µ —Å–æ–∑–¥–∞–≤–∞—Ç—å –Ω–µ—Å–∫–æ–ª—å–∫–æ –ø–æ–¥–∫–ª—é—á–µ–Ω–∏–π –∏ –Ω–µ —Ä–∞—Å—Ö–æ–¥–∏—Ç—å—Å—è –≤ –¥–∞–Ω–Ω—ã—Ö.

**–°–∏–Ω—Ç–∞–∫—Å–∏—Å –∏ –∫–æ–Ω—Ü–µ–ø—Ü–∏–∏:**

- **`class StorageService { ... }`** ‚Äî –∫–ª–∞—Å—Å —Å–æ —Å—Ç–∞—Ç–∏—á–µ—Å–∫–∏–º–∏ –º–µ—Ç–æ–¥–∞–º–∏.
- **`static const String _userIdKey = 'user_id'`** ‚Äî —Å—Ç–∞—Ç–∏—á–µ—Å–∫–∞—è –∫–æ–Ω—Å—Ç–∞–Ω—Ç–∞. –ò—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è –∫–∞–∫ –∫–ª—é—á –≤ —Ö—Ä–∞–Ω–∏–ª–∏—â–µ.
- **`static const FlutterSecureStorage _secure = FlutterSecureStorage()`** ‚Äî —Å—Ç–∞—Ç–∏—á–µ—Å–∫–∏–π —ç–∫–∑–µ–º–ø–ª—è—Ä `FlutterSecureStorage`. –°–æ–∑–¥–∞—ë—Ç—Å—è –æ–¥–∏–Ω —Ä–∞–∑ –ø—Ä–∏ –ø–µ—Ä–≤–æ–º –æ–±—Ä–∞—â–µ–Ω–∏–∏.
- **`static Future<void> saveUserData(...) async { ... }`** ‚Äî —Å—Ç–∞—Ç–∏—á–µ—Å–∫–∏–π –∞—Å–∏–Ω—Ö—Ä–æ–Ω–Ω—ã–π –º–µ—Ç–æ–¥. `Future<void>` ‚Äî –Ω–µ –≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç –∑–Ω–∞—á–µ–Ω–∏–µ, —Ç–æ–ª—å–∫–æ —É—Å–ø–µ—Ö/–æ—à–∏–±–∫–∞.
- **`final prefs = await SharedPreferences.getInstance()`** ‚Äî –ø–æ–ª—É—á–∞–µ—Ç —ç–∫–∑–µ–º–ø–ª—è—Ä SharedPreferences. `getInstance()` ‚Äî —Å–∏–Ω–≥–ª—Ç–æ–Ω (–≤—Å–µ–≥–¥–∞ –≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç –æ–¥–∏–Ω –∏ —Ç–æ—Ç –∂–µ –æ–±—ä–µ–∫—Ç). `await` ‚Äî –∂–¥—ë—Ç –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏–∏.
- **`await prefs.setString(_userIdKey, userId)`** ‚Äî —Å–æ—Ö—Ä–∞–Ω—è–µ—Ç —Å—Ç—Ä–æ–∫—É –≤ —Ö—Ä–∞–Ω–∏–ª–∏—â–µ. `setString(key, value)` ‚Äî –∞—Å–∏–Ω—Ö—Ä–æ–Ω–Ω—ã–π –º–µ—Ç–æ–¥, –≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç Future.
- **`if (kIsWeb) { ... } else { ... }`** ‚Äî —É—Å–ª–æ–≤–Ω–∞—è –∫–æ–º–ø–∏–ª—è—Ü–∏—è. `kIsWeb` ‚Äî –∫–æ–Ω—Å—Ç–∞–Ω—Ç–∞ –∏–∑ `package:flutter/foundation.dart`. –ù–∞ —ç—Ç–∞–ø–µ –∫–æ–º–ø–∏–ª—è—Ü–∏–∏ Dart –∑–Ω–∞–µ—Ç, –∫–∞–∫–∞—è –ø–ª–∞—Ç—Ñ–æ—Ä–º–∞, –∏ –º–æ–∂–µ—Ç —É–±—Ä–∞—Ç—å –Ω–µ–∏—Å–ø–æ–ª—å–∑—É–µ–º—ã–π –∫–æ–¥.
- **`await _secure.write(key: _tokenKey, value: token)`** ‚Äî —Å–æ—Ö—Ä–∞–Ω—è–µ—Ç –≤ –±–µ–∑–æ–ø–∞—Å–Ω–æ–µ —Ö—Ä–∞–Ω–∏–ª–∏—â–µ. `key:` –∏ `value:` ‚Äî –∏–º–µ–Ω–æ–≤–∞–Ω–Ω—ã–µ –ø–∞—Ä–∞–º–µ—Ç—Ä—ã. `FlutterSecureStorage` –Ω–∞ iOS –∏—Å–ø–æ–ª—å–∑—É–µ—Ç Keychain, –Ω–∞ Android ‚Äî EncryptedSharedPreferences.
- **`await prefs.remove(_tokenKey)`** ‚Äî —É–¥–∞–ª—è–µ—Ç –∫–ª—é—á –∏–∑ —Ö—Ä–∞–Ω–∏–ª–∏—â–∞.
- **`static Future<Map<String, String>?> getUserData() async { ... }`** ‚Äî —á–∏—Ç–∞–µ—Ç –¥–∞–Ω–Ω—ã–µ. –í–æ–∑–≤—Ä–∞—â–∞–µ—Ç `Map<String, String>?` (–º–æ–∂–µ—Ç –±—ã—Ç—å null, –µ—Å–ª–∏ –¥–∞–Ω–Ω—ã—Ö –Ω–µ—Ç).
- **`prefs.getString(_userIdKey)`** ‚Äî —á–∏—Ç–∞–µ—Ç —Å—Ç—Ä–æ–∫—É –∏–∑ —Ö—Ä–∞–Ω–∏–ª–∏—â–∞. –í–æ–∑–≤—Ä–∞—â–∞–µ—Ç `String?` (null –µ—Å–ª–∏ –∫–ª—é—á–∞ –Ω–µ—Ç).
- **`if (userId != null && userEmail != null && token != null) { return { ... }; }`** ‚Äî –ø—Ä–æ–≤–µ—Ä–∫–∞, —á—Ç–æ –≤—Å–µ –¥–∞–Ω–Ω—ã–µ –µ—Å—Ç—å. `&&` ‚Äî –ª–æ–≥–∏—á–µ—Å–∫–æ–µ –ò (–≤—Å–µ —É—Å–ª–æ–≤–∏—è –¥–æ–ª–∂–Ω—ã –±—ã—Ç—å true).
- **`return { 'id': userId, 'email': userEmail, 'token': token }`** ‚Äî –≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç Map-–ª–∏—Ç–µ—Ä–∞–ª. –ö–æ—Ä–æ—Ç–∫–∞—è –∑–∞–ø–∏—Å—å –¥–ª—è `Map<String, String>`.
- **`return null`** ‚Äî –≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç null, –µ—Å–ª–∏ –¥–∞–Ω–Ω—ã—Ö –Ω–µ—Ç.
- **`prefs.getBool('...') ?? false`** ‚Äî —á–∏—Ç–∞–µ—Ç boolean –∏–∑ —Ö—Ä–∞–Ω–∏–ª–∏—â–∞. –ï—Å–ª–∏ –∫–ª—é—á–∞ –Ω–µ—Ç, –≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç `false` (–∑–Ω–∞—á–µ–Ω–∏–µ –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é —á–µ—Ä–µ–∑ `??`).

**–ö–æ–¥ –∏–∑ –ø—Ä–æ–µ–∫—Ç–∞.** –§–∞–π–ª: `lib/services/storage_service.dart`

```dart
import 'package:shared_preferences/shared_preferences.dart';
import 'package:flutter/foundation.dart' show kIsWeb, kDebugMode;
import 'package:flutter_secure_storage/flutter_secure_storage.dart';

class StorageService {
  static const String _userIdKey = 'user_id';
  static const String _userEmailKey = 'user_email';
  static const String _tokenKey = 'auth_token';
  static const FlutterSecureStorage _secure = FlutterSecureStorage();

  static Future<void> saveUserData(String userId, String userEmail, String token) async {
    try {
      final prefs = await SharedPreferences.getInstance();
      await prefs.setString(_userIdKey, userId);
      await prefs.setString(_userEmailKey, userEmail);
      
      if (kIsWeb) {
        await prefs.setString(_tokenKey, token);
      } else {
        await _secure.write(key: _tokenKey, value: token);
        await prefs.remove(_tokenKey);
      }
    } catch (e) {
      if (kDebugMode) {
        print('StorageService.saveUserData error: $e');
      }
      rethrow;
    }
  }

  static Future<Map<String, String>?> getUserData() async {
    try {
      final prefs = await SharedPreferences.getInstance();
      final userId = prefs.getString(_userIdKey);
      final userEmail = prefs.getString(_userEmailKey);
      final token = await getToken();

      if (userId != null && userEmail != null && token != null) {
        return {
          'id': userId,
          'email': userEmail,
          'token': token,
        };
      }
      return null;
    } catch (e) {
      if (kDebugMode) {
        print('StorageService.getUserData error: $e');
      }
      return null;
    }
  }

  static Future<String?> getToken() async {
    try {
      final prefs = await SharedPreferences.getInstance();
      if (kIsWeb) {
        return prefs.getString(_tokenKey);
      }
      final token = await _secure.read(key: _tokenKey);
      if (token == null) {
        final legacy = prefs.getString(_tokenKey);
        if (legacy != null && legacy.isNotEmpty) {
          await _secure.write(key: _tokenKey, value: legacy);
          await prefs.remove(_tokenKey);
          return legacy;
        }
      }
      return token;
    } catch (e) {
      if (kDebugMode) {
        print('StorageService.getToken error: $e');
      }
      return null;
    }
  }
}
```

**–ß—Ç–æ –Ω—É–∂–Ω–æ –∑–Ω–∞—Ç—å:** —á—Ç–æ —Ç–∞–∫–æ–µ —Å—Ç–∞—Ç–∏—á–µ—Å–∫–∏–µ –º–µ—Ç–æ–¥—ã, —á—Ç–æ —Ç–∞–∫–æ–µ async/await, —á—Ç–æ —Ç–∞–∫–æ–µ Map –∏ Map-–ª–∏—Ç–µ—Ä–∞–ª—ã, —á—Ç–æ —Ç–∞–∫–æ–µ null-safety (`?`, `??`, `!= null`), —á—Ç–æ —Ç–∞–∫–æ–µ `kIsWeb` –∏ —É—Å–ª–æ–≤–Ω–∞—è –∫–æ–º–ø–∏–ª—è—Ü–∏—è, —á—Ç–æ —Ç–∞–∫–æ–µ —Å–∏–Ω–≥–ª—Ç–æ–Ω (`getInstance()`).

---

### 3.5. –≠–∫—Ä–∞–Ω: –∫–ª–∞—Å—Å `LoginScreen` –∏ –º–µ—Ç–æ–¥ `_login`

**–ü—Ä–æ—Å—Ç—ã–º–∏ —Å–ª–æ–≤–∞–º–∏:** —ç—Ç–æ —ç–∫—Ä–∞–Ω —Å –ø–æ–ª—è–º–∏ ¬´–ª–æ–≥–∏–Ω¬ª –∏ ¬´–ø–∞—Ä–æ–ª—å¬ª –∏ –∫–Ω–æ–ø–∫–æ–π ¬´–í–æ–π—Ç–∏¬ª. –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –≤–≤–æ–¥–∏—Ç –¥–∞–Ω–Ω—ã–µ –∏ –Ω–∞–∂–∏–º–∞–µ—Ç –∫–Ω–æ–ø–∫—É ‚Äî –≤—ã–∑—ã–≤–∞–µ—Ç—Å—è –º–µ—Ç–æ–¥ `_login()`. –û–Ω –æ—Ç–ø—Ä–∞–≤–ª—è–µ—Ç –∑–∞–ø—Ä–æ—Å –Ω–∞ —Å–µ—Ä–≤–µ—Ä —á–µ—Ä–µ–∑ `AuthService`; –ø—Ä–∏ —É—Å–ø–µ—Ö–µ —Å–æ—Ö—Ä–∞–Ω—è–µ—Ç —Ç–æ–∫–µ–Ω –∏ –ø–µ—Ä–µ—Ö–æ–¥–∏—Ç –Ω–∞ –≥–ª–∞–≤–Ω—ã–π —ç–∫—Ä–∞–Ω, –ø—Ä–∏ –æ—à–∏–±–∫–µ –ø–æ–∫–∞–∑—ã–≤–∞–µ—Ç —Å–æ–æ–±—â–µ–Ω–∏–µ –æ–± –æ—à–∏–±–∫–µ.

**–ß—Ç–æ –¥–µ–ª–∞–µ—Ç:** —ç–∫—Ä–∞–Ω –≤—Ö–æ–¥–∞. –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –≤–≤–æ–¥–∏—Ç –ª–æ–≥–∏–Ω –∏ –ø–∞—Ä–æ–ª—å, –Ω–∞–∂–∏–º–∞–µ—Ç –∫–Ω–æ–ø–∫—É, –≤—ã–∑—ã–≤–∞–µ—Ç—Å—è `_login()`, –∫–æ—Ç–æ—Ä—ã–π –æ—Ç–ø—Ä–∞–≤–ª—è–µ—Ç –∑–∞–ø—Ä–æ—Å –Ω–∞ —Å–µ—Ä–≤–µ—Ä, –ø—Ä–∏ —É—Å–ø–µ—Ö–µ —Å–æ—Ö—Ä–∞–Ω—è–µ—Ç –¥–∞–Ω–Ω—ã–µ –∏ –ø–µ—Ä–µ—Ö–æ–¥–∏—Ç –Ω–∞ –≥–ª–∞–≤–Ω—ã–π —ç–∫—Ä–∞–Ω.

**–ö–∞–∫ —Ä–∞–±–æ—Ç–∞–µ—Ç:** —ç—Ç–æ `StatefulWidget` (–≤–∏–¥–∂–µ—Ç —Å —Å–æ—Å—Ç–æ—è–Ω–∏–µ–º). –°–æ—Å—Ç–æ—è–Ω–∏–µ —Ö—Ä–∞–Ω–∏—Ç—Å—è –≤ `_LoginScreenState`: –∫–æ–Ω—Ç—Ä–æ–ª–ª–µ—Ä—ã –ø–æ–ª–µ–π –≤–≤–æ–¥–∞, —Ñ–ª–∞–≥ –∑–∞–≥—Ä—É–∑–∫–∏ (`_isLoading`), —Å–æ–æ–±—â–µ–Ω–∏–µ –æ–± –æ—à–∏–±–∫–µ (`_errorMessage`). –ü—Ä–∏ –Ω–∞–∂–∞—Ç–∏–∏ –∫–Ω–æ–ø–∫–∏ –≤—ã–∑—ã–≤–∞–µ—Ç—Å—è `_login()`, –∫–æ—Ç–æ—Ä—ã–π –æ–±–Ω–æ–≤–ª—è–µ—Ç —Å–æ—Å—Ç–æ—è–Ω–∏–µ —á–µ—Ä–µ–∑ `setState()` –∏ –ø—Ä–∏ —É—Å–ø–µ—Ö–µ –≤—ã–∑—ã–≤–∞–µ—Ç –Ω–∞–≤–∏–≥–∞—Ü–∏—é –Ω–∞ –≥–ª–∞–≤–Ω—ã–π —ç–∫—Ä–∞–Ω.

**–¢–µ–æ—Ä–∏—è.** **StatefulWidget + State**: —ç–∫—Ä–∞–Ω –≤—Ö–æ–¥–∞ –¥–æ–ª–∂–µ–Ω —Ö—Ä–∞–Ω–∏—Ç—å –≤–≤–µ–¥—ë–Ω–Ω—ã–π —Ç–µ–∫—Å—Ç, —Ñ–ª–∞–≥ ¬´–∏–¥—ë—Ç –∑–∞–≥—Ä—É–∑–∫–∞¬ª –∏ —Å–æ–æ–±—â–µ–Ω–∏–µ –æ–± –æ—à–∏–±–∫–µ. –≠—Ç–∏ –¥–∞–Ω–Ω—ã–µ –º–µ–Ω—è—é—Ç—Å—è –≤ –ø—Ä–æ—Ü–µ—Å—Å–µ —Ä–∞–±–æ—Ç—ã —ç–∫—Ä–∞–Ω–∞, –ø–æ—ç—Ç–æ–º—É –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è State: –≤ State —Ö—Ä–∞–Ω—è—Ç—Å—è `_usernameController`, `_passwordController`, `_isLoading`, `_errorMessage`. –ü—Ä–∏ –∏–∑–º–µ–Ω–µ–Ω–∏–∏ –ª—é–±–æ–≥–æ –∏–∑ –Ω–∏—Ö –≤—ã–∑—ã–≤–∞–µ—Ç—Å—è `setState()` ‚Äî Flutter –ø–µ—Ä–µ—Å—Ç—Ä–∞–∏–≤–∞–µ—Ç –≤–∏–¥–∂–µ—Ç, –∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –≤–∏–¥–∏—Ç –æ–±–Ω–æ–≤–ª—ë–Ω–Ω—ã–π UI (–∏–Ω–¥–∏–∫–∞—Ç–æ—Ä –∑–∞–≥—Ä—É–∑–∫–∏, —Ç–µ–∫—Å—Ç –æ—à–∏–±–∫–∏). **–ö–æ–Ω—Ç—Ä–æ–ª–ª–µ—Ä—ã –ø–æ–ª–µ–π –≤–≤–æ–¥–∞** (`TextEditingController`): –≤–∏–¥–∂–µ—Ç `TextField` –º–æ–∂–µ—Ç –±—ã—Ç—å ¬´–Ω–µ—É–ø—Ä–∞–≤–ª—è–µ–º—ã–º¬ª (—Ç–æ–≥–¥–∞ Flutter —Å–∞–º —Ö—Ä–∞–Ω–∏—Ç —Ç–µ–∫—Å—Ç) –∏–ª–∏ ¬´—É–ø—Ä–∞–≤–ª—è–µ–º—ã–º¬ª ‚Äî —Ç–µ–∫—Å—Ç –ø—Ä–∏–≤—è–∑–∞–Ω –∫ –∫–æ–Ω—Ç—Ä–æ–ª–ª–µ—Ä—É. –ß–µ—Ä–µ–∑ –∫–æ–Ω—Ç—Ä–æ–ª–ª–µ—Ä –º—ã —á–∏—Ç–∞–µ–º –≤–≤–µ–¥—ë–Ω–Ω–æ–µ –∑–Ω–∞—á–µ–Ω–∏–µ –ø—Ä–∏ –Ω–∞–∂–∞—Ç–∏–∏ –∫–Ω–æ–ø–∫–∏ (`_usernameController.text`). **–ù–∞–≤–∏–≥–∞—Ü–∏—è**: –ø–µ—Ä–µ—Ö–æ–¥ –Ω–∞ –¥—Ä—É–≥–æ–π —ç–∫—Ä–∞–Ω –≤–æ Flutter –¥–µ–ª–∞–µ—Ç—Å—è —á–µ—Ä–µ–∑ `Navigator`. `pushReplacement` –∑–∞–º–µ–Ω—è–µ—Ç —Ç–µ–∫—É—â–∏–π —ç–∫—Ä–∞–Ω –Ω–æ–≤—ã–º (—Å—Ç–µ–∫ —ç–∫—Ä–∞–Ω–æ–≤ –Ω–µ —Ä–∞—Å—Ç—ë—Ç, ¬´–Ω–∞–∑–∞–¥¬ª –Ω–∞ —ç–∫—Ä–∞–Ω –≤—Ö–æ–¥–∞ –≤–µ—Ä–Ω—É—Ç—å—Å—è –Ω–µ–ª—å–∑—è ‚Äî —Ç–∏–ø–∏—á–Ω–æ –ø–æ—Å–ª–µ —É—Å–ø–µ—à–Ω–æ–≥–æ –≤—Ö–æ–¥–∞). `MaterialPageRoute` –æ–ø–∏—Å—ã–≤–∞–µ—Ç –º–∞—Ä—à—Ä—É—Ç –∏ –≤–∏–¥–∂–µ—Ç —Å–ª–µ–¥—É—é—â–µ–≥–æ —ç–∫—Ä–∞–Ω–∞ (`builder` –≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç MainTabsScreen). **–ü—Ä–æ–≤–µ—Ä–∫–∞ `mounted`**: –ø–æ—Å–ª–µ `await` –≤–∏–¥–∂–µ—Ç –º–æ–≥ –±—ã—Ç—å —É–∂–µ —É–¥–∞–ª—ë–Ω –∏–∑ –¥–µ—Ä–µ–≤–∞ (–ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å —É—à—ë–ª —Å —ç–∫—Ä–∞–Ω–∞). –í—ã–∑–æ–≤ `setState()` –Ω–∞ —É–¥–∞–ª—ë–Ω–Ω–æ–º –≤–∏–¥–∂–µ—Ç–µ –ø—Ä–∏–≤–æ–¥–∏—Ç –∫ –æ—à–∏–±–∫–µ; –ø—Ä–æ–≤–µ—Ä–∫–∞ `if (mounted)` –∏–∑–±–µ–≥–∞–µ—Ç —ç—Ç–æ–≥–æ.

**–°–∏–Ω—Ç–∞–∫—Å–∏—Å –∏ –∫–æ–Ω—Ü–µ–ø—Ü–∏–∏:**

- **`class LoginScreen extends StatefulWidget`** ‚Äî –≤–∏–¥–∂–µ—Ç —Å —Å–æ—Å—Ç–æ—è–Ω–∏–µ–º. `StatefulWidget` ‚Äî –≤–∏–¥–∂–µ—Ç, –∫–æ—Ç–æ—Ä—ã–π –º–æ–∂–µ—Ç –º–µ–Ω—è—Ç—å —Å–≤–æ—ë —Å–æ—Å—Ç–æ—è–Ω–∏–µ.
- **`_LoginScreenState createState() => _LoginScreenState()`** ‚Äî —Å–æ–∑–¥–∞—ë—Ç –æ–±—ä–µ–∫—Ç —Å–æ—Å—Ç–æ—è–Ω–∏—è. `_LoginScreenState` ‚Äî –∫–ª–∞—Å—Å, –∫–æ—Ç–æ—Ä—ã–π —Ö—Ä–∞–Ω–∏—Ç —Å–æ—Å—Ç–æ—è–Ω–∏–µ –∏ —Å—Ç—Ä–æ–∏—Ç UI.
- **`class _LoginScreenState extends State<LoginScreen>`** ‚Äî –∫–ª–∞—Å—Å —Å–æ—Å—Ç–æ—è–Ω–∏—è. `State<LoginScreen>` ‚Äî —Å–æ—Å—Ç–æ—è–Ω–∏–µ –¥–ª—è –≤–∏–¥–∂–µ—Ç–∞ `LoginScreen`.
- **`final _authService = AuthService()`** ‚Äî —ç–∫–∑–µ–º–ø–ª—è—Ä —Å–µ—Ä–≤–∏—Å–∞. `final` ‚Äî –Ω–µ–ª—å–∑—è –ø–µ—Ä–µ–ø—Ä–∏—Å–≤–æ–∏—Ç—å. –°–æ–∑–¥–∞—ë—Ç—Å—è –æ–¥–∏–Ω —Ä–∞–∑ –ø—Ä–∏ —Å–æ–∑–¥–∞–Ω–∏–∏ —Å–æ—Å—Ç–æ—è–Ω–∏—è.
- **`final _usernameController = TextEditingController()`** ‚Äî –∫–æ–Ω—Ç—Ä–æ–ª–ª–µ—Ä –¥–ª—è –ø–æ–ª—è –≤–≤–æ–¥–∞. `TextEditingController` ‚Äî –∫–ª–∞—Å—Å, –∫–æ—Ç–æ—Ä—ã–π —É–ø—Ä–∞–≤–ª—è–µ—Ç —Ç–µ–∫—Å—Ç–æ–º –≤ `TextField`. –ß–µ—Ä–µ–∑ `_usernameController.text` –º–æ–∂–Ω–æ —á–∏—Ç–∞—Ç—å/–ø–∏—Å–∞—Ç—å —Ç–µ–∫—Å—Ç.
- **`String? _errorMessage`** ‚Äî nullable —Å—Ç—Ä–æ–∫–∞. –ú–æ–∂–µ—Ç –±—ã—Ç—å `null` (–æ—à–∏–±–∫–∏ –Ω–µ—Ç) –∏–ª–∏ —Å—Ç—Ä–æ–∫–∞ (—Ç–µ–∫—Å—Ç –æ—à–∏–±–∫–∏).
- **`bool _isLoading = false`** ‚Äî —Ñ–ª–∞–≥ –∑–∞–≥—Ä—É–∑–∫–∏. `false` ‚Äî –Ω–µ –∑–∞–≥—Ä—É–∂–∞–µ—Ç—Å—è, `true` ‚Äî –∏–¥—ë—Ç –∑–∞–≥—Ä—É–∑–∫–∞.
- **`void _login() async { ... }`** ‚Äî –º–µ—Ç–æ–¥ –≤—Ö–æ–¥–∞. `void` ‚Äî –Ω–∏—á–µ–≥–æ –Ω–µ –≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç. `async` ‚Äî –≤–Ω—É—Ç—Ä–∏ –º–æ–∂–Ω–æ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å `await`.
- **`if (!mounted) return`** ‚Äî –ø—Ä–æ–≤–µ—Ä–∫–∞, —á—Ç–æ –≤–∏–¥–∂–µ—Ç –µ—â—ë –≤ –¥–µ—Ä–µ–≤–µ. –ï—Å–ª–∏ –≤–∏–¥–∂–µ—Ç —É–¥–∞–ª—ë–Ω, `mounted` –±—É–¥–µ—Ç `false`.
- **`setState(() { _isLoading = true; _errorMessage = null; })`** ‚Äî –æ–±–Ω–æ–≤–ª—è–µ—Ç —Å–æ—Å—Ç–æ—è–Ω–∏–µ. `setState` ‚Äî –º–µ—Ç–æ–¥ –∏–∑ `State`. –§—É–Ω–∫—Ü–∏—è –≤–Ω—É—Ç—Ä–∏ –º–µ–Ω—è–µ—Ç –ø–æ–ª—è, –ø–æ—Å–ª–µ —ç—Ç–æ–≥–æ Flutter –≤—ã–∑—ã–≤–∞–µ—Ç `build()` –∏ –ø–µ—Ä–µ—Ä–∏—Å–æ–≤—ã–≤–∞–µ—Ç –≤–∏–¥–∂–µ—Ç.
- **`_usernameController.text.trim()`** ‚Äî —á–∏—Ç–∞–µ—Ç —Ç–µ–∫—Å—Ç –∏–∑ –∫–æ–Ω—Ç—Ä–æ–ª–ª–µ—Ä–∞ –∏ —É–±–∏—Ä–∞–µ—Ç –ø—Ä–æ–±–µ–ª—ã –ø–æ –∫—Ä–∞—è–º. `text` ‚Äî —Å–≤–æ–π—Å—Ç–≤–æ `TextEditingController`, —Å–æ–¥–µ—Ä–∂–∏—Ç –≤–≤–µ–¥—ë–Ω–Ω—ã–π —Ç–µ–∫—Å—Ç.
- **`final userData = await _authService.loginUser(username, password)`** ‚Äî –≤—ã–∑–æ–≤ —Å–µ—Ä–≤–∏—Å–∞. `await` ‚Äî –∂–¥—ë—Ç –∑–∞–≤–µ—Ä—à–µ–Ω–∏—è –∑–∞–ø—Ä–æ—Å–∞. `userData` ‚Äî —Ä–µ–∑—É–ª—å—Ç–∞—Ç (Map –∏–ª–∏ null).
- **`if (userData != null && userData['token'] != null) { ... }`** ‚Äî –ø—Ä–æ–≤–µ—Ä–∫–∞ —É—Å–ø–µ—Ö–∞. –ï—Å–ª–∏ `userData` –Ω–µ null –∏ –≤ –Ω—ë–º –µ—Å—Ç—å `token`, –∑–Ω–∞—á–∏—Ç –ª–æ–≥–∏–Ω —É—Å–ø–µ—à–µ–Ω.
- **`Navigator.pushReplacement(context, MaterialPageRoute(...))`** ‚Äî –Ω–∞–≤–∏–≥–∞—Ü–∏—è. `Navigator` ‚Äî –∫–ª–∞—Å—Å –¥–ª—è –Ω–∞–≤–∏–≥–∞—Ü–∏–∏. `pushReplacement` ‚Äî –∑–∞–º–µ–Ω—è–µ—Ç —Ç–µ–∫—É—â–∏–π —ç–∫—Ä–∞–Ω –Ω–∞ –Ω–æ–≤—ã–π (–Ω–µ–ª—å–∑—è –≤–µ—Ä–Ω—É—Ç—å—Å—è –Ω–∞–∑–∞–¥). `context` ‚Äî –∫–æ–Ω—Ç–µ–∫—Å—Ç –≤–∏–¥–∂–µ—Ç–∞ (–Ω—É–∂–µ–Ω –¥–ª—è –Ω–∞–≤–∏–≥–∞—Ü–∏–∏). `MaterialPageRoute` ‚Äî –º–∞—Ä—à—Ä—É—Ç (–æ–ø–∏—Å—ã–≤–∞–µ—Ç –ø–µ—Ä–µ—Ö–æ–¥ –Ω–∞ –Ω–æ–≤—ã–π —ç–∫—Ä–∞–Ω). `builder: (_) => MainTabsScreen(...)` ‚Äî —Ñ—É–Ω–∫—Ü–∏—è, –∫–æ—Ç–æ—Ä–∞—è —Å–æ–∑–¥–∞—ë—Ç –Ω–æ–≤—ã–π —ç–∫—Ä–∞–Ω.
- **`MaterialPageRoute(builder: (_) => MainTabsScreen(...))`** ‚Äî –º–∞—Ä—à—Ä—É—Ç. `builder` ‚Äî —Ñ—É–Ω–∫—Ü–∏—è, –∫–æ—Ç–æ—Ä–∞—è —Å–æ–∑–¥–∞—ë—Ç –≤–∏–¥–∂–µ—Ç —ç–∫—Ä–∞–Ω–∞. `_` ‚Äî –ø–∞—Ä–∞–º–µ—Ç—Ä –Ω–µ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è (–º–æ–∂–Ω–æ –∑–∞–º–µ–Ω–∏—Ç—å –Ω–∞ `context`).
- **`e.toString().replaceFirst('Exception: ', '')`** ‚Äî –æ–±—Ä–∞–±–æ—Ç–∫–∞ –æ—à–∏–±–∫–∏. `e` ‚Äî –æ–±—ä–µ–∫—Ç –æ—à–∏–±–∫–∏. `toString()` ‚Äî –ø—Ä–µ–≤—Ä–∞—â–∞–µ—Ç –≤ —Å—Ç—Ä–æ–∫—É. `replaceFirst('Exception: ', '')` ‚Äî —É–±–∏—Ä–∞–µ—Ç –ø—Ä–µ—Ñ–∏–∫—Å "Exception: " –∏–∑ —Å—Ç—Ä–æ–∫–∏.

**–ö–æ–¥ –∏–∑ –ø—Ä–æ–µ–∫—Ç–∞.** –§–∞–π–ª: `lib/screens/login_screen.dart`

```dart
class LoginScreen extends StatefulWidget {
  @override
  _LoginScreenState createState() => _LoginScreenState();
}

class _LoginScreenState extends State<LoginScreen> {
  final _authService = AuthService();
  final _usernameController = TextEditingController();
  final _passwordController = TextEditingController();
  String? _errorMessage;
  bool _isLoading = false;

  void _login() async {
    if (!mounted) return;
    setState(() {
      _isLoading = true;
      _errorMessage = null;
    });

    final username = _usernameController.text.trim();
    final password = _passwordController.text.trim();

    try {
      final userData = await _authService.loginUser(username, password);

      if (!mounted) return;
      setState(() => _isLoading = false);

      if (userData != null && userData['token'] != null) {
        final userIdentifier = userData['username'] ?? userData['email'] ?? '';
        await StorageService.saveUserData(
          userData['id'].toString(),
          userIdentifier.toString(),
          userData['token'].toString(),
        );

        if (mounted) {
          Navigator.pushReplacement(
            context,
            MaterialPageRoute(
              builder: (_) => MainTabsScreen(
                userId: userData['id'].toString(),
                userEmail: userIdentifier.toString(),
              ),
            ),
          );
        }
      } else {
        setState(() {
          _errorMessage = '–ù–µ–≤–µ—Ä–Ω—ã–π –ª–æ–≥–∏–Ω –∏–ª–∏ –ø–∞—Ä–æ–ª—å';
        });
      }
    } catch (e) {
      if (mounted) {
        setState(() {
          _isLoading = false;
          _errorMessage = e.toString().replaceFirst('Exception: ', '');
        });
      }
    }
  }

  @override
  Widget build(BuildContext context) {
    return Scaffold(
      body: Container(...),
    );
  }
}
```

**–ß—Ç–æ –Ω—É–∂–Ω–æ –∑–Ω–∞—Ç—å:** —á—Ç–æ —Ç–∞–∫–æ–µ StatefulWidget –∏ State, —á—Ç–æ —Ç–∞–∫–æ–µ `setState`, —á—Ç–æ —Ç–∞–∫–æ–µ –∫–æ–Ω—Ç—Ä–æ–ª–ª–µ—Ä—ã (`TextEditingController`), —á—Ç–æ —Ç–∞–∫–æ–µ –Ω–∞–≤–∏–≥–∞—Ü–∏—è (`Navigator.pushReplacement`), —á—Ç–æ —Ç–∞–∫–æ–µ `mounted` –∏ –∑–∞—á–µ–º –µ–≥–æ –ø—Ä–æ–≤–µ—Ä—è—Ç—å, —á—Ç–æ —Ç–∞–∫–æ–µ try/catch.

---

### 3.6. –ú–æ–¥–µ–ª—å: –∫–ª–∞—Å—Å `Message` –∏ –º–µ—Ç–æ–¥—ã `fromJson` / `toJson`

**–ü—Ä–æ—Å—Ç—ã–º–∏ —Å–ª–æ–≤–∞–º–∏:** —Å —Å–µ—Ä–≤–µ—Ä–∞ –ø—Ä–∏—Ö–æ–¥—è—Ç –¥–∞–Ω–Ω—ã–µ –≤ —Ñ–æ—Ä–º–∞—Ç–µ JSON (—Ç–µ–∫—Å—Ç —Å –∫–ª—é—á–∞–º–∏ –∏ –∑–Ω–∞—á–µ–Ω–∏—è–º–∏). –ß—Ç–æ–±—ã —É–¥–æ–±–Ω–æ —Ä–∞–±–æ—Ç–∞—Ç—å —Å –Ω–∏–º–∏ –≤ –∫–æ–¥–µ (–æ–±—Ä–∞—â–∞—Ç—å—Å—è –∫ –ø–æ–ª—è–º –ø–æ –∏–º–µ–Ω–∏, –∞ –Ω–µ –∫ `data['content']`), –º—ã –æ–ø–∏—Å—ã–≤–∞–µ–º ¬´–º–æ–¥–µ–ª—å¬ª ‚Äî –∫–ª–∞—Å—Å `Message` —Å –ø–æ–ª—è–º–∏. `fromJson` –ø—Ä–µ–≤—Ä–∞—â–∞–µ—Ç JSON –≤ –æ–±—ä–µ–∫—Ç `Message`, `toJson` ‚Äî –æ–±—ä–µ–∫—Ç –æ–±—Ä–∞—Ç–Ω–æ –≤ JSON –¥–ª—è –æ—Ç–ø—Ä–∞–≤–∫–∏ –Ω–∞ —Å–µ—Ä–≤–µ—Ä.

**–ß—Ç–æ –¥–µ–ª–∞–µ—Ç:** –æ–ø–∏—Å—ã–≤–∞–µ—Ç —Å—Ç—Ä—É–∫—Ç—É—Ä—É —Å–æ–æ–±—â–µ–Ω–∏—è. `fromJson` ‚Äî —Å–æ–∑–¥–∞—ë—Ç –æ–±—ä–µ–∫—Ç `Message` –∏–∑ JSON (Map), `toJson` ‚Äî –ø—Ä–µ–≤—Ä–∞—â–∞–µ—Ç –æ–±—ä–µ–∫—Ç –æ–±—Ä–∞—Ç–Ω–æ –≤ JSON. –ù—É–∂–Ω–æ –¥–ª—è —Ä–∞–±–æ—Ç—ã —Å –¥–∞–Ω–Ω—ã–º–∏ —Å —Å–µ—Ä–≤–µ—Ä–∞.

**–ö–∞–∫ —Ä–∞–±–æ—Ç–∞–µ—Ç:** —Å–µ—Ä–≤–µ—Ä –æ—Ç–ø—Ä–∞–≤–ª—è–µ—Ç JSON —Å –ø–æ–ª—è–º–∏ –≤ **snake_case** (`chat_id`, `created_at`). –í Dart –∏—Å–ø–æ–ª—å–∑—É—é—Ç **camelCase** (`chatId`, `createdAt`). `fromJson` –¥–µ–ª–∞–µ—Ç –º–∞–ø–ø–∏–Ω–≥: —á–∏—Ç–∞–µ—Ç –∏–∑ JSON –ø–æ–ª—è –≤ snake_case –∏ –∫–ª–∞–¥—ë—Ç –≤ –ø–æ–ª—è –∫–ª–∞—Å—Å–∞ –≤ camelCase. `toJson` –¥–µ–ª–∞–µ—Ç –æ–±—Ä–∞—Ç–Ω–æ–µ.

**–¢–µ–æ—Ä–∏—è.** **–ú–æ–¥–µ–ª—å –¥–∞–Ω–Ω—ã—Ö** ‚Äî –∫–ª–∞—Å—Å, –∫–æ—Ç–æ—Ä—ã–π –æ–ø–∏—Å—ã–≤–∞–µ—Ç —Å—Ç—Ä—É–∫—Ç—É—Ä—É —Å—É—â–Ω–æ—Å—Ç–∏ (—Å–æ–æ–±—â–µ–Ω–∏–µ, –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å, —á–∞—Ç): –∫–∞–∫–∏–µ –ø–æ–ª—è –µ—Å—Ç—å, –∫–∞–∫–∏—Ö –æ–Ω–∏ —Ç–∏–ø–æ–≤. –í –∫–æ–¥–µ —É–¥–æ–±–Ω–µ–µ —Ä–∞–±–æ—Ç–∞—Ç—å —Å –ø–æ–ª—è–º–∏ (`message.content`, `message.senderEmail`), —á–µ–º —Å ¬´—Å—ã—Ä—ã–º¬ª Map (`data['content']`, `data['sender_email']`). –ü–ª—é—Å —Ç–∏–ø–∏–∑–∞—Ü–∏—è: –∫–æ–º–ø–∏–ª—è—Ç–æ—Ä –∏ IDE –ø–æ–¥—Å–∫–∞–∑—ã–≤–∞—é—Ç –ø–æ–ª—è –∏ –ª–æ–≤—è—Ç –æ–ø–µ—á–∞—Ç–∫–∏. **–°–µ—Ä–∏–∞–ª–∏–∑–∞—Ü–∏—è –∏ –¥–µ—Å–µ—Ä–∏–∞–ª–∏–∑–∞—Ü–∏—è**: –¥–∞–Ω–Ω—ã–µ —Å —Å–µ—Ä–≤–µ—Ä–∞ –ø—Ä–∏—Ö–æ–¥—è—Ç –≤ –≤–∏–¥–µ JSON (—Å—Ç—Ä–æ–∫–∞ –∏–ª–∏ —É–∂–µ —Ä–∞–∑–æ–±—Ä–∞–Ω–Ω—ã–π Map). –ü—Ä–µ–æ–±—Ä–∞–∑–æ–≤–∞–Ω–∏–µ –∏–∑ JSON (Map) –≤ –æ–±—ä–µ–∫—Ç –∫–ª–∞—Å—Å–∞ ‚Äî **–¥–µ—Å–µ—Ä–∏–∞–ª–∏–∑–∞—Ü–∏—è** (`fromJson`); –æ–±—Ä–∞—Ç–Ω–æ–µ –ø—Ä–µ–æ–±—Ä–∞–∑–æ–≤–∞–Ω–∏–µ –æ–±—ä–µ–∫—Ç–∞ –≤ JSON –¥–ª—è –æ—Ç–ø—Ä–∞–≤–∫–∏ –Ω–∞ —Å–µ—Ä–≤–µ—Ä ‚Äî **—Å–µ—Ä–∏–∞–ª–∏–∑–∞—Ü–∏—è** (`toJson`). –¢–∞–∫ –º—ã –æ—Ç–¥–µ–ª—è–µ–º ¬´–≤–Ω–µ—à–Ω–∏–π¬ª —Ñ–æ—Ä–º–∞—Ç (–∫–∞–∫ —Å–µ—Ä–≤–µ—Ä –∏ –∫–ª–∏–µ–Ω—Ç –¥–æ–≥–æ–≤–∞—Ä–∏–≤–∞—é—Ç—Å—è –æ–±–º–µ–Ω–∏–≤–∞—Ç—å—Å—è –¥–∞–Ω–Ω—ã–º–∏) –æ—Ç ¬´–≤–Ω—É—Ç—Ä–µ–Ω–Ω–µ–≥–æ¬ª –ø—Ä–µ–¥—Å—Ç–∞–≤–ª–µ–Ω–∏—è –≤ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–∏. **Snake_case vs camelCase**: –≤ JSON —Å –±—ç–∫–µ–Ω–¥–∞ —á–∞—Å—Ç–æ –∏—Å–ø–æ–ª—å–∑—É—é—Ç snake_case (`created_at`, `sender_email`), –≤ Dart –ø—Ä–∏–Ω—è—Ç camelCase (`createdAt`, `senderEmail`). –ú–∞–ø–ø–∏–Ω–≥ –≤ `fromJson`/`toJson` —Å–∫—Ä—ã–≤–∞–µ—Ç —ç—Ç–æ —Ä–∞–∑–ª–∏—á–∏–µ. **Nullable –ø–æ–ª—è**: –Ω–µ —É –∫–∞–∂–¥–æ–≥–æ —Å–æ–æ–±—â–µ–Ω–∏—è –µ—Å—Ç—å –∫–∞—Ä—Ç–∏–Ω–∫–∞ –∏–ª–∏ –æ—Ç–≤–µ—Ç; —Ç–∞–∫–∏–µ –ø–æ–ª—è –æ–±—ä—è–≤–ª—è—é—Ç –∫–∞–∫ `String?`, `Message?`. –ü—Ä–∏ —Ä–∞–∑–±–æ—Ä–µ JSON –Ω—É–∂–Ω–æ –æ–±—Ä–∞–±–∞—Ç—ã–≤–∞—Ç—å –æ—Ç—Å—É—Ç—Å—Ç–≤–∏–µ –∑–Ω–∞—á–µ–Ω–∏—è (null, –æ—Ç—Å—É—Ç—Å—Ç–≤—É—é—â–∏–π –∫–ª—é—á) –∏ –ø—Ä–∏–≤–æ–¥–∏—Ç—å —Ç–∏–ø—ã (—á–∏—Å–ª–æ –∏–∑ JSON –º–æ–∂–µ—Ç –ø—Ä–∏–π—Ç–∏ –∫–∞–∫ int –∏–ª–∏ –∫–∞–∫ —Å—Ç—Ä–æ–∫–∞).

**–°–∏–Ω—Ç–∞–∫—Å–∏—Å –∏ –∫–æ–Ω—Ü–µ–ø—Ü–∏–∏:**

- **`class Message { ... }`** ‚Äî –∫–ª–∞—Å—Å –º–æ–¥–µ–ª–∏. –û–±—ã—á–Ω–æ —Å–æ–¥–µ—Ä–∂–∏—Ç —Ç–æ–ª—å–∫–æ –ø–æ–ª—è, –∫–æ–Ω—Å—Ç—Ä—É–∫—Ç–æ—Ä, `fromJson`, `toJson` –∏ –≤—Å–ø–æ–º–æ–≥–∞—Ç–µ–ª—å–Ω—ã–µ –º–µ—Ç–æ–¥—ã.
- **`final String id`** ‚Äî —Ñ–∏–Ω–∞–ª—å–Ω–æ–µ –ø–æ–ª–µ (–Ω–µ–ª—å–∑—è –ø–µ—Ä–µ–ø—Ä–∏—Å–≤–æ–∏—Ç—å –ø–æ—Å–ª–µ —Å–æ–∑–¥–∞–Ω–∏—è –æ–±—ä–µ–∫—Ç–∞). `String` ‚Äî —Ç–∏–ø (–Ω–µ nullable).
- **`final String? imageUrl`** ‚Äî nullable –ø–æ–ª–µ. `String?` ‚Äî –º–æ–∂–µ—Ç –±—ã—Ç—å `String` –∏–ª–∏ `null`.
- **`Message({ required this.id, required this.chatId, ... })`** ‚Äî –∫–æ–Ω—Å—Ç—Ä—É–∫—Ç–æ—Ä —Å –∏–º–µ–Ω–æ–≤–∞–Ω–Ω—ã–º–∏ –ø–∞—Ä–∞–º–µ—Ç—Ä–∞–º–∏. `required` ‚Äî –ø–∞—Ä–∞–º–µ—Ç—Ä –æ–±—è–∑–∞—Ç–µ–ª—å–Ω—ã–π. `this.id` ‚Äî –∫–æ—Ä–æ—Ç–∫–∞—è –∑–∞–ø–∏—Å—å –¥–ª—è `required String id` + `this.id = id`.
- **`this.imageUrl`** ‚Äî –æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω—ã–π –ø–∞—Ä–∞–º–µ—Ç—Ä. –ï—Å–ª–∏ –Ω–µ –ø–µ—Ä–µ–¥–∞–Ω, –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è `null` (–¥–ª—è nullable –ø–æ–ª–µ–π) –∏–ª–∏ –∑–Ω–∞—á–µ–Ω–∏–µ –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é.
- **`messageType = 'text'`** ‚Äî –∑–Ω–∞—á–µ–Ω–∏–µ –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é. –ï—Å–ª–∏ –ø–∞—Ä–∞–º–µ—Ç—Ä –Ω–µ –ø–µ—Ä–µ–¥–∞–Ω, –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è `'text'`.
- **`bool get hasImage => imageUrl != null && imageUrl!.isNotEmpty`** ‚Äî –≥–µ—Ç—Ç–µ—Ä. `get` ‚Äî –∫–ª—é—á–µ–≤–æ–µ —Å–ª–æ–≤–æ –¥–ª—è –≥–µ—Ç—Ç–µ—Ä–∞. `=>` ‚Äî –∫–æ—Ä–æ—Ç–∫–∞—è –∑–∞–ø–∏—Å—å —Ñ—É–Ω–∫—Ü–∏–∏. `imageUrl!` ‚Äî –æ–ø–µ—Ä–∞—Ç–æ—Ä `!` (non-null assertion): ¬´—è —É–≤–µ—Ä–µ–Ω, —á—Ç–æ —ç—Ç–æ –Ω–µ null¬ª. `isNotEmpty` ‚Äî —Å–≤–æ–π—Å—Ç–≤–æ String (–Ω–µ –ø—É—Å—Ç–∞—è –ª–∏ —Å—Ç—Ä–æ–∫–∞).
- **`factory Message.fromJson(Map<String, dynamic> json) { ... }`** ‚Äî —Ñ–∞–±—Ä–∏—á–Ω—ã–π –∫–æ–Ω—Å—Ç—Ä—É–∫—Ç–æ—Ä. `factory` ‚Äî –∫–æ–Ω—Å—Ç—Ä—É–∫—Ç–æ—Ä, –∫–æ—Ç–æ—Ä—ã–π –º–æ–∂–µ—Ç –≤–æ–∑–≤—Ä–∞—â–∞—Ç—å –Ω–µ –Ω–æ–≤—ã–π —ç–∫–∑–µ–º–ø–ª—è—Ä, –∞ —Å—É—â–µ—Å—Ç–≤—É—é—â–∏–π –∏–ª–∏ –ø–æ–¥–∫–ª–∞—Å—Å. –ó–¥–µ—Å—å –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è –¥–ª—è —Å–æ–∑–¥–∞–Ω–∏—è –æ–±—ä–µ–∫—Ç–∞ –∏–∑ Map.
- **`(json['id'] ?? '').toString()`** ‚Äî –±–µ–∑–æ–ø–∞—Å–Ω–æ–µ —á—Ç–µ–Ω–∏–µ –∏–∑ Map. –ï—Å–ª–∏ `json['id']` null, –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è `''`, –∑–∞—Ç–µ–º `toString()` –ø—Ä–∏–≤–æ–¥–∏—Ç –∫ —Å—Ç—Ä–æ–∫–µ.
- **`json['image_url'] as String?`** ‚Äî –ø—Ä–∏–≤–µ–¥–µ–Ω–∏–µ —Ç–∏–ø–∞. `as String?` ‚Äî –≥–æ–≤–æ—Ä–∏—Ç Dart: ¬´–ø—Ä–∏–≤–µ–¥–∏ –∫ `String?`¬ª. –ï—Å–ª–∏ —Ç–∏–ø –Ω–µ —Å–æ–≤–ø–∞–¥–∞–µ—Ç, –±—É–¥–µ—Ç –æ—à–∏–±–∫–∞ –≤–æ –≤—Ä–µ–º—è –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è.
- **`json['file_size'] is int ? (json['file_size'] as int) : int.tryParse(...)`** ‚Äî —Ç–µ—Ä–Ω–∞—Ä–Ω—ã–π –æ–ø–µ—Ä–∞—Ç–æ—Ä —Å –ø—Ä–æ–≤–µ—Ä–∫–æ–π —Ç–∏–ø–∞. –ï—Å–ª–∏ `json['file_size']` —ç—Ç–æ `int`, –∏—Å–ø–æ–ª—å–∑—É–µ–º –∫–∞–∫ –µ—Å—Ç—å, –∏–Ω–∞—á–µ –ø—ã—Ç–∞–µ–º—Å—è —Ä–∞—Å–ø–∞—Ä—Å–∏—Ç—å —Å—Ç—Ä–æ–∫—É —á–µ—Ä–µ–∑ `int.tryParse()`.
- **`json['is_read'] == true || json['is_read'] == 1`** ‚Äî –ø—Ä–æ–≤–µ—Ä–∫–∞ boolean. –í JSON boolean –º–æ–∂–µ—Ç –±—ã—Ç—å `true`/`false` –∏–ª–∏ `1`/`0` (–∏–∑ –ë–î). –ü—Ä–æ–≤–µ—Ä—è–µ–º –æ–±–∞ –≤–∞—Ä–∏–∞–Ω—Ç–∞.
- **`json['reply_to_message'] != null ? Message.fromJson(...) : null`** ‚Äî —É—Å–ª–æ–≤–Ω–æ–µ —Å–æ–∑–¥–∞–Ω–∏–µ –æ–±—ä–µ–∫—Ç–∞. –ï—Å–ª–∏ `reply_to_message` –µ—Å—Ç—å, —Å–æ–∑–¥–∞—ë–º `Message` —á–µ—Ä–µ–∑ `fromJson`, –∏–Ω–∞—á–µ `null`.
- **`(json['reactions'] as List).map((r) => MessageReaction.fromJson(r)).toList()`** ‚Äî –ø—Ä–µ–æ–±—Ä–∞–∑–æ–≤–∞–Ω–∏–µ —Å–ø–∏—Å–∫–∞. `as List` ‚Äî –ø—Ä–∏–≤–æ–¥–∏–º –∫ List. `map((r) => ...)` ‚Äî –ø—Ä–∏–º–µ–Ω—è–µ–º —Ñ—É–Ω–∫—Ü–∏—é –∫ –∫–∞–∂–¥–æ–º—É —ç–ª–µ–º–µ–Ω—Ç—É. `MessageReaction.fromJson(r)` ‚Äî —Å–æ–∑–¥–∞—ë–º –æ–±—ä–µ–∫—Ç –∏–∑ –∫–∞–∂–¥–æ–≥–æ —ç–ª–µ–º–µ–Ω—Ç–∞. `toList()` ‚Äî –ø—Ä–µ–≤—Ä–∞—â–∞–µ–º —Ä–µ–∑—É–ª—å—Ç–∞—Ç `map` (Iterable) –≤ List.
- **`Map<String, dynamic> toJson() { return { 'id': id, 'chat_id': chatId, ... }; }`** ‚Äî –ø—Ä–µ–≤—Ä–∞—â–∞–µ—Ç –æ–±—ä–µ–∫—Ç –≤ Map. –í–æ–∑–≤—Ä–∞—â–∞–µ—Ç Map, –≥–¥–µ –∫–ª—é—á–∏ –≤ snake_case (–∫–∞–∫ –Ω–∞ —Å–µ—Ä–≤–µ—Ä–µ), –∑–Ω–∞—á–µ–Ω–∏—è ‚Äî –ø–æ–ª—è –æ–±—ä–µ–∫—Ç–∞.

**–ö–æ–¥ –∏–∑ –ø—Ä–æ–µ–∫—Ç–∞.** –§–∞–π–ª: `lib/models/message.dart`

```dart
class Message {
  final String id;
  final String chatId;
  final String userId;
  final String content;
  final String? imageUrl;
  final String messageType;
  final String senderEmail;
  final String createdAt;
  final bool isRead;
  final Message? replyToMessage;
  // ...

  Message({
    required this.id,
    required this.chatId,
    required this.userId,
    required this.content,
    this.imageUrl,
    this.messageType = 'text',
    required this.senderEmail,
    required this.createdAt,
    this.isRead = false,
    this.replyToMessage,
    // ...
  });

  bool get hasImage => imageUrl != null && imageUrl!.isNotEmpty;

  factory Message.fromJson(Map<String, dynamic> json) {
    return Message(
      id: (json['id'] ?? '').toString(),
      chatId: (json['chat_id'] ?? '').toString(),
      userId: (json['user_id'] ?? '').toString(),
      content: json['content'] ?? '',
      imageUrl: json['image_url'] as String?,
      messageType: json['message_type'] ?? 'text',
      senderEmail: json['sender_email'] ?? '',
      createdAt: json['created_at']?.toString() ?? '',
      isRead: json['is_read'] == true || json['is_read'] == 1,
      replyToMessage: json['reply_to_message'] != null 
          ? Message.fromJson(json['reply_to_message'] as Map<String, dynamic>)
          : null,
      // ...
    );
  }

  Map<String, dynamic> toJson() {
    return {
      'id': id,
      'chat_id': chatId,
      'user_id': userId,
      'content': content,
      'image_url': imageUrl,
      'message_type': messageType,
      'sender_email': senderEmail,
      'created_at': createdAt,
      'is_read': isRead,
      'reply_to_message': replyToMessage?.toJson(),
      // ...
    };
  }
}
```

**–ß—Ç–æ –Ω—É–∂–Ω–æ –∑–Ω–∞—Ç—å:** —á—Ç–æ —Ç–∞–∫–æ–µ –∫–ª–∞—Å—Å—ã –∏ –∫–æ–Ω—Å—Ç—Ä—É–∫—Ç–æ—Ä—ã, —á—Ç–æ —Ç–∞–∫–æ–µ –∏–º–µ–Ω–æ–≤–∞–Ω–Ω—ã–µ –ø–∞—Ä–∞–º–µ—Ç—Ä—ã (`required`, –∑–Ω–∞—á–µ–Ω–∏—è –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é), —á—Ç–æ —Ç–∞–∫–æ–µ nullable —Ç–∏–ø—ã (`String?`), —á—Ç–æ —Ç–∞–∫–æ–µ –æ–ø–µ—Ä–∞—Ç–æ—Ä—ã `??`, `!`, `as`, `is`, —á—Ç–æ —Ç–∞–∫–æ–µ –≥–µ—Ç—Ç–µ—Ä—ã (`get`), —á—Ç–æ —Ç–∞–∫–æ–µ —Ñ–∞–±—Ä–∏—á–Ω—ã–µ –∫–æ–Ω—Å—Ç—Ä—É–∫—Ç–æ—Ä—ã (`factory`), —á—Ç–æ —Ç–∞–∫–æ–µ –º–µ—Ç–æ–¥—ã —Å–ø–∏—Å–∫–æ–≤ (`map`, `toList`), —á—Ç–æ —Ç–∞–∫–æ–µ —Ä–µ–∫—É—Ä—Å–∏—è (–≤ `fromJson` –º–æ–∂–µ—Ç –±—ã—Ç—å –≤–ª–æ–∂–µ–Ω–Ω—ã–π `Message.fromJson`).

---

## 4. –ö–∞–∫ –∫–ª–∏–µ–Ω—Ç –∏ —Å–µ—Ä–≤–µ—Ä —Å–≤—è–∑–∞–Ω—ã

**–ü—Ä–æ—Å—Ç—ã–º–∏ —Å–ª–æ–≤–∞–º–∏:** –∫–ª–∏–µ–Ω—Ç –∏ —Å–µ—Ä–≤–µ—Ä –æ–±—â–∞—é—Ç—Å—è –ø–æ –∏–Ω—Ç–µ—Ä–Ω–µ—Ç—É. –ö–ª–∏–µ–Ω—Ç –æ—Ç–ø—Ä–∞–≤–ª—è–µ—Ç –∑–∞–ø—Ä–æ—Å (–Ω–∞–ø—Ä–∏–º–µ—Ä, ¬´–≤–æ–π—Ç–∏ —Å —Ç–∞–∫–∏–º –ª–æ–≥–∏–Ω–æ–º –∏ –ø–∞—Ä–æ–ª–µ–º¬ª), —Å–µ—Ä–≤–µ—Ä –æ–±—Ä–∞–±–∞—Ç—ã–≤–∞–µ—Ç –µ–≥–æ (–ø—Ä–æ–≤–µ—Ä—è–µ—Ç –≤ –±–∞–∑–µ, –≤—ã–¥–∞—ë—Ç —Ç–æ–∫–µ–Ω) –∏ –æ—Ç–ø—Ä–∞–≤–ª—è–µ—Ç –æ—Ç–≤–µ—Ç. –î–∞–Ω–Ω—ã–µ –ø–µ—Ä–µ–¥–∞—é—Ç—Å—è –≤ —Ñ–æ—Ä–º–∞—Ç–µ JSON. –ü–æ—Å–ª–µ –≤—Ö–æ–¥–∞ –∫–ª–∏–µ–Ω—Ç –ø—Ä–∏ –∫–∞–∂–¥–æ–º –∑–∞–ø—Ä–æ—Å–µ –ø—Ä–∏–∫–ª–∞–¥—ã–≤–∞–µ—Ç —Ç–æ–∫–µ–Ω, —á—Ç–æ–±—ã —Å–µ—Ä–≤–µ—Ä –ø–æ–Ω–∏–º–∞–ª, –∫—Ç–æ –æ–±—Ä–∞—â–∞–µ—Ç—Å—è.

**–û–¥–∏–Ω –ø–æ–ª–Ω—ã–π —Å—Ü–µ–Ω–∞—Ä–∏–π ‚Äî –≤—Ö–æ–¥ –ø–æ –ª–æ–≥–∏–Ω—É:**

1. –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –Ω–∞–∂–∏–º–∞–µ—Ç ¬´–í–æ–π—Ç–∏¬ª ‚Üí –≤—ã–∑—ã–≤–∞–µ—Ç—Å—è `LoginScreen._login()`.
2. `AuthService.loginUser(username, password)` –æ—Ç–ø—Ä–∞–≤–ª—è–µ—Ç `POST $baseUrl/auth/login` —Å —Ç–µ–ª–æ–º `{ "username": "...", "password": "..." }`.
3. –°–µ—Ä–≤–µ—Ä: `routes/auth.js` ‚Üí `login` –≤ `authController.js` ‚Üí –ø–æ–∏—Å–∫ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è –≤ –ë–î, –ø—Ä–æ–≤–µ—Ä–∫–∞ –ø–∞—Ä–æ–ª—è, `generateToken()` ‚Üí –æ—Ç–≤–µ—Ç `{ id, username, token }`.
4. –ö–ª–∏–µ–Ω—Ç: `response.statusCode == 200` ‚Üí `jsonDecode(response.body)` ‚Üí `StorageService.saveUserData(id, username, token)` ‚Üí `Navigator.pushReplacement(..., MainTabsScreen(...))`.
5. –°–ª–µ–¥—É—é—â–∏–µ –∑–∞–ø—Ä–æ—Å—ã: –∫–ª–∏–µ–Ω—Ç –¥–æ–±–∞–≤–ª—è–µ—Ç –∑–∞–≥–æ–ª–æ–≤–æ–∫ `Authorization: Bearer <token>`, —Å–µ—Ä–≤–µ—Ä –≤ `authenticateToken` –ø—Ä–æ–≤–µ—Ä—è–µ—Ç JWT –∏ –∫–ª–∞–¥—ë—Ç `req.user`, –∑–∞—Ç–µ–º –≤—ã–ø–æ–ª–Ω—è–µ—Ç—Å—è –∫–æ–Ω—Ç—Ä–æ–ª–ª–µ—Ä.

**–¢–µ–æ—Ä–∏—è.** –í–∑–∞–∏–º–æ–¥–µ–π—Å—Ç–≤–∏–µ –∫–ª–∏–µ–Ω—Ç–∞ –∏ —Å–µ—Ä–≤–µ—Ä–∞ —Å—Ç—Ä–æ–∏—Ç—Å—è –ø–æ **–¥–æ–≥–æ–≤–æ—Ä—ë–Ω–Ω–æ—Å—Ç–∏ (–∫–æ–Ω—Ç—Ä–∞–∫—Ç—É)**: –∫–∞–∫–∏–µ URL –∏ –º–µ—Ç–æ–¥—ã HTTP –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å, –∫–∞–∫–æ–π —Ñ–æ—Ä–º–∞—Ç —Ç–µ–ª–∞ –∑–∞–ø—Ä–æ—Å–∞ –∏ –æ—Ç–≤–µ—Ç–∞ (JSON), –∫–∞–∫–∏–µ –∑–∞–≥–æ–ª–æ–≤–∫–∏ –æ–±—è–∑–∞—Ç–µ–ª—å–Ω—ã (Authorization –¥–ª—è –∑–∞—â–∏—â—ë–Ω–Ω—ã—Ö —ç–Ω–¥–ø–æ–∏–Ω—Ç–æ–≤). –ö–ª–∏–µ–Ω—Ç –∏ —Å–µ—Ä–≤–µ—Ä —Ä–∞–∑—Ä–∞–±–∞—Ç—ã–≤–∞—é—Ç—Å—è —Å –æ–ø–æ—Ä–æ–π –Ω–∞ —ç—Ç–æ—Ç –∫–æ–Ω—Ç—Ä–∞–∫—Ç; –ø—Ä–∏ –µ–≥–æ –∏–∑–º–µ–Ω–µ–Ω–∏–∏ –Ω—É–∂–Ω–æ –æ–±–Ω–æ–≤–ª—è—Ç—å –æ–±–µ —Å—Ç–æ—Ä–æ–Ω—ã. **–ñ–∏–∑–Ω–µ–Ω–Ω—ã–π —Ü–∏–∫–ª –∑–∞–ø—Ä–æ—Å–∞**: –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å—Å–∫–æ–µ –¥–µ–π—Å—Ç–≤–∏–µ (–Ω–∞–∂–∞—Ç–∏–µ –∫–Ω–æ–ø–∫–∏) ‚Üí –≤—ã–∑–æ–≤ –º–µ—Ç–æ–¥–∞ —ç–∫—Ä–∞–Ω–∞ ‚Üí –≤—ã–∑–æ–≤ —Å–µ—Ä–≤–∏—Å–∞ ‚Üí —Ñ–æ—Ä–º–∏—Ä–æ–≤–∞–Ω–∏–µ HTTP-–∑–∞–ø—Ä–æ—Å–∞ (URL, –º–µ—Ç–æ–¥, –∑–∞–≥–æ–ª–æ–≤–∫–∏, body) ‚Üí –æ—Ç–ø—Ä–∞–≤–∫–∞ –ø–æ —Å–µ—Ç–∏ ‚Üí —Å–µ—Ä–≤–µ—Ä: —Ä–æ—É—Ç ‚Üí middleware (–ø—Ä–æ–≤–µ—Ä–∫–∞ —Ç–æ–∫–µ–Ω–∞) ‚Üí –∫–æ–Ω—Ç—Ä–æ–ª–ª–µ—Ä ‚Üí –ë–î –ø—Ä–∏ –Ω–µ–æ–±—Ö–æ–¥–∏–º–æ—Å—Ç–∏ ‚Üí —Ñ–æ—Ä–º–∏—Ä–æ–≤–∞–Ω–∏–µ –æ—Ç–≤–µ—Ç–∞ ‚Üí –∫–ª–∏–µ–Ω—Ç –ø–æ–ª—É—á–∞–µ—Ç –æ—Ç–≤–µ—Ç ‚Üí —Ä–∞–∑–±–æ—Ä JSON ‚Üí –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ —Å–æ—Å—Ç–æ—è–Ω–∏—è/UI –∏–ª–∏ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ –¥–∞–Ω–Ω—ã—Ö –∏ –Ω–∞–≤–∏–≥–∞—Ü–∏—è. **–ò–¥–µ–º–ø–æ—Ç–µ–Ω—Ç–Ω–æ—Å—Ç—å –∏ –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å**: GET-–∑–∞–ø—Ä–æ—Å—ã –æ–±—ã—á–Ω–æ –Ω–µ –º–µ–Ω—è—é—Ç –¥–∞–Ω–Ω—ã–µ; –∏–∑–º–µ–Ω–µ–Ω–∏–µ –¥–∞–Ω–Ω—ã—Ö ‚Äî —á–µ—Ä–µ–∑ POST/PUT/DELETE. –¢–æ–∫–µ–Ω –ø–µ—Ä–µ–¥–∞—ë—Ç—Å—è –≤ –∑–∞–≥–æ–ª–æ–≤–∫–µ, –∞ –Ω–µ –≤ URL, —á—Ç–æ–±—ã –æ–Ω –Ω–µ –ø–æ–ø–∞–¥–∞–ª –≤ –ª–æ–≥–∏ –∏ –∏—Å—Ç–æ—Ä–∏—é. **–§–æ—Ä–º–∞—Ç –¥–∞–Ω–Ω—ã—Ö:** –≤–µ–∑–¥–µ JSON ‚Äî –µ–¥–∏–Ω—ã–π —Ç–µ–∫—Å—Ç–æ–≤—ã–π —Ñ–æ—Ä–º–∞—Ç, –∫–æ—Ç–æ—Ä—ã–π –∏ JavaScript (—Å–µ—Ä–≤–µ—Ä), –∏ Dart (–∫–ª–∏–µ–Ω—Ç) —É–º–µ—é—Ç –ø–∞—Ä—Å–∏—Ç—å –∏ –≥–µ–Ω–µ—Ä–∏—Ä–æ–≤–∞—Ç—å.

**–§–æ—Ä–º–∞—Ç –¥–∞–Ω–Ω—ã—Ö:** –≤–µ–∑–¥–µ JSON. –ö–ª–∏–µ–Ω—Ç —à–ª—ë—Ç `jsonEncode(...)`, –ø–æ–ª—É—á–∞–µ—Ç —Å—Ç—Ä–æ–∫—É –∏ –ø–∞—Ä—Å–∏—Ç `jsonDecode(response.body)` –≤ –º–æ–¥–µ–ª–∏ —á–µ—Ä–µ–∑ `fromJson`.

---

## 5. –ü–æ—Ä—è–¥–æ–∫ –∏–∑—É—á–µ–Ω–∏—è –∫–æ–¥–∞

**–ü—Ä–æ—Å—Ç—ã–º–∏ —Å–ª–æ–≤–∞–º–∏:** –º–∞–Ω—É–∞–ª –±–æ–ª—å—à–æ–π ‚Äî –Ω–µ –æ–±—è–∑–∞—Ç–µ–ª—å–Ω–æ —á–∏—Ç–∞—Ç—å –ø–æ–¥—Ä—è–¥. –ù–∏–∂–µ –ø—Ä–µ–¥–ª–æ–∂–µ–Ω—ã –¥–≤–∞ –º–∞—Ä—à—Ä—É—Ç–∞: –æ–¥–∏–Ω –¥–ª—è —Ç–µ—Ö, –∫—Ç–æ —Ö–æ—á–µ—Ç –≤ –ø–µ—Ä–≤—É—é –æ—á–µ—Ä–µ–¥—å —Ä–∞–∑–æ–±—Ä–∞—Ç—å—Å—è –≤ —Å–µ—Ä–≤–µ—Ä–µ (JavaScript), –¥—Ä—É–≥–æ–π ‚Äî –≤ –∫–ª–∏–µ–Ω—Ç–µ (Flutter). –ù–∞—á–∏–Ω–∞–π—Ç–µ —Å —Ä–∞–∑–¥–µ–ª–∞ 1 (–æ–±–∑–æ—Ä), –∑–∞—Ç–µ–º –∏–¥–∏—Ç–µ –ø–æ –ø—É–Ω–∫—Ç–∞–º —Å–ø–∏—Å–∫–∞.

**–¢–µ–æ—Ä–∏—è.** –ò–∑—É—á–∞—Ç—å —á—É–∂–æ–π –∫–æ–¥ –ø—Ä–æ—â–µ, –µ—Å–ª–∏ –µ—Å—Ç—å **–ø–æ—Ä—è–¥–æ–∫**: —Å–Ω–∞—á–∞–ª–∞ –æ–±—â–∞—è –∫–∞—Ä—Ç–∏–Ω–∞ (—á—Ç–æ –∑–∞ –ø—Ä–æ–µ–∫—Ç, –∏–∑ –∫–∞–∫–∏—Ö —á–∞—Å—Ç–µ–π —Å–æ—Å—Ç–æ–∏—Ç), –ø–æ—Ç–æ–º —Ç–æ—á–∫–∞ –≤—Ö–æ–¥–∞ (–∫–∞–∫ –≤—Å—ë –∑–∞–ø—É—Å–∫–∞–µ—Ç—Å—è), –∑–∞—Ç–µ–º –ø–æ—Ç–æ–∫–∏ –¥–∞–Ω–Ω—ã—Ö (–∫–∞–∫ –∑–∞–ø—Ä–æ—Å –¥–æ—Ö–æ–¥–∏—Ç –¥–æ –ë–î –∏ –æ–±—Ä–∞—Ç–Ω–æ). –î–≤–∞ –ø—Ä–µ–¥–ª–æ–∂–µ–Ω–Ω—ã—Ö –º–∞—Ä—à—Ä—É—Ç–∞ (—Å–µ—Ä–≤–µ—Ä–Ω—ã–π –∏ –∫–ª–∏–µ–Ω—Ç—Å–∫–∏–π) –ø–æ–∑–≤–æ–ª—è—é—Ç —Å—Ñ–æ–∫—É—Å–∏—Ä–æ–≤–∞—Ç—å—Å—è –Ω–∞ –æ–¥–Ω–æ–π —á–∞—Å—Ç–∏ —Å—Ç–µ–∫–∞ –∏ –Ω–µ –ø–µ—Ä–µ—Å–∫–∞–∫–∏–≤–∞—Ç—å –º–µ–∂–¥—É —è–∑—ã–∫–∞–º–∏ –∏ –∫–æ–Ω—Ü–µ–ø—Ü–∏—è–º–∏. –ü–æ—Å–ª–µ –±–∞–∑–æ–≤—ã—Ö —Ñ–∞–π–ª–æ–≤ (—Ä–æ—É—Ç—ã, –∫–æ–Ω—Ç—Ä–æ–ª–ª–µ—Ä –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏–∏, –ë–î, JWT, —ç–∫—Ä–∞–Ω –≤—Ö–æ–¥–∞, —Å–µ—Ä–≤–∏—Å—ã) –æ—Å—Ç–∞–ª—å–Ω–æ–µ —Å—Ç—Ä–æ–∏—Ç—Å—è –ø–æ —Ç–µ–º –∂–µ –ø–∞—Ç—Ç–µ—Ä–Ω–∞–º ‚Äî –æ—Å—Ç–∞–ª—å–Ω—ã–µ –∫–æ–Ω—Ç—Ä–æ–ª–ª–µ—Ä—ã –∏ —ç–∫—Ä–∞–Ω—ã –ª–µ–≥—á–µ —á–∏—Ç–∞—Ç—å –ø–æ –∞–Ω–∞–ª–æ–≥–∏–∏.

**–ï—Å–ª–∏ –¥–µ–ª–∞–µ—à—å —É–ø–æ—Ä –Ω–∞ JavaScript (—Å–µ—Ä–≤–µ—Ä):**

1. –†–∞–∑–¥–µ–ª 1 (–û–±–∑–æ—Ä –ø—Ä–æ–µ–∫—Ç–∞).
2. –†–∞–∑–¥–µ–ª 2.1 (`index.js` ‚Äî —Å–æ–∑–¥–∞–Ω–∏–µ app, server, —Ä–æ—É—Ç—ã).
3. –†–∞–∑–¥–µ–ª 2.2 (`routes/auth.js` ‚Äî –∫–∞–∫ –ø—É—Ç—å –≤–µ–¥—ë—Ç –≤ –∫–æ–Ω—Ç—Ä–æ–ª–ª–µ—Ä).
4. –†–∞–∑–¥–µ–ª 2.4 (`db.js` ‚Äî –ø—É–ª —Å–æ–µ–¥–∏–Ω–µ–Ω–∏–π).
5. –†–∞–∑–¥–µ–ª 2.5 (`middleware/auth.js` ‚Äî JWT).
6. –†–∞–∑–¥–µ–ª 2.3 (`controllers/authController.js` ‚Äî register, login).
7. –†–∞–∑–¥–µ–ª 2.6 (`websocket/websocket.js` ‚Äî —Ä–µ–∞–ª—å–Ω–æ–µ –≤—Ä–µ–º—è).
8. –û—Å—Ç–∞–ª—å–Ω—ã–µ –∫–æ–Ω—Ç—Ä–æ–ª–ª–µ—Ä—ã –∏ —Ä–æ—É—Ç—ã ‚Äî –ø–æ –º–µ—Ä–µ –∏–Ω—Ç–µ—Ä–µ—Å–∞.

**–ï—Å–ª–∏ –¥–µ–ª–∞–µ—à—å —É–ø–æ—Ä –Ω–∞ Flutter (–∫–ª–∏–µ–Ω—Ç):**

1. –†–∞–∑–¥–µ–ª 1 (–û–±–∑–æ—Ä –ø—Ä–æ–µ–∫—Ç–∞).
2. –†–∞–∑–¥–µ–ª 3.1 (`main.dart` ‚Äî –∑–∞–ø—É—Å–∫, FutureBuilder, –≤—ã–±–æ—Ä —ç–∫—Ä–∞–Ω–∞).
3. –†–∞–∑–¥–µ–ª 3.2 (`config/api_config.dart` ‚Äî URL API).
4. –†–∞–∑–¥–µ–ª 3.4 (`services/storage_service.dart` ‚Äî –≥–¥–µ —Ö—Ä–∞–Ω–∏—Ç—Å—è —Ç–æ–∫–µ–Ω).
5. –†–∞–∑–¥–µ–ª 3.3 (`services/auth_service.dart` ‚Äî –≤—ã–∑–æ–≤ API).
6. –†–∞–∑–¥–µ–ª 3.5 (`screens/login_screen.dart` ‚Äî —ç–∫—Ä–∞–Ω –≤—Ö–æ–¥–∞, setState, –Ω–∞–≤–∏–≥–∞—Ü–∏—è).
7. –†–∞–∑–¥–µ–ª 3.6 (`models/message.dart` ‚Äî fromJson/toJson).
8. –†–∞–∑–¥–µ–ª 4 (—Å–≤—è–∑–∫–∞ –∫–ª–∏–µ–Ω—Ç‚Äì—Å–µ—Ä–≤–µ—Ä ‚Äî –æ–¥–∏–Ω –∑–∞–ø—Ä–æ—Å –æ—Ç –∫–Ω–æ–ø–∫–∏ –¥–æ –ë–î).
9. –û—Å—Ç–∞–ª—å–Ω—ã–µ —ç–∫—Ä–∞–Ω—ã –∏ —Å–µ—Ä–≤–∏—Å—ã ‚Äî –ø–æ –º–µ—Ä–µ –Ω–∞–¥–æ–±–Ω–æ—Å—Ç–∏.

---

## 6. –ë—ã—Å—Ç—Ä—ã–π —Å—Ç–∞—Ä—Ç

**–ü—Ä–æ—Å—Ç—ã–º–∏ —Å–ª–æ–≤–∞–º–∏:** —á—Ç–æ–±—ã –∑–∞–ø—É—Å—Ç–∏—Ç—å –ø—Ä–æ–µ–∫—Ç —É —Å–µ–±—è, –Ω—É–∂–Ω–æ –æ—Ç–¥–µ–ª—å–Ω–æ –∑–∞–ø—É—Å—Ç–∏—Ç—å —Å–µ—Ä–≤–µ—Ä (–≤ –ø–∞–ø–∫–µ `my_serve_chat_test`) –∏ –∫–ª–∏–µ–Ω—Ç (–∫–æ–º–∞–Ω–¥–∞ `flutter run`). –ü–µ—Ä–µ–¥ –ø–µ—Ä–≤—ã–º –∑–∞–ø—É—Å–∫–æ–º —Å–µ—Ä–≤–µ—Ä–∞ –Ω—É–∂–Ω–æ —Å–æ–∑–¥–∞—Ç—å —Ñ–∞–π–ª `.env` –∏–∑ –ø—Ä–∏–º–µ—Ä–∞ –∏ —É–∫–∞–∑–∞—Ç—å –∞–¥—Ä–µ—Å –±–∞–∑—ã –¥–∞–Ω–Ω—ã—Ö –∏ —Å–µ–∫—Ä–µ—Ç–Ω—ã–π –∫–ª—é—á –¥–ª—è —Ç–æ–∫–µ–Ω–æ–≤.

**–¢–µ–æ—Ä–∏—è.** –ó–∞–ø—É—Å–∫ —Ä–∞–∑–¥–µ–ª—ë–Ω –Ω–∞ **—Å–µ—Ä–≤–µ—Ä** –∏ **–∫–ª–∏–µ–Ω—Ç**, –ø–æ—Ç–æ–º—É —á—Ç–æ —ç—Ç–æ –¥–≤–µ –æ—Ç–¥–µ–ª—å–Ω—ã–µ –ø—Ä–æ–≥—Ä–∞–º–º—ã: —Å–µ—Ä–≤–µ—Ä —Å–ª—É—à–∞–µ—Ç –ø–æ—Ä—Ç –∏ –æ–±—Ä–∞—â–∞–µ—Ç—Å—è –∫ –ë–î; –∫–ª–∏–µ–Ω—Ç ‚Äî —ç—Ç–æ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ, –∫–æ—Ç–æ—Ä–æ–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –æ—Ç–∫—Ä—ã–≤–∞–µ—Ç. –í —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–µ —Å–µ—Ä–≤–µ—Ä –æ–±—ã—á–Ω–æ –∑–∞–ø—É—Å–∫–∞—é—Ç –ª–æ–∫–∞–ª—å–Ω–æ (–∏–ª–∏ –ø–æ–¥–∫–ª—é—á–∞—é—Ç—Å—è –∫ —Ç–µ—Å—Ç–æ–≤–æ–º—É), –∫–ª–∏–µ–Ω—Ç —É–∫–∞–∑—ã–≤–∞–µ—Ç –Ω–∞ –ª–æ–∫–∞–ª—å–Ω—ã–π –∏–ª–∏ —Ç–µ—Å—Ç–æ–≤—ã–π URL API. **–ó–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏**: Node.js-–ø—Ä–æ–µ–∫—Ç —Ç—è–Ω–µ—Ç –ø–∞–∫–µ—Ç—ã —á–µ—Ä–µ–∑ `npm install` (–∏–∑ `package.json` –∏ `package-lock.json`), Flutter-–ø—Ä–æ–µ–∫—Ç ‚Äî —á–µ—Ä–µ–∑ `flutter pub get` (–∏–∑ `pubspec.yaml`). –ë–µ–∑ —É—Å—Ç–∞–Ω–æ–≤–∫–∏ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–µ–π –∫–æ–¥ –Ω–µ –∑–∞–ø—É—Å—Ç–∏—Ç—Å—è. **–ü–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –æ–∫—Ä—É–∂–µ–Ω–∏—è**: —Ñ–∞–π–ª `.env` –Ω–µ –∫–æ–º–º–∏—Ç–∏—Ç—Å—è –≤ —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏–π (–≤ –Ω—ë–º —Å–µ–∫—Ä–µ—Ç—ã –∏ –ª–æ–∫–∞–ª—å–Ω—ã–µ –Ω–∞—Å—Ç—Ä–æ–π–∫–∏); –≤ —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏–∏ –ª–µ–∂–∏—Ç `.env.example` —Å –ø–µ—Ä–µ—á–Ω–µ–º –ø–µ—Ä–µ–º–µ–Ω–Ω—ã—Ö –±–µ–∑ –∑–Ω–∞—á–µ–Ω–∏–π. –ù–æ–≤—ã–π —Ä–∞–∑—Ä–∞–±–æ—Ç—á–∏–∫ –∫–æ–ø–∏—Ä—É–µ—Ç `.env.example` –≤ `.env` –∏ –ø–æ–¥—Å—Ç–∞–≤–ª—è–µ—Ç —Å–≤–æ–∏ –∑–Ω–∞—á–µ–Ω–∏—è (–∞–¥—Ä–µ—Å –ë–î, JWT_SECRET).

**–°–µ—Ä–≤–µ—Ä:**

```bash
cd my_serve_chat_test
cp .env.example .env   # –∑–∞–ø–æ–ª–Ω–∏ DATABASE_URL, JWT_SECRET
npm install
npm start
```

**–ö–ª–∏–µ–Ω—Ç:**

```bash
flutter pub get
flutter run -d chrome   # –∏–ª–∏ flutter run
```

---

–≠—Ç–æ—Ç —É—á–µ–±–Ω–∏–∫ –ø–æ–∫—Ä—ã–≤–∞–µ—Ç —É—Å—Ç—Ä–æ–π—Å—Ç–≤–æ –ø—Ä–æ–µ–∫—Ç–∞ –∏ —Ä–∞–∑–±–æ—Ä –∫–æ–¥–∞. –ö–∞–∂–¥–∞—è —Ñ—É–Ω–∫—Ü–∏—è/–∫–æ–Ω—Ü–µ–ø—Ü–∏—è –æ–±—ä—è—Å–Ω—è–µ—Ç—Å—è —Å —Å–∏–Ω—Ç–∞–∫—Å–∏—Å–æ–º –∏ –ø—Ä–∏–Ω—Ü–∏–ø–æ–º —Ä–∞–±–æ—Ç—ã –Ω–∞ –ø—Ä–∏–º–µ—Ä–∞—Ö –∏–∑ –ø—Ä–æ–µ–∫—Ç–∞.
