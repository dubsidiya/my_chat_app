# –ò—Ç–æ–≥–æ–≤—ã–µ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏—è —Å–µ—Ä–≤–µ—Ä–∞

## ‚úÖ –í—Å–µ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏—è –≤—ã–ø–æ–ª–Ω–µ–Ω—ã!

### 1. **routes/chats.js** ‚úÖ
- **–ò—Å–ø—Ä–∞–≤–ª–µ–Ω–æ**: –†–æ—É—Ç –∏–∑–º–µ–Ω–µ–Ω —Å `POST /chats/create` –Ω–∞ `POST /chats`
- **–ü—Ä–∏—á–∏–Ω–∞**: –ü—Ä–∏–ª–æ–∂–µ–Ω–∏–µ –æ—Ç–ø—Ä–∞–≤–ª—è–µ—Ç –∑–∞–ø—Ä–æ—Å –Ω–∞ `POST /chats`, –∞ –Ω–µ `/chats/create`

### 2. **controllers/chatsController.js** ‚úÖ

#### getUserChats:
- **–ò—Å–ø—Ä–∞–≤–ª–µ–Ω–æ**: –ò—Å–ø–æ–ª—å–∑—É–µ—Ç `chat_users` –≤–º–µ—Å—Ç–æ `chat_members`
- **–ò—Å–ø—Ä–∞–≤–ª–µ–Ω–æ**: –í–æ–∑–≤—Ä–∞—â–∞–µ—Ç `is_group` –≤ —Ä–µ–∑—É–ª—å—Ç–∞—Ç–µ
- **–ü—Ä–∏—á–∏–Ω–∞**: –í —Å—Ö–µ–º–µ –ë–î —Ç–∞–±–ª–∏—Ü–∞ –Ω–∞–∑—ã–≤–∞–µ—Ç—Å—è `chat_users`, –∏ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ –æ–∂–∏–¥–∞–µ—Ç –ø–æ–ª–µ `is_group`

#### createChat:
- **–ò—Å–ø—Ä–∞–≤–ª–µ–Ω–æ**: –ò—Å–ø–æ–ª—å–∑—É–µ—Ç `chat_users` –≤–º–µ—Å—Ç–æ `chat_members`
- **–ò—Å–ø—Ä–∞–≤–ª–µ–Ω–æ**: –°–æ–∑–¥–∞–µ—Ç —á–∞—Ç —Å –ø–æ–ª–µ–º `is_group` (true –µ—Å–ª–∏ –±–æ–ª—å—à–µ 1 —É—á–∞—Å—Ç–Ω–∏–∫–∞)
- **–ò—Å–ø—Ä–∞–≤–ª–µ–Ω–æ**: –í–æ–∑–≤—Ä–∞—â–∞–µ—Ç `is_group` –≤ –æ—Ç–≤–µ—Ç–µ
- **–ü—Ä–∏—á–∏–Ω–∞**: –°–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤–∏–µ —Å—Ö–µ–º–µ –ë–î –∏ –æ–∂–∏–¥–∞–Ω–∏—è–º –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è

### 3. **controllers/messagesController.js** ‚úÖ

#### getMessages:
- **–ò—Å–ø—Ä–∞–≤–ª–µ–Ω–æ**: –ò—Å–ø–æ–ª—å–∑—É–µ—Ç `user_id` –≤–º–µ—Å—Ç–æ `sender_id`
- **–ò—Å–ø—Ä–∞–≤–ª–µ–Ω–æ**: –í–æ–∑–≤—Ä–∞—â–∞–µ—Ç `user_id` –≤ –æ—Ç–≤–µ—Ç–µ (–≤–º–µ—Å—Ç–æ `sender_id`)
- **–ü—Ä–∏—á–∏–Ω–∞**: –í —Å—Ö–µ–º–µ –ë–î –∫–æ–ª–æ–Ω–∫–∞ –Ω–∞–∑—ã–≤–∞–µ—Ç—Å—è `user_id`, –∏ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ –æ–∂–∏–¥–∞–µ—Ç `user_id`

#### sendMessage:
- **–ò—Å–ø—Ä–∞–≤–ª–µ–Ω–æ**: –ü—Ä–∏–Ω–∏–º–∞–µ—Ç `user_id` –≤–º–µ—Å—Ç–æ `senderId`
- **–ò—Å–ø—Ä–∞–≤–ª–µ–Ω–æ**: –ò—Å–ø–æ–ª—å–∑—É–µ—Ç `user_id` –≤ SQL –∑–∞–ø—Ä–æ—Å–µ
- **–ò—Å–ø—Ä–∞–≤–ª–µ–Ω–æ**: –í–æ–∑–≤—Ä–∞—â–∞–µ—Ç `user_id` –≤ –æ—Ç–≤–µ—Ç–µ
- **–ü—Ä–∏—á–∏–Ω–∞**: –ü—Ä–∏–ª–æ–∂–µ–Ω–∏–µ –æ—Ç–ø—Ä–∞–≤–ª—è–µ—Ç `user_id`, –∞ –Ω–µ `senderId`

### 4. **websocket/websocket.js** ‚úÖ
- **–ò—Å–ø—Ä–∞–≤–ª–µ–Ω–æ**: –ò—Å–ø–æ–ª—å–∑—É–µ—Ç `user_id` –≤–º–µ—Å—Ç–æ `sender_id`
- **–ò—Å–ø—Ä–∞–≤–ª–µ–Ω–æ**: –ò—Å–ø–æ–ª—å–∑—É–µ—Ç `chat_users` –≤–º–µ—Å—Ç–æ `chat_members`
- **–ò—Å–ø—Ä–∞–≤–ª–µ–Ω–æ**: –ü–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ—Ç –æ–±–∞ –≤–∞—Ä–∏–∞–Ω—Ç–∞ –ø–∞—Ä–∞–º–µ—Ç—Ä–æ–≤ (–¥–ª—è –æ–±—Ä–∞—Ç–Ω–æ–π —Å–æ–≤–º–µ—Å—Ç–∏–º–æ—Å—Ç–∏)
- **–ü—Ä–∏—á–∏–Ω–∞**: –°–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤–∏–µ —Å—Ö–µ–º–µ –ë–î –∏ —Ñ–æ—Ä–º–∞—Ç—É –¥–∞–Ω–Ω—ã—Ö –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è

## üìã –°–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤–∏–µ —Å—Ö–µ–º–µ –ë–î

–í—Å–µ —Ñ–∞–π–ª—ã —Ç–µ–ø–µ—Ä—å –∏—Å–ø–æ–ª—å–∑—É—é—Ç –ø—Ä–∞–≤–∏–ª—å–Ω—ã–µ –∏–º–µ–Ω–∞ —Ç–∞–±–ª–∏—Ü –∏ –∫–æ–ª–æ–Ω–æ–∫:

| –°—Ç–∞—Ä–æ–µ –∏–º—è | –ù–æ–≤–æ–µ –∏–º—è | –ì–¥–µ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è |
|------------|-----------|------------------|
| `chat_members` | `chat_users` | –í—Å–µ –∫–æ–Ω—Ç—Ä–æ–ª–ª–µ—Ä—ã, WebSocket |
| `sender_id` | `user_id` | messagesController, WebSocket |

## üîÑ –°–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤–∏–µ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—é

–í—Å–µ —ç–Ω–¥–ø–æ–∏–Ω—Ç—ã –∏ —Ñ–æ—Ä–º–∞—Ç—ã –¥–∞–Ω–Ω—ã—Ö —Ç–µ–ø–µ—Ä—å —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤—É—é—Ç –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—é:

| –≠–Ω–¥–ø–æ–∏–Ω—Ç | –ú–µ—Ç–æ–¥ | –°—Ç–∞—Ç—É—Å |
|----------|-------|-------|
| `/auth/login` | POST | ‚úÖ |
| `/auth/register` | POST | ‚úÖ |
| `/chats/:id` | GET | ‚úÖ |
| `/chats` | POST | ‚úÖ (–±—ã–ª–æ `/chats/create`) |
| `/messages/:chatId` | GET | ‚úÖ |
| `/messages` | POST | ‚úÖ |
| WebSocket | wss:// | ‚úÖ |

## üìù –§–æ—Ä–º–∞—Ç—ã –¥–∞–Ω–Ω—ã—Ö

### –°–æ–∑–¥–∞–Ω–∏–µ —á–∞—Ç–∞:
**–ó–∞–ø—Ä–æ—Å (–ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ ‚Üí —Å–µ—Ä–≤–µ—Ä):**
```json
{
  "name": "–ù–∞–∑–≤–∞–Ω–∏–µ —á–∞—Ç–∞",
  "userIds": ["1", "2"]
}
```

**–û—Ç–≤–µ—Ç (—Å–µ—Ä–≤–µ—Ä ‚Üí –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ):**
```json
{
  "id": 1,
  "name": "–ù–∞–∑–≤–∞–Ω–∏–µ —á–∞—Ç–∞",
  "is_group": true
}
```

### –û—Ç–ø—Ä–∞–≤–∫–∞ —Å–æ–æ–±—â–µ–Ω–∏—è:
**–ó–∞–ø—Ä–æ—Å (–ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ ‚Üí —Å–µ—Ä–≤–µ—Ä):**
```json
{
  "user_id": "1",
  "chat_id": "2",
  "content": "–¢–µ–∫—Å—Ç —Å–æ–æ–±—â–µ–Ω–∏—è"
}
```

**–û—Ç–≤–µ—Ç (—Å–µ—Ä–≤–µ—Ä ‚Üí –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ):**
```json
{
  "id": 1,
  "chat_id": "2",
  "user_id": "1",
  "content": "–¢–µ–∫—Å—Ç —Å–æ–æ–±—â–µ–Ω–∏—è",
  "created_at": "2024-01-01T12:00:00",
  "sender_email": "user@example.com"
}
```

## ‚ö†Ô∏è –í–∞–∂–Ω–æ: –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –ë–î

–£–±–µ–¥–∏—Ç–µ—Å—å, —á—Ç–æ –≤ Neon PostgreSQL:

1. **–¢–∞–±–ª–∏—Ü–∞ –Ω–∞–∑—ã–≤–∞–µ—Ç—Å—è `chat_users`** (–Ω–µ `chat_members`):
```sql
-- –ï—Å–ª–∏ —Ç–∞–±–ª–∏—Ü–∞ –Ω–∞–∑—ã–≤–∞–µ—Ç—Å—è chat_members, –ø–µ—Ä–µ–∏–º–µ–Ω—É–π—Ç–µ:
ALTER TABLE chat_members RENAME TO chat_users;
```

2. **–í —Ç–∞–±–ª–∏—Ü–µ `messages` –∫–æ–ª–æ–Ω–∫–∞ –Ω–∞–∑—ã–≤–∞–µ—Ç—Å—è `user_id`** (–Ω–µ `sender_id`):
```sql
-- –ï—Å–ª–∏ –∫–æ–ª–æ–Ω–∫–∞ –Ω–∞–∑—ã–≤–∞–µ—Ç—Å—è sender_id, –ø–µ—Ä–µ–∏–º–µ–Ω—É–π—Ç–µ:
ALTER TABLE messages RENAME COLUMN sender_id TO user_id;
```

3. **–í —Ç–∞–±–ª–∏—Ü–µ `chats` –µ—Å—Ç—å –∫–æ–ª–æ–Ω–∫–∞ `is_group`**:
```sql
-- –ï—Å–ª–∏ –∫–æ–ª–æ–Ω–∫–∏ –Ω–µ—Ç, –¥–æ–±–∞–≤—å—Ç–µ:
ALTER TABLE chats ADD COLUMN IF NOT EXISTS is_group BOOLEAN DEFAULT false;
```

## üöÄ –ß—Ç–æ –¥–µ–ª–∞—Ç—å –¥–∞–ª—å—à–µ:

1. ‚úÖ –í—Å–µ —Ñ–∞–π–ª—ã –∏—Å–ø—Ä–∞–≤–ª–µ–Ω—ã
2. ‚è≥ –ó–∞–≥—Ä—É–∑–∏—Ç–µ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–Ω—ã–µ —Ñ–∞–π–ª—ã –Ω–∞ Render
3. ‚è≥ –ü—Ä–æ–≤–µ—Ä—å—Ç–µ/–∏—Å–ø—Ä–∞–≤—å—Ç–µ —Ç–∞–±–ª–∏—Ü—ã –≤ Neon (–µ—Å–ª–∏ –Ω—É–∂–Ω–æ)
4. ‚è≥ –ü–µ—Ä–µ–∑–∞–ø—É—Å—Ç–∏—Ç–µ —Å–µ—Ä–≤–µ—Ä –Ω–∞ Render
5. ‚è≥ –ü—Ä–æ—Ç–µ—Å—Ç–∏—Ä—É–π—Ç–µ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ

## ‚úÖ –ì–æ—Ç–æ–≤–æ!

–í—Å–µ —Ñ–∞–π–ª—ã —Å–µ—Ä–≤–µ—Ä–∞ —Ç–µ–ø–µ—Ä—å –ø–æ–ª–Ω–æ—Å—Ç—å—é —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∏—Ä–æ–≤–∞–Ω—ã —Å –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ–º –∏ —Å—Ö–µ–º–æ–π –ë–î!

