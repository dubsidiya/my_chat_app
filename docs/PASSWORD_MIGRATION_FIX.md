# üîß –ò—Å–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –ø—Ä–æ–±–ª–µ–º —Å –ø–∞—Ä–æ–ª—è–º–∏ –∏ —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏–µ–π

## –ü—Ä–æ–±–ª–µ–º—ã:

1. **–°—Ç–∞—Ä—ã–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–∏ –Ω–µ –º–æ–≥—É—Ç –≤–æ–π—Ç–∏** - –ø–∞—Ä–æ–ª–∏ –≤ –ë–î –≤ –æ—Ç–∫—Ä—ã—Ç–æ–º –≤–∏–¥–µ, –∞ –ø—Ä–æ–≤–µ—Ä–∫–∞ —á–µ—Ä–µ–∑ bcrypt
2. **–†–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è –≥–æ–≤–æ—Ä–∏—Ç "–ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å —É–∂–µ —Å—É—â–µ—Å—Ç–≤—É–µ—Ç"** - –¥–∞–∂–µ –¥–ª—è –Ω–æ–≤—ã—Ö email
3. **–í–∞–ª–∏–¥–∞—Ü–∏—è email —Å–ª–∏—à–∫–æ–º —Å—Ç—Ä–æ–≥–∞—è**

## ‚úÖ –ß—Ç–æ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–æ:

### 1. –ú–∏–≥—Ä–∞—Ü–∏—è –ø–∞—Ä–æ–ª–µ–π "–Ω–∞ –ª–µ—Ç—É" –ø—Ä–∏ –≤—Ö–æ–¥–µ

–¢–µ–ø–µ—Ä—å –ø—Ä–∏ –≤—Ö–æ–¥–µ:
- –ï—Å–ª–∏ –ø–∞—Ä–æ–ª—å —Ö–µ—à–∏—Ä–æ–≤–∞–Ω (–Ω–∞—á–∏–Ω–∞–µ—Ç—Å—è —Å `$2`) - –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è `bcrypt.compare`
- –ï—Å–ª–∏ –ø–∞—Ä–æ–ª—å –≤ –æ—Ç–∫—Ä—ã—Ç–æ–º –≤–∏–¥–µ - —Å—Ä–∞–≤–Ω–∏–≤–∞–µ—Ç—Å—è –Ω–∞–ø—Ä—è–º—É—é
- –ï—Å–ª–∏ —Å–æ–≤–ø–∞–ª - –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –ø–µ—Ä–µ—Ö–µ—à–∏—Ä—É–µ—Ç—Å—è

```javascript
const isPasswordHashed = user.password && user.password.startsWith('$2');

if (isPasswordHashed) {
  passwordMatch = await bcrypt.compare(password, user.password);
} else {
  passwordMatch = user.password === password;
  if (passwordMatch) {
    // –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –ø–µ—Ä–µ—Ö–µ—à–∏—Ä—É–µ–º
    const hashedPassword = await bcrypt.hash(password, 10);
    await pool.query('UPDATE users SET password = $1 WHERE id = $2', ...);
  }
}
```

### 2. –£–ª—É—á—à–µ–Ω–∞ –ø—Ä–æ–≤–µ—Ä–∫–∞ —Å—É—â–µ—Å—Ç–≤—É—é—â–∏—Ö –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π

–¢–µ–ø–µ—Ä—å –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è –Ω–æ—Ä–º–∞–ª–∏–∑–∞—Ü–∏—è –ø—Ä–∏ –ø–æ–∏—Å–∫–µ:
```sql
SELECT id, email FROM users WHERE LOWER(TRIM(email)) = $1
```

–≠—Ç–æ –Ω–∞—Ö–æ–¥–∏—Ç –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π –¥–∞–∂–µ –µ—Å–ª–∏:
- Email –≤ –¥—Ä—É–≥–æ–º —Ä–µ–≥–∏—Å—Ç—Ä–µ
- –ï—Å—Ç—å –ø—Ä–æ–±–µ–ª—ã –≤ email

### 3. –£–ø—Ä–æ—â–µ–Ω–∞ –≤–∞–ª–∏–¥–∞—Ü–∏—è email

- –ò—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è –ø—Ä–æ—Å—Ç–∞—è regex –ø—Ä–æ–≤–µ—Ä–∫–∞
- –î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω–∞—è –ø—Ä–æ–≤–µ—Ä–∫–∞ —á–µ—Ä–µ–∑ validator (–µ—Å–ª–∏ –¥–æ—Å—Ç—É–ø–µ–Ω)
- –ë–æ–ª–µ–µ –ø–æ–Ω—è—Ç–Ω—ã–µ —Å–æ–æ–±—â–µ–Ω–∏—è –æ–± –æ—à–∏–±–∫–∞—Ö

## üöÄ –†–µ–∑—É–ª—å—Ç–∞—Ç:

1. ‚úÖ –°—Ç–∞—Ä—ã–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–∏ –º–æ–≥—É—Ç –≤–æ–π—Ç–∏ - –ø–∞—Ä–æ–ª–∏ –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –º–∏–≥—Ä–∏—Ä—É—é—Ç—Å—è
2. ‚úÖ –†–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è —Ä–∞–±–æ—Ç–∞–µ—Ç –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ - –ø—Ä–∞–≤–∏–ª—å–Ω–∞—è –ø—Ä–æ–≤–µ—Ä–∫–∞ —Å—É—â–µ—Å—Ç–≤—É—é—â–∏—Ö –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π
3. ‚úÖ –í–∞–ª–∏–¥–∞—Ü–∏—è email –±–æ–ª–µ–µ –≥–∏–±–∫–∞—è

---

**–í—Å–µ –ø—Ä–æ–±–ª–µ–º—ã –∏—Å–ø—Ä–∞–≤–ª–µ–Ω—ã! –°—Ç–∞—Ä—ã–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–∏ —Å–º–æ–≥—É—Ç –≤–æ–π—Ç–∏, –∏ –∏—Ö –ø–∞—Ä–æ–ª–∏ –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –ø–µ—Ä–µ—Ö–µ—à–∏—Ä—É—é—Ç—Å—è.**

