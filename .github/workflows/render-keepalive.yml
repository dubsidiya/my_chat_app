# Держит сервер на Render.com (free tier) от засыпания: пинг каждые 5 минут.
# Если ваш сервис на другом URL — замените RENDER_URL ниже или задайте в Settings → Secrets and variables → Actions.
name: render-keepalive

on:
  schedule:
    - cron: "*/5 * * * *"
  workflow_dispatch: {}

jobs:
  ping:
    runs-on: ubuntu-latest
    steps:
      - name: Ping health endpoint (keep-alive + warm DB)
        env:
          RENDER_URL: ${{ vars.RENDER_SERVICE_URL }}
        run: |
          base="${RENDER_URL:-https://my-server-chat.onrender.com}"
          url="${base%/}/healthz?warm=1"
          for i in 1 2 3 4 5; do
            curl -fsS --max-time 30 "$url" >/dev/null && echo "OK $i" || true
            if [ "$i" -lt 5 ]; then sleep 60; fi
          done
