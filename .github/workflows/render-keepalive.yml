# Пинг бэкенда каждые 5 минут (раньше — Render keepalive; сейчас — Yandex VM).
# Переопределить URL: Settings → Secrets and variables → Actions → RENDER_SERVICE_URL.
name: render-keepalive

on:
  schedule:
    - cron: "*/5 * * * *"
  workflow_dispatch: {}

jobs:
  ping:
    runs-on: ubuntu-latest
    steps:
      - name: Ping health endpoint
        env:
          RENDER_URL: ${{ vars.RENDER_SERVICE_URL }}
        run: |
          base="${RENDER_URL:-https://reollity.duckdns.org}"
          url="${base%/}/healthz?warm=1"
          for i in 1 2 3 4 5; do
            curl -fsS --max-time 30 "$url" >/dev/null && echo "OK $i" || true
            if [ "$i" -lt 5 ]; then sleep 60; fi
          done
